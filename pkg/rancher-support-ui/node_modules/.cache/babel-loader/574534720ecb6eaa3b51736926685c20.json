{"remainingRequest":"/app/node_modules/thread-loader/dist/cjs.js!/app/node_modules/babel-loader/lib/index.js!/app/node_modules/@rancher/shell/store/type-map.js","dependencies":[{"path":"/app/node_modules/@rancher/shell/store/type-map.js","mtime":1764054237091},{"path":"/app/pkg/rancher-support-ui/babel.config.js","mtime":1764051174054},{"path":"/app/node_modules/cache-loader/dist/cjs.js","mtime":1764054259024},{"path":"/app/node_modules/thread-loader/dist/cjs.js","mtime":1764054259111},{"path":"/app/node_modules/babel-loader/lib/index.js","mtime":1764054258910}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8gVGhpcyBmaWxlIGhhcyAyIHNlY3Rpb25zIHRoYXQgY29udHJvbCBnZXR0aW5nIGFuZCB1c2luZyBzcGVjaWFsaXphdGlvbnMgb2YgcGFydGljdWxhciB0eXBlcwovLyBvdmVyIHRoZSBnZW5lcmljIGluZm8gdGhhdCBpcyBzcGVjaWZpZWQgb3IgZ2VuZXJhdGVkIGZyb20gc2NoZW1hcy4KLy8KLy8gMSkgR2V0dGluZyBpbmZvIGFib3V0IHR5cGVzCi8vCi8vIGxhYmVsRm9yKHNjaGVtYSwgY291bnQpICAgIEdldCB0aGUgZGlzcGxheSBsYWJlbCBmb3IgYSBzY2hlbWEuICBDb3VudCBpcyAoaW4gRW5nbGlzaCkgMSBvciBub3QtMSBmb3IgcGx1cmFsaXppbmcKLy8gZ3JvdXBMYWJlbEZvcihzY2hlbWEpICAgICAgR2V0IHRoZSBsYWJlbCBmb3IgdGhlIEFQSSBncm91cCBvZiB0aGlzIHNjaGVtYSdzIHR5cGUKLy8gaXNJZ25vcmVkKHNjaGVtYSkgICAgICAgICAgUmV0dXJucyB0cnVlIGlmIHRoaXMgdHlwZSBzaG91bGQgYmUgaGlkZGVuIGZyb20gdGhlIHRyZWUKLy8gZ3JvdXBGb3JCYXNpY1R5cGUoc2NoZW1hKSAgUmV0dXJucyB0aGUgZ3JvdXAgYSB0eXBlIHNob3VsZCBiZSBzaG93biBpbiBiYXNpYyB2aWV3LCBvciBmYWxzZS15IGlmIGl0IHNob3VsZG4ndCBiZSBzaG93bi4KLy8gdHlwZVdlaWdodEZvcih0eXBlLCBmb3JCYXNpYykgICBHZXQgdGhlIHdlaWdodCB2YWx1ZSBmb3IgYSBwYXJ0aWN1bGFyIHR5cGUgbGFiZWwKLy8gZ3JvdXBXZWlnaHRGb3IoZ3JvdXAsIGZvckJhc2ljKSBHZXQgdGhlIHdlaWdodCB2YWx1ZSBmb3IgYSBwYXJ0aWN1bGFyIGdyb3VwCi8vIGhlYWRlcnNGb3Ioc2NoZW1hKSAgICAgICAgIFJldHVybnMgdGhlIGNvbHVtbiBkZWZpbml0aW9ucyBmb3IgYSB0eXBlIHRvIGdpdmUgdG8gU29ydGFibGVUYWJsZQovLyBhY3RpdmVQcm9kdWN0cygpICAgICAgICAgICBSZXR1cm5zIHRoZSBsaXN0IG9mIHByb2R1Y3RzIHRoYXQgYXJlIGluc3RhbGxlZCBhbmQgc2hvdWxkIGJlIHNob3duCi8vCi8vIDIpIERldGVjdGluZyBhbmQgdXNpbmcgY3VzdG9tIGxpc3QvZGV0YWlsL2VkaXQvaGVhZGVyIGNvbXBvbmVudHMKLy8KLy8gaGFzQ3VzdG9tTGlzdCh0eXBlKSAgICAgICAgICAgICAgRG9lcyB0eXBlIGhhdmUgYSBjdXN0b20gbGlzdCBpbXBsZW1lbnRhdGlvbj8KLy8gaGFzQ3VzdG9tRGV0YWlsKHR5cGVbLHN1YlR5cGVdKSAgRG9lcyB0eXBlIGhhdmUgYSBjdXN0b20gZGV0YWlsIGltcGxlbWVudGF0aW9uPwovLyBoYXNDdXN0b21FZGl0KHR5cGVbLHN1YlR5cGVdKSAgICBEb2VzIHR5cGUgaGF2ZSBhIGN1c3RvbSBlZGl0IGltcGxlbWVudGF0aW9uPwovLyBpbXBvcnRMaXN0KHR5cGUpICAgICAgICAgICAgICAgICBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIHRoZSBsaXN0IGNvbXBvbmVudCBmb3IgdHlwZQovLyBpbXBvcnREZXRhaWwodHlwZVssc3ViVHlwZV0pICAgICBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIHRoZSBkZXRhaWwgY29tcG9uZW50IGZvciB0eXBlCi8vIGltcG9ydEVkaXQodHlwZVssc3ViVHlwZV0pICAgICAgIFJldHVybnMgYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgdG8gdGhlIGVkaXQgY29tcG9uZW50IGZvciB0eXBlCi8vIG9wdGlvbnNGb3Ioc2NoZW1hT3JUeXBlKSAgICAgICAgIFJldHVybiB0aGUgY29uZmlndXJlZCBvcHRpb25zIGZvciBhIHR5cGUgKGZyb20gY29uZmlndXJlVHlwZSkKLy8KLy8gMykgQ2hhbmdpbmcgc3BlY2lhbGl6YXRpb24gaW5mbyBhYm91dCBhIHR5cGUKLy8gRm9yIGFsbDoKLy8gICBsZXQgeyB0aGluZ1lvdVdhbnQgfSA9IERTTChpbnN0YW5jZU9mVGhlU3RvcmUsICdwcm9kdWN0Jyk7Ci8vCi8vIHByb2R1Y3QoICAgICAgICAgICAgICAgICAgIEFkZCBhIHByb2R1Y3QgaW50byB0aGUgbmF2Ci8vICAgcmVtb3ZhYmxlLCAgICAgICAgICAgICAgIC0tIElzIHRoZSBwcm9kdWN0IHJlbW92YWJsZSAodHJ1ZSkgb3IgYnVpbHQtaW4gKGZhbHNlKS4KLy8gICB3ZWlnaHQsICAgICAgICAgICAgICAgICAgLS0gU29ydCBvcmRlciBhbmQgZGl2aWRlciBzZWN0aW9ucyBpbiB0aGUgcHJvZHVjdCBtZW51LiAgMz1nbG9iYWwgKGZsZWV0LCBlY20pLCAyPWFsd2F5cyBvbiAoYXBwcywgZXhwbG9yZXIpIDE9b3RoZXIKLy8gICBzaG93Q2x1c3RlclN3aXRjaGVyLCAgICAgLS0gU2hvdyB0aGUgY2x1c3RlciBzd2l0Y2hlciBpbiB0aGUgaGVhZGVyIChkZWZhdWx0IHRydWUpCi8vICAgc2hvd05hbWVzcGFjZUZpbHRlciwgICAgIC0tIFNob3cgdGhlIG5hbWVzcGFjZSBmaWx0ZXIgaW4gdGhlIGhlYWRlciAoZGVmYXVsdCBmYWxzZSkKLy8gICBzaG93V29ya3NwYWNlU3dpdGNoZXIsICAgLS0gU2hvdyB0aGUgd29ya3NwYWNlIHN3aXRjaGVyIGluIHRoZSBoZWFkZXIgKGNvbmZsaWN0cyB3aXRoIG5hbWVzcGFjZSkgKGRlZmF1bHQgZmFsc2UpCi8vICAgaWZIYXZlLCAgICAgICAgICAgICAgICAgIC0tIFNob3cgdGhpcyBwcm9kdWN0IG9ubHkgaWYgdGhlIGdpdmVuIGNhcGFiaWxpdHkgaXMgYXZhaWxhYmxlCi8vICAgaWZIYXZlR3JvdXAsICAgICAgICAgICAgIC0tIFNob3cgdGhpcyBwcm9kdWN0IG9ubHkgaWYgdGhlIGdpdmVuIGdyb3VwIGV4aXN0cyBpbiB0aGUgc3RvcmUgW2luU3RvcmVdCi8vICAgaWZIYXZlVHlwZSwgICAgICAgICAgICAgIC0tIFNob3cgdGhpcyBwcm9kdWN0IG9ubHkgaWYgdGhlIGdpdmVuIHR5cGUgZXhpc3RzIGluIHRoZSBzdG9yZSBbaW5TdG9yZV0sIFRoaXMgY2FuIGFsc28gYmUgc3BlY2lmaWVkIGFzIGFuIG9iamVjdCB7IHR5cGU6IFRZUEUsIHN0b3JlOiAnbWFuYWdlbWVudCcgfSBpZiB0aGUgdHlwZSBpc24ndCBpbiB0aGUgY3VycmVudCBbaW5TdG9yZV0KLy8gICBpZkhhdmVWZXJiLCAgICAgICAgICAgICAgLS0gSW4gY29tYmluYXRpb24gd2l0aCBpZkhhdmVUWXBlLCBzaG93IGl0IG9ubHkgaWYgdGhlIHR5cGUgYWxzbyBoYXMgdGhpcyBjb2xsZWN0aW9uTWV0aG9kCi8vICAgaW5TdG9yZSwgICAgICAgICAgICAgICAgIC0tIFdoaWNoIHN0b3JlIHRvIGxvb2sgYXQgZm9yIGlmKiBhYm92ZSBhbmQgdGhlIGxlZnQtbmF2LCBkZWZhdWx0cyB0byAiY2x1c3RlciIKLy8gICByb290UHJvZHVjdCwgICAgICAgICAgICAgLS0gT3B0aW9uYWwgcm9vdCAocGFyZW50KSBwcm9kdWN0IC0gaWYgc2V0LCB1c2VkIHRvIG9wdGltaXplIG5hdmlnYXRpb24gd2hlbiBwcm9kdWN0IGNoYW5nZXMgc3RheXMgd2l0aGluIHJvb3QgcHJvZHVjdAovLyAgIGluRXhwbG9yZXIsICAgICAgICAgICAgICAtLSBEZXRlcm1pbmVzIGlmIHRoZSBwcm9kdWN0IGlzIHRvIGJlIHNjb3BlZCB0byB0aGUgZXhwbG9yZXIKLy8gICBwdWJsaWMsICAgICAgICAgICAgICAgICAgLS0gSWYgdHJ1ZSwgc2hvdyB0byBhbGwgdXNlcnMuICBJZiBmYWxzZSwgb25seSBzaG93IHdoZW4gdGhlIERldmVsb3BlciBUb29scyBwcmVmIGlzIG9uIChkZWZhdWx0IHRydWUpCi8vICAgY2F0ZWdvcnksICAgICAgICAgICAgICAgIC0tIEdyb3VwIHRvIHNob3cgdGhlIHByb2R1Y3QgaW4gZm9yIHRoZSBuYXYgaGFtYnVyZ2VyIG1lbnUKLy8gICB0eXBlU3RvcmVNYXAsICAgICAgICAgICAgLS0gQW4gb2JqZWN0IG1hcHBpbmcgdHlwZXMgdG8gdGhlIHN0b3JlIHRoYXQgc2hvdWxkIGJlIHVzZWQgdG8gcmV0cmlldmUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHR5cGUKLy8gICBoaWRlU3lzdGVtUmVzb3VyY2VzICAgICAgLS0gSGlkZSByZXNvdXJjZXMgaW4gbmFtZXNwYWNlcyB3aGVyZSBuYW1lc3BhY2UuaXNTeXN0ZW0gPT09IHRydWUsIG9yIGEgbmFtZXNwYWNlIG1hbmFnZWQgYnkgZmxlZXQgKHBlciBpdHMgYW5ub3RhdGlvbikgYW5kIGhpZGUgdGhvc2UgbmFtZXNwYWNlcyBmcm9tIG5zL3Byb2plY3QgbGlzdCBhbmQgbnNmaWx0ZXIgKGRlZmF1bHQgZmFsc2UpCi8vICAgaGlkZU5hbWVzcGFjZUxvY2F0aW9uICAgIC0tIEhpZGUgdGhlIG5hbWVzcGFjZSBsaW5rIGluIHRoZSBSZXNvdXJjZURldGFpbCBtYXN0aGVhZCBvZiBuYW1lc3BhY2VkIHJlc291cmNlcyBhbmQgaGlkZSB0aGUgRXhwbG9yZXJQcm9qZWN0c05hbWVzcGFjZXMgbmFtZXNwYWNlIGxpbmsgKGRlZmF1bHQgZmFsc2UpCi8vIH0pCi8vCi8vIGV4dGVybmFsTGluayhzdHJpbmdPckZuKSAgVGhlIHByb2R1Y3QgaGFzIGFuIGV4dGVybmFsIHBhZ2UgKGZ1bmN0aW9uIGdldHMgY29udGV4dCBvYmplY3QKLy8KLy8gdmlydHVhbFR5cGUob2JqKSAgICAgICAgICAgQWRkIGFuIGl0ZW0gdG8gdGhlIHRyZWUgdGhhdCBnb2VzIHRvIGEgcm91dGUgaW5zdGVhZCBvZiBhbiBhY3R1YWwgdHlwZS4KLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0gIG9iaiBjYW4gY29udGFpbiBhbnl0aGluZyBpbiB0aGUgb2JqZWN0cyBnZXRUcmVlIHJldHVybnMuCi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tICBvYmogbXVzdCBoYXZlIGEgYG5hbWVgIHRoYXQgaXMgdW5pcXVlIGFtb25nIGFsbCB2aXJ0dWFsIHR5cGVzLgovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLSBgY2x1c3RlcmAgaXMgYXV0b21hdGljYWxseSBhZGRlZCB0byByb3V0ZS5wYXJhbXMgaWYgaXQgZXhpc3RzLgovLwovLyBzcG9vZmVkVHlwZShvYmopICAgICAgICAgICBDcmVhdGUgYSBmYWtlIHR5cGUgdGhhdCBjYW4gYmUgdHJlYXRlZCBsaWtlIGEgbm9ybWFsIHR5cGUKLy8KLy8gYmFzaWNUeXBlKCAgICAgICAgICAgICAgICAgTWFyayB0eXBlKHMpIGFzIGFsd2F5cyBzaG93biBpbiB0aGUgdG9wIG9mIHRoZSBuYXYKLy8gICB0eXBlKHMpLCAgICAgICAgICAgICAgICAgLS0gVHlwZSBuYW1lIG9yIGFycmF5IG9mIHR5cGUgbmFtZXMKLy8gICBncm91cCAgICAgICAgICAgICAgICAgICAgLS0gR3JvdXAgdG8gc2hvdyB0aGUgdHlwZShzKSB1bmRlcjsgZmFsc2UteSBmb3IgdG9wLWxldmVsLgovLyApCi8vIGJhc2ljVHlwZSggICAgICAgICAgICAgICAgIE1hcmsgYWxsIHR5cGVzIGluIGdyb3VwIGFzIGFsd2F5cyBzaG93biBpbiB0aGUgdG9wIG9mIHRoZSBuYXYKLy8gICBncm91cCwgICAgICAgICAgICAgICAgICAgLS0gR3JvdXAgdG8gc2hvdwovLyAgIGFzTGFiZWwgICAgICAgICAgICAgICAgICAtLSBMYWJlbCB0byBkaXNwbGF5IHRoZSBncm91cCBhczsgZmFsc2UteSBmb3IgdG9wLWxldmVsLgovLyApCi8vIGlnbm9yZVR5cGUodHlwZSkgICAgICAgICAgIE5ldmVyIHNob3cgdHlwZQovLyB3ZWlnaHRUeXBlKCAgICAgICAgICAgICAgICBTZXQgdGhlIHdlaWdodCAoc29ydGluZykgb3JkZXIgb2Ygb25lIG9yIG1vcmUgdHlwZXMKLy8gICB0eXBlT3JBcnJheU9mVHlwZXMsCi8vICAgd2VpZ2h0LCAgICAgICAgICAgICAgICAgIC0tIEhpZ2hlciBudW1iZXJzIGFyZSBzaG93biBmaXJzdC9oaWdoZXIgdXAgb24gdGhlIG5hdiB0cmVlCi8vICAgZm9yQmFzaWMgICAgICAgICAgICAgICAgIC0tIEFwcGx5IHRvIGJhc2ljIHR5cGUgaW5zdGVhZCBvZiByZWd1bGFyIHR5cGUgdHJlZQovLyApCi8vIG1hcFR5cGUoICAgICAgICAgICAgICAgICAgIFJlbWFwIGEgdHlwZSBpZCB0byBhIGRpc3BsYXkgbmFtZQovLyAgIG1hdGNoUmVnZXhPclN0cmluZywgICAgICAtLSBUeXBlIHRvIG1hdGNoLCBvciByZWdleCB0aGF0IG1hdGNoZXMgdHlwZXMKLy8gICByZXBsYWNlbWVudFN0cmluZ09yRm4sICAgLS0gU3RyaW5nIHRvIHJlcGxhY2UgdGhlIHR5cGUgd2l0aCwgb3IKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0gc3luYyBmdW5jdGlvbjogKHR5cGUsIGNhcHR1cmVkU3RyaW5nLCBzY2hlbWFPYmogPT4geyByZXR1cm4gJ25ldy10eXBlJzsgfQovLyAgIG1hcFdlaWdodCwgICAgICAgICAgICAgICAtLSBQcmlvcml0eSBmb3IgYXBwbHkgdGhpcyBtYXBwaW5nIChoaWdoZXIgbnVtYmVycyBhcHBsaWVkIGZpcnN0KQovLyAgIGNvbnRpbnVlT25NYXRjaCAgICAgICAgICAtLSBJZiB0cnVlLCBjb250aW51ZSBhcHBseWluZyB0byBoaXQgb3RoZXIgcnVsZXMgdGhhdCBtaWdodCBtYXRjaCB0aGUgbmV3IHR5cGUuCi8vICkKLy8gbW92ZVR5cGUoICAgICAgICAgICAgICAgICAgQ2hhbmdlIHRoZSBncm91cCBhIHR5cGUgaXMgaW4KLy8gICBtYXRjaFJlZ2V4T3JTdHJpbmcsICAgICAgLS0gVHlwZSB0byBtYXRjaCwgb3IgcmVnZXggdGhhdCBtYXRjaGVzIHR5cGVzCi8vICAgbmV3R3JvdXAsICAgICAgICAgICAgICAgIC0tIEdyb3VwIHRvIG1vdmUgdGhlIHR5cGUgaW50bwovLyAgIG1hcFdlaWdodCwgICAgICAgICAgICAgICAtLSBQcmlvcml0eSBmb3IgYXBwbHkgdGhpcyBtYXBwaW5nIChoaWdoZXIgbnVtYmVycyBhcHBsaWVkIGZpcnN0KQovLyApCi8vIGNvbXBvbmVudEZvclR5cGUoICAgICAgICAgIE1hcCBtYXRjaGluZyB0eXBlcyB0byBhIHNpbmdsZSBjb21wb25lbnQgbmFtZQovLyAoICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcyBpcyBoZWxwZnVsIGlmIG11bHRpcGxlIHR5cGVzIHNob3VsZCBiZSByZW5kZXJlZCBieSBhIHNpbmdsZSBjb21wb25lbnQpCi8vICAgbWF0Y2hSZWdleE9yU3RyaW5nLCAgICAgIC0tIFR5cGUgdG8gbWF0Y2gsIG9yIHJlZ2V4IHRoYXQgbWF0Y2hlcyB0eXBlcwovLyAgIHJlcGxhY2VtZW50U3RyaW5nICAgICAgICAtLSBTdHJpbmcgdG8gcmVwbGFjZSB0aGUgdHlwZSB3aXRoCi8vICkKLy8gY29uZmlndXJlVHlwZSggICAgICAgICAgICBEaXNwbGF5IG9wdGlvbnMgZm9yIGEgcGFydGljdWxhciB0eXBlCi8vICAgdHlwZSwgICAgICAgICAgICAgICAgICAgIC0tIFR5cGUgdG8gYXBwbHkgdG8KLy8gIG9wdGlvbnMgICAgICAgICAgICAgICAgICAgLS0gT2JqZWN0IG9mIG9wdGlvbnMuICBEZWZhdWx0cy9TdXBwb3J0ZWQ6IHsKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNDcmVhdGFibGU6IHRydWUsIC0tIElmIGZhbHNlLCBkaXNhYmxlIGNyZWF0ZSBldmVuIGlmIHNjaGVtYSBzYXlzIGl0J3MgYWxsb3dlZAovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0VkaXRhYmxlOiB0cnVlLCAgLS0gRGl0dG8sIGZvciBlZGl0Ci8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzUmVtb3ZhYmxlOiB0cnVlLCAgLS0gRGl0dG8sIGZvciByZW1vdmUvZGVsZXRlCi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dTdGF0ZTogdHJ1ZSwgIC0tIElmIGZhbHNlLCBoaWRlIHN0YXRlIGluIGNvbHVtbnMgYW5kIG1hc3RoZWFkCi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dBZ2U6IHRydWUsICAgIC0tIElmIGZhbHNlLCBoaWRlIGFnZSBpbiBjb2x1bW5zIGFuZCBtYXN0aGVhZAovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93Q29uZmlnVmlldzogdHJ1ZSAtLSBJZiBmYWxzZSwgaGlkZSBtYXN0aGVhZCBjb25maWcgYnV0dG9uIGluIHZpZXcgbW9kZQovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93TGlzdE1hc3RoZWFkOiB0cnVlLCAtLSBJZiBmYWxzZSwgaGlkZSBtYXN0aGVhZCBpbiBsaXN0IHZpZXcKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuWWFtbDogdHJ1ZSwKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2U6IHVuZGVmaW5lZCAgICAgICAtLSBVc2UgdGhpcyByZXNvdXJjZSBpbiBSZXNvdXJjZURldGFpbHMgaW5zdGVhZAovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZURldGFpbDogdW5kZWZpbmVkIC0tIFVzZSB0aGlzIHJlc291cmNlIHNwZWNpZmljYWxseSBmb3IgUmVzb3VyY2VEZXRhaWwncyBkZXRhaWwgY29tcG9uZW50Ci8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlRWRpdDogdW5kZWZpbmVkICAgLS0gVXNlIHRoaXMgcmVzb3VyY2Ugc3BlY2lmaWNhbGx5IGZvciBSZXNvdXJjZURldGFpbCdzIGVkaXQgY29tcG9uZW50Ci8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlcGFnaW5hdGU6IHVuZGVmaW5lZCAtLSBVc2UgdGhpcyB0byBkZXBhZ2luYXRlIHJlcXVlc3RzIGZvciB0aGlzIHR5cGUKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VFZGl0TWFzdGhlYWQ6IHRydWUgICAtLSBTaG93IHRoZSBNYXN0aGVhZCBpbiB0aGUgZWRpdCByZXNvdXJjZSBjb21wb25lbnQKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tUm91dGU6IHVuZGVmaW5lZCwKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzR3JhcGg6IHVuZGVmaW5lZCAgIC0tIElmIHRydWUsIHJlbmRlciBGb3JjZURpcmVjdGVkVHJlZUNoYXJ0IGdyYXBoIChBVFRFTlRJT046IG9wdGlvbiBncmFwaENvbmZpZyBpcyBuZWVkZWQgYWxzbyEhISkKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JhcGhDb25maWc6IHVuZGVmaW5lZCAgIC0tIFVzZSB0aGlzIHRvIHBhc3MgYWxvbmcgdGhlIGdyYXBoIGNvbmZpZ3VyYXRpb24KLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm90RmlsdGVyTmFtZXNwYWNlOiAgdW5kZWZpbmVkIC0tIERlZmluZSBuYW1lc3BhY2VzIHRoYXQgZG8gbm90IG5lZWQgdG8gYmUgZmlsdGVyZWQKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxPbmx5OiBGYWxzZSAtLSBIaWRlIHRoaXMgdHlwZSBmcm9tIHRoZSBuYXYvc2VhcmNoIGJhciBvbiBkb3duc3RyZWFtIGNsdXN0ZXJzCi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgfQovLyApCi8vIGlnbm9yZUdyb3VwKGdyb3VwKTogICAgICAgIE5ldmVyIHNob3cgZ3JvdXAgb3IgYW55IHR5cGVzIGluIGl0Ci8vIHdlaWdodEdyb3VwKCAgICAgICAgICAgICAgIFNldCB0aGUgd2VpZ2h0IChzb3J0aW5nKSBvZiBvbmUgb3IgbW9yZSBncm91cHMKLy8gICBncm91cE9yQXJyYXlPZkdyb3VwcywgICAgLS0gc2VlIHdlaWdodFR5cGUuLi4KLy8gICB3ZWlnaHQKLy8gKQovLyBzZXRHcm91cERlZmF1bHRUeXBlKCAgICAgICBTZXQgdGhlIGRlZmF1bHQgY2hpbGQgdHlwZSB0byBzaG93IHdoZW4gdGhlIGdyb3VwIGlzIGV4cGFuZGVkCi8vICAgZ3JvdXBPckFycmF5T2ZHcm91cHMsICAgIC0tIHNlZSBzZXRHcm91cERlZmF1bHRUeXBlLi4uCi8vICAgZGVmYXVsdFR5cGUKLy8gKQovLyBtYXBHcm91cCggICAgICAgICAgICAgICAgICBSZW1hcCBhIGdyb3VwIG5hbWUgdG8gYSBkaXNwbGF5IG5hbWUKLy8gICBtYXRjaFJlZ2V4T3JTdHJpbmcsICAgICAgLS0gc2VlIG1hcFR5cGUuLi4KLy8gICByZXBsYWNlbWVudFN0cmluZywKLy8gICBtYXBXZWlnaHQsCi8vICAgY29udGludWVPbk1hdGNoCi8vICkKaW1wb3J0IHsgQUdFLCBOQU1FLCBOQU1FU1BBQ0UgYXMgTkFNRVNQQUNFX0NPTCwgU1RBVEUgfSBmcm9tICdAc2hlbGwvY29uZmlnL3RhYmxlLWhlYWRlcnMnOwppbXBvcnQgeyBDQVRBTE9HLCBDT1VOVCwgU0NIRU1BLCBNQU5BR0VNRU5ULCBOQU1FU1BBQ0UgfSBmcm9tICdAc2hlbGwvY29uZmlnL3R5cGVzJzsKaW1wb3J0IHsgVklFV19JTl9BUEksIEVYUEFOREVEX0dST1VQUywgRkFWT1JJVEVfVFlQRVMgfSBmcm9tICdAc2hlbGwvc3RvcmUvcHJlZnMnOwppbXBvcnQgeyBhZGRPYmplY3QsIGZpbmRCeSwgaXNBcnJheSwgcmVtb3ZlT2JqZWN0LCBmaWx0ZXJCeSB9IGZyb20gJ0BzaGVsbC91dGlscy9hcnJheSc7CmltcG9ydCB7IGNsb25lLCBnZXQgfSBmcm9tICdAc2hlbGwvdXRpbHMvb2JqZWN0JzsKaW1wb3J0IHsgZW5zdXJlUmVnZXgsIGVzY2FwZUh0bWwsIGVzY2FwZVJlZ2V4LCB1Y0ZpcnN0LCBwbHVyYWxpemUgfSBmcm9tICdAc2hlbGwvdXRpbHMvc3RyaW5nJzsKaW1wb3J0IHsgaW1wb3J0Q2hhcnQsIGltcG9ydExpc3QsIGltcG9ydERldGFpbCwgaW1wb3J0RWRpdCwgbGlzdFByb2R1Y3RzLCBsb2FkUHJvZHVjdCwgaW1wb3J0Q3VzdG9tUHJvbXB0UmVtb3ZlLCByZXNvbHZlTGlzdCwgcmVzb2x2ZUVkaXQsIHJlc29sdmVXaW5kb3dDb21wb25lbnQsIGltcG9ydFdpbmRvd0NvbXBvbmVudCwgaW1wb3J0TG9naW4sIHJlc29sdmVDaGFydCwgcmVzb2x2ZURldGFpbCwgaW1wb3J0RGlhbG9nLCBpbXBvcnRNYWNoaW5lQ29uZmlnLCByZXNvbHZlTWFjaGluZUNvbmZpZ0NvbXBvbmVudCwgcmVzb2x2ZUNsb3VkQ3JlZGVudGlhbENvbXBvbmVudCwgaW1wb3J0Q2xvdWRDcmVkZW50aWFsIH0gZnJvbSAnQHNoZWxsL3V0aWxzL2R5bmFtaWMtaW1wb3J0ZXInOwppbXBvcnQgeyBOQU1FIGFzIEVYUExPUkVSIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy9wcm9kdWN0L2V4cGxvcmVyJzsKaW1wb3J0IGlzT2JqZWN0IGZyb20gJ2xvZGFzaC9pc09iamVjdCc7CmltcG9ydCB7IG5vcm1hbGl6ZVR5cGUgfSBmcm9tICdAc2hlbGwvcGx1Z2lucy9kYXNoYm9hcmQtc3RvcmUvbm9ybWFsaXplJzsKaW1wb3J0IHsgc29ydEJ5IH0gZnJvbSAnQHNoZWxsL3V0aWxzL3NvcnQnOwppbXBvcnQgeyBoYXZlVjJNb25pdG9yaW5nIH0gZnJvbSAnQHNoZWxsL3V0aWxzL21vbml0b3JpbmcnOwppbXBvcnQgeyBORVVfVkVDVE9SX05BTUVTUEFDRSB9IGZyb20gJ0BzaGVsbC9jb25maWcvcHJvZHVjdC9uZXV2ZWN0b3InOwppbXBvcnQgeyBjcmVhdGVIZWFkZXJzLCByb3dWYWx1ZUdldHRlciB9IGZyb20gJ0BzaGVsbC9zdG9yZS90eXBlLW1hcC51dGlscyc7CmV4cG9ydCBjb25zdCBOQU1FU1BBQ0VEID0gJ25hbWVzcGFjZWQnOwpleHBvcnQgY29uc3QgQ0xVU1RFUl9MRVZFTCA9ICdjbHVzdGVyJzsKZXhwb3J0IGNvbnN0IEJPVEggPSAnYm90aCc7CmV4cG9ydCBjb25zdCBUWVBFX01PREVTID0gewogIC8qKgogICAqIGFsbFR5cGVzIHVzYWdlOiBBbGwgcmVzb3VyY2UgdHlwZXMKICAgKgogICAqIGdldFRyZWUgdXNhZ2U6IFJlbW92ZSBpZ25vcmVkIHNjaGVtYXMsIHJlc291cmNlcyBub3QgYXBwbGljYWJsZSB0byBucywgZXRjCiAgICovCiAgQUxMOiAnYWxsJywKICAvKioKICAgKiBSZXByZXNlbnRzIHJlc291cmNlIHR5cGVzIHRoYXQgc2hvdWxkIGJlIHNob3duIGF0IHRoZSB0b3Agb2YgdGhlIHNpZGUgbmF2LgogICAqCiAgICogRm9yIGV4YW1wbGUgYWxsIGZpeGVkIHJlc291cmNlIHR5cGVzIGFib3ZlIGBNb3JlIFJlc291cmNlc2AgaW4gdGhlIGNsdXN0ZXIgZXhwbG9yZXIKICAgKgogICAqIFRoZXNlIHdpbGwgYWx3YXlzIGJlIHNob3duIGluIHRoZSBzaWRlIG5hdgogICAqCiAgICogYWxsVHlwZXMgdXNhZ2U6IFJlc291cmNlcyB0aGF0IGFyZSBpbiBhIGdyb3VwCiAgICoKICAgKiBnZXRUcmVlIHVzYWdlOiBSZW1vdmUgaWdub3JlZCBzY2hlbWFzLCByZXNvdXJjZXMgbm90IGFwcGxpY2FibGUgdG8gbnMsIGV0YwogICAqLwogIEJBU0lDOiAnYmFzaWMnLAogIC8qKgogICAqIFJlcHJlc2VudHMgYW55IHR5cGUgb2YgcmVzb3VyY2UgdHlwZSB0aGF0IGhhcyBiZWVuIGZhdm91cml0ZWQKICAgKgogICAqIFRoZXNlIHdpbGwgYWx3YXlzIGJlIHNob3duIGluIHRoZSBzaWRlIG5hdi4KICAgKgogICAqIGFsbFR5cGVzIHVzYWdlOiBSZXNvdXJjZSB0eXBlcyB0aGF0IGhhdmUgYmVlbiBmYXZvcml0ZWQKICAgKgogICAqIGdldFRyZWUgdXNhZ2U6IFJlbW92ZSBpZ25vcmVkIHNjaGVtYXMsIHJlc291cmNlcyBub3QgYXBwbGljYWJsZSB0byBucywgZXRjCiAgICovCiAgRkFWT1JJVEU6ICdmYXZvcml0ZScsCiAgLyoqCiAgICogUmVwcmVzZW50cyBubyB2aXJ0dWFsIG9yIHNwb29mZWQgdHlwZXMgdGhhdCBoYXZlIGEgY291bnQuCiAgICoKICAgKiBGb3IgZXhhbXBsZSB0aGUgYE1vcmUgUmVzb3VyY2VgIGluIHRoZSBjbHVzdGVyIGV4cGxvcmVyCiAgICoKICAgKiBUaGVzZSB3aWxsIGJlIHNob3duIGluIHRoZSBzaWRlIG5hdiBpZiB0aGVyZSBhcmUgcmVzb3VyY2VzIGluIHRoZSBucyBmaWx0ZXIgT1IgdGhlIHJlc291cmNlIGlzIG5vdCBuYW1lc3BhY2VzCiAgICoKICAgKiBhbGxUeXBlcyB1c2FnZTogQWxsIHJlc291cmNlIHR5cGVzIHRoYXQgYXJlIG5vdCB2aXJ0dWFsIG9yIHNwb29mZWQKICAgKgogICAqIGdldFRyZWUgdXNhZ2U6IFJlbW92ZSB0eXBlcyB3aXRoIG5vIGNvdW50cy4gUmVtb3ZlIGlnbm9yZWQgc2NoZW1hcywgcmVzb3VyY2VzIG5vdCBhcHBsaWNhYmxlIHRvIG5zLCBldGMKICAgKi8KICBVU0VEOiAndXNlZCcKfTsKZXhwb3J0IGNvbnN0IFJPT1QgPSAncm9vdCc7CmV4cG9ydCBjb25zdCBTUE9PRkVEX1BSRUZJWCA9ICdfX1tbc3Bvb2ZlZF1dX18nOwpleHBvcnQgY29uc3QgU1BPT0ZFRF9BUElfUFJFRklYID0gJ19fW1tzcG9vZmVkYXBpXV1fXyc7CmNvbnN0IGluc3RhbmNlTWV0aG9kcyA9IHt9Owpjb25zdCBncmFwaENvbmZpZ01hcCA9IHt9OwpleHBvcnQgY29uc3QgSUZfSEFWRSA9IHsKICBWMl9NT05JVE9SSU5HOiAndjItbW9uaXRvcmluZycsCiAgUFJPSkVDVDogJ3Byb2plY3QnLAogIE5PX1BST0pFQ1Q6ICduby1wcm9qZWN0JywKICBOT1RfVjFfSVNUSU86ICdub3QtdjEtaXN0aW8nLAogIE1VTFRJX0NMVVNURVI6ICdtdWx0aS1jbHVzdGVyJywKICBORVVWRUNUT1JfTkFNRVNQQUNFOiAnbmV1dmVjdG9yLW5hbWVzcGFjZScsCiAgQURNSU46ICdhZG1pbi11c2VyJywKICBNQ01fRElTQUJMRUQ6ICdtY20tZGlzYWJsZWQnLAogIE5PVF9TVEFOREFMT05FX0hBUlZFU1RFUjogJ25vdC1zdGFuZGFsb25lLWhhcnZlc3RlcicKfTsKZXhwb3J0IGZ1bmN0aW9uIERTTChzdG9yZSwgcHJvZHVjdCwgbW9kdWxlID0gJ3R5cGUtbWFwJykgewogIC8vIHN0b3JlLmNvbW1pdChgJHsgbW9kdWxlIH0vcHJvZHVjdGAsIHsgbmFtZTogcHJvZHVjdCB9KTsKCiAgcmV0dXJuIHsKICAgIHByb2R1Y3QoaW5PcHQpIHsKICAgICAgY29uc3Qgb3B0ID0gewogICAgICAgIG5hbWU6IHByb2R1Y3QsCiAgICAgICAgd2VpZ2h0OiAxLAogICAgICAgIGluU3RvcmU6ICdjbHVzdGVyJywKICAgICAgICBpbkV4cGxvcmVyOiBmYWxzZSwKICAgICAgICByZW1vdmFibGU6IHRydWUsCiAgICAgICAgc2hvd0NsdXN0ZXJTd2l0Y2hlcjogdHJ1ZSwKICAgICAgICBzaG93TmFtZXNwYWNlRmlsdGVyOiBmYWxzZSwKICAgICAgICBwdWJsaWM6IHRydWUsCiAgICAgICAgZmlsdGVyTW9kZTogJ25hbWVzcGFjZXMnLAogICAgICAgIC4uLmluT3B0CiAgICAgIH07CgogICAgICAvLyBDb252ZXJ0IHN0cmluZ3MgdG8gcmVnZXgncyAtIHdlIGRvIHRoaXMgb25jZSBoZXJlIGZvciBlZmZpY2llbmN5CiAgICAgIGZvciAoY29uc3QgayBvZiBbJ2lmSGF2ZUdyb3VwJywgJ2lmSGF2ZVR5cGUnXSkgewogICAgICAgIGlmIChvcHRba10pIHsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG9wdFtrXSkpIHsKICAgICAgICAgICAgb3B0W2tdID0gb3B0W2tdLm1hcChyID0+IHJlZ2V4VG9TdHJpbmcoZW5zdXJlUmVnZXgocikpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG9wdFtrXSA9IHJlZ2V4VG9TdHJpbmcoZW5zdXJlUmVnZXgob3B0W2tdKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHN0b3JlLmNvbW1pdChgJHttb2R1bGV9L3Byb2R1Y3RgLCBvcHQpOwogICAgfSwKICAgIGJhc2ljVHlwZSh0eXBlcywgZ3JvdXApIHsKICAgICAgLy8gU3VwcG9ydCBwYXNzaW5nIGluIGEgbWFwIG9mIHR5cGVzIGFuZCB1c2luZyBqdXN0IHRoZSB2YWx1ZXMKICAgICAgaWYgKCFpc0FycmF5KHR5cGVzKSAmJiB0eXBlcyAmJiBpc09iamVjdCh0eXBlcykpIHsKICAgICAgICB0eXBlcyA9IE9iamVjdC52YWx1ZXModHlwZXMpOwogICAgICB9CiAgICAgIHN0b3JlLmNvbW1pdChgJHttb2R1bGV9L2Jhc2ljVHlwZWAsIHsKICAgICAgICBwcm9kdWN0LAogICAgICAgIHR5cGVzLAogICAgICAgIGdyb3VwCiAgICAgIH0pOwogICAgfSwKICAgIC8vIFR5cGUtIGFuZCBHcm91cC1kZXBlbmRlbnQKICAgIGdyb3VwQnkodHlwZSwgZmllbGQpIHsKICAgICAgc3RvcmUuY29tbWl0KGAke21vZHVsZX0vZ3JvdXBCeWAsIHsKICAgICAgICB0eXBlLAogICAgICAgIGZpZWxkCiAgICAgIH0pOwogICAgfSwKICAgIGhlYWRlcnModHlwZSwgaGVhZGVycywgcGFnaW5hdGlvbkhlYWRlcnMgPSBbXSkgewogICAgICBoZWFkZXJzLmZvckVhY2goaGVhZGVyID0+IHsKICAgICAgICAvLyBJZiBvbiB0aGUgY2xpZW50LCB0aGVuIHVzZSB0aGUgdmFsdWUgZ2V0dGVyIGlmIHRoZXJlIGlzIG9uZQogICAgICAgIGlmIChoZWFkZXIuZ2V0VmFsdWUpIHsKICAgICAgICAgIC8vIHdlIG5lZWQgdG8gc3RvcmUgdGhlIC52YWx1ZSBwcm9wIGZvciB0aGUgYWR2YW5jZWQgZmlsdGVyaW5nCiAgICAgICAgICBoZWFkZXIudmFsdWVQcm9wID0gaGVhZGVyLnZhbHVlOwogICAgICAgICAgaGVhZGVyLnZhbHVlID0gaGVhZGVyLmdldFZhbHVlOwogICAgICAgIH0KICAgICAgICBkZWxldGUgaGVhZGVyLmdldFZhbHVlOwogICAgICB9KTsKICAgICAgc3RvcmUuY29tbWl0KGAke21vZHVsZX0vaGVhZGVyc2AsIHsKICAgICAgICB0eXBlLAogICAgICAgIGhlYWRlcnMKICAgICAgfSk7CiAgICAgIHN0b3JlLmNvbW1pdChgJHttb2R1bGV9L3BhZ2luYXRpb25IZWFkZXJzYCwgewogICAgICAgIHR5cGUsCiAgICAgICAgcGFnaW5hdGlvbkhlYWRlcnMKICAgICAgfSk7CiAgICB9LAogICAgaGlkZUJ1bGtBY3Rpb25zKHR5cGUsIGZpZWxkKSB7CiAgICAgIHN0b3JlLmNvbW1pdChgJHttb2R1bGV9L2hpZGVCdWxrQWN0aW9uc2AsIHsKICAgICAgICB0eXBlLAogICAgICAgIGZpZWxkCiAgICAgIH0pOwogICAgfSwKICAgIGNvbmZpZ3VyZVR5cGUobWF0Y2gsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMuZ3JhcGhDb25maWcpIHsKICAgICAgICBncmFwaENvbmZpZ01hcFttYXRjaF0gPSBvcHRpb25zLmdyYXBoQ29uZmlnOwogICAgICAgIGRlbGV0ZSBvcHRpb25zLmdyYXBoQ29uZmlnOwogICAgICB9CiAgICAgIHN0b3JlLmNvbW1pdChgJHttb2R1bGV9L2NvbmZpZ3VyZVR5cGVgLCB7CiAgICAgICAgLi4ub3B0aW9ucywKICAgICAgICBtYXRjaAogICAgICB9KTsKICAgIH0sCiAgICBjb21wb25lbnRGb3JUeXBlKG1hdGNoLCByZXBsYWNlKSB7CiAgICAgIHN0b3JlLmNvbW1pdChgJHttb2R1bGV9L2NvbXBvbmVudEZvclR5cGVgLCB7CiAgICAgICAgbWF0Y2gsCiAgICAgICAgcmVwbGFjZQogICAgICB9KTsKICAgIH0sCiAgICBpZ25vcmVUeXBlKHJlZ2V4T3JTdHJpbmcpIHsKICAgICAgc3RvcmUuY29tbWl0KGAke21vZHVsZX0vaWdub3JlVHlwZWAsIHJlZ2V4T3JTdHJpbmcpOwogICAgfSwKICAgIGlnbm9yZUdyb3VwKHJlZ2V4T3JTdHJpbmcsIGNiKSB7CiAgICAgIHN0b3JlLmNvbW1pdChgJHttb2R1bGV9L2lnbm9yZUdyb3VwYCwgewogICAgICAgIHJlZ2V4T3JTdHJpbmcsCiAgICAgICAgY2IKICAgICAgfSk7CiAgICB9LAogICAgd2VpZ2h0R3JvdXAoaW5wdXQsIHdlaWdodCwgZm9yQmFzaWMpIHsKICAgICAgaWYgKGlzQXJyYXkoaW5wdXQpKSB7CiAgICAgICAgc3RvcmUuY29tbWl0KGAke21vZHVsZX0vd2VpZ2h0R3JvdXBgLCB7CiAgICAgICAgICBncm91cHM6IGlucHV0LAogICAgICAgICAgd2VpZ2h0LAogICAgICAgICAgZm9yQmFzaWMKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzdG9yZS5jb21taXQoYCR7bW9kdWxlfS93ZWlnaHRHcm91cGAsIHsKICAgICAgICAgIGdyb3VwOiBpbnB1dCwKICAgICAgICAgIHdlaWdodCwKICAgICAgICAgIGZvckJhc2ljCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzZXRHcm91cERlZmF1bHRUeXBlKGlucHV0LCBkZWZhdWx0VHlwZSkgewogICAgICBpZiAoaXNBcnJheShpbnB1dCkpIHsKICAgICAgICBzdG9yZS5jb21taXQoYCR7bW9kdWxlfS9zZXRHcm91cERlZmF1bHRUeXBlYCwgewogICAgICAgICAgZ3JvdXBzOiBpbnB1dCwKICAgICAgICAgIGRlZmF1bHRUeXBlCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3RvcmUuY29tbWl0KGAke21vZHVsZX0vc2V0R3JvdXBEZWZhdWx0VHlwZWAsIHsKICAgICAgICAgIGdyb3VwOiBpbnB1dCwKICAgICAgICAgIGRlZmF1bHRUeXBlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICB3ZWlnaHRUeXBlKGlucHV0LCB3ZWlnaHQsIGZvckJhc2ljKSB7CiAgICAgIGlmIChpc0FycmF5KGlucHV0KSkgewogICAgICAgIHN0b3JlLmNvbW1pdChgJHttb2R1bGV9L3dlaWdodFR5cGVgLCB7CiAgICAgICAgICB0eXBlczogaW5wdXQsCiAgICAgICAgICB3ZWlnaHQsCiAgICAgICAgICBmb3JCYXNpYwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHN0b3JlLmNvbW1pdChgJHttb2R1bGV9L3dlaWdodFR5cGVgLCB7CiAgICAgICAgICB0eXBlOiBpbnB1dCwKICAgICAgICAgIHdlaWdodCwKICAgICAgICAgIGZvckJhc2ljCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBtYXBHcm91cChtYXRjaCwgcmVwbGFjZSwgd2VpZ2h0ID0gNSwgY29udGludWVPbk1hdGNoID0gZmFsc2UpIHsKICAgICAgc3RvcmUuY29tbWl0KGAke21vZHVsZX0vbWFwR3JvdXBgLCB7CiAgICAgICAgbWF0Y2gsCiAgICAgICAgcmVwbGFjZSwKICAgICAgICB3ZWlnaHQsCiAgICAgICAgY29udGludWVPbk1hdGNoCiAgICAgIH0pOwogICAgfSwKICAgIG1hcFR5cGUobWF0Y2gsIHJlcGxhY2UsIHdlaWdodCA9IDUsIGNvbnRpbnVlT25NYXRjaCA9IGZhbHNlKSB7CiAgICAgIHN0b3JlLmNvbW1pdChgJHttb2R1bGV9L21hcFR5cGVgLCB7CiAgICAgICAgbWF0Y2gsCiAgICAgICAgcmVwbGFjZSwKICAgICAgICB3ZWlnaHQsCiAgICAgICAgY29udGludWVPbk1hdGNoCiAgICAgIH0pOwogICAgfSwKICAgIG1vdmVUeXBlKG1hdGNoLCBncm91cCwgd2VpZ2h0ID0gNSwgY29udGludWVPbk1hdGNoID0gZmFsc2UpIHsKICAgICAgc3RvcmUuY29tbWl0KGAke21vZHVsZX0vbW92ZVR5cGVgLCB7CiAgICAgICAgbWF0Y2gsCiAgICAgICAgZ3JvdXAsCiAgICAgICAgd2VpZ2h0CiAgICAgIH0pOwogICAgfSwKICAgIHZpcnR1YWxUeXBlKG9iaikgewogICAgICBzdG9yZS5jb21taXQoYCR7bW9kdWxlfS92aXJ0dWFsVHlwZWAsIHsKICAgICAgICBwcm9kdWN0LAogICAgICAgIG9iagogICAgICB9KTsKICAgIH0sCiAgICBzcG9vZmVkVHlwZShvYmopIHsKICAgICAgc3RvcmUuY29tbWl0KGAke21vZHVsZX0vc3Bvb2ZlZFR5cGVgLCB7CiAgICAgICAgcHJvZHVjdCwKICAgICAgICBvYmoKICAgICAgfSk7CiAgICB9CiAgfTsKfQpsZXQgY2FsbGVkID0gZmFsc2U7CmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhcHBseVByb2R1Y3RzKHN0b3JlLCAkcGx1Z2luKSB7CiAgaWYgKGNhbGxlZCkgewogICAgcmV0dXJuOwogIH0KICBjYWxsZWQgPSB0cnVlOwogIGZvciAoY29uc3QgcHJvZHVjdCBvZiBsaXN0UHJvZHVjdHMoKSkgewogICAgY29uc3QgaW1wbCA9IGF3YWl0IGxvYWRQcm9kdWN0KHByb2R1Y3QpOwogICAgaWYgKGltcGwgIT09IG51bGwgJiYgaW1wbCAhPT0gdm9pZCAwICYmIGltcGwuaW5pdCkgewogICAgICBpbXBsLmluaXQoc3RvcmUpOwogICAgfQogIH0KICAvLyBMb2FkIHRoZSBwcm9kdWN0cyBmcm9tIGFsbCBwbHVnaW5zCiAgJHBsdWdpbi5sb2FkUHJvZHVjdHMoKTsKfQpleHBvcnQgZnVuY3Rpb24gcHJvZHVjdHNMb2FkZWQoKSB7CiAgcmV0dXJuIGNhbGxlZDsKfQpleHBvcnQgY29uc3Qgc3RhdGUgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHsKICAgIHByb2R1Y3RzOiBbXSwKICAgIHZpcnR1YWxUeXBlczoge30sCiAgICBzcG9vZmVkVHlwZXM6IHt9LAogICAgYmFzaWNUeXBlczoge30sCiAgICBncm91cElnbm9yZTogW10sCiAgICBncm91cFdlaWdodHM6IHt9LAogICAgZ3JvdXBEZWZhdWx0VHlwZXM6IHt9LAogICAgYmFzaWNHcm91cFdlaWdodHM6IHsKICAgICAgW1JPT1RdOiAxMDAwCiAgICB9LAogICAgZ3JvdXBNYXBwaW5nczogW10sCiAgICB0eXBlSWdub3JlOiBbXSwKICAgIGJhc2ljVHlwZVdlaWdodHM6IHt9LAogICAgdHlwZVdlaWdodHM6IHt9LAogICAgdHlwZU1hcHBpbmdzOiBbXSwKICAgIHR5cGVNb3ZlTWFwcGluZ3M6IFtdLAogICAgdHlwZVRvQ29tcG9uZW50TWFwcGluZ3M6IFtdLAogICAgdHlwZU9wdGlvbnM6IFtdLAogICAgZ3JvdXBCeToge30sCiAgICBoZWFkZXJzOiB7fSwKICAgIHBhZ2luYXRpb25IZWFkZXJzOiB7fSwKICAgIGhpZGVCdWxrQWN0aW9uczoge30sCiAgICBzY2hlbWFHZW5lcmF0aW9uOiAxLAogICAgY2FjaGU6IHsKICAgICAgdHlwZU1vdmU6IHt9LAogICAgICBncm91cExhYmVsOiB7fSwKICAgICAgaWdub3JlOiB7fSwKICAgICAgbGlzdDoge30sCiAgICAgIGNoYXJ0OiB7fSwKICAgICAgZGV0YWlsOiB7fSwKICAgICAgZWRpdDoge30sCiAgICAgIGNvbXBvbmVudEZvcjoge30sCiAgICAgIHByb21wdFJlbW92ZToge30sCiAgICAgIHdpbmRvd0NvbXBvbmVudHM6IHt9LAogICAgICAnbWFjaGluZS1jb25maWcnOiB7fSwKICAgICAgJ2Nsb3VkLWNyZWRlbnRpYWwnOiB7fQogICAgfQogIH07Cn07CmV4cG9ydCBjb25zdCBnZXR0ZXJzID0gewogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAvLyAxICkgR2V0dGluZyBpbmZvCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIC8vIFR1cm5zIGEgdHlwZSBuYW1lIGludG8gYSBkaXNwbGF5IGxhYmVsIChlLmcuIG1hbmFnZW1lbnQuY2F0dGxlLmlvLmNsdXN0ZXIgLT4gQ2x1c3RlcikKICBsYWJlbEZvcihzdGF0ZSwgZ2V0dGVycywgcm9vdFN0YXRlLCByb290R2V0dGVycykgewogICAgcmV0dXJuIChzY2hlbWEsIGNvdW50ID0gMSwgbGFuZ3VhZ2UgPSBudWxsKSA9PiB7CiAgICAgIHJldHVybiBfYXBwbHlNYXBwaW5nKHNjaGVtYSwgc3RhdGUudHlwZU1hcHBpbmdzLCAnaWQnLCBmYWxzZSwgKCkgPT4gewogICAgICAgIHZhciBfc2NoZW1hJGF0dHJpYnV0ZXM7CiAgICAgICAgLy8gaTE4bi11c2VzIHR5cGVMYWJlbC4qCiAgICAgICAgY29uc3Qga2V5ID0gYHR5cGVMYWJlbC4iJHtzY2hlbWEuaWQudG9Mb3dlckNhc2UoKX0iYDsKICAgICAgICBpZiAocm9vdEdldHRlcnNbJ2kxOG4vZXhpc3RzJ10oa2V5LCBsYW5ndWFnZSkpIHsKICAgICAgICAgIHJldHVybiByb290R2V0dGVyc1snaTE4bi90J10oa2V5LCB7CiAgICAgICAgICAgIGNvdW50CiAgICAgICAgICB9LCBsYW5ndWFnZSkudHJpbSgpOwogICAgICAgIH0KICAgICAgICBjb25zdCBvdXQgPSAoc2NoZW1hID09PSBudWxsIHx8IHNjaGVtYSA9PT0gdm9pZCAwIHx8IChfc2NoZW1hJGF0dHJpYnV0ZXMgPSBzY2hlbWEuYXR0cmlidXRlcykgPT09IG51bGwgfHwgX3NjaGVtYSRhdHRyaWJ1dGVzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfc2NoZW1hJGF0dHJpYnV0ZXMua2luZCkgfHwgc2NoZW1hLmlkIHx8ICc/JzsKCiAgICAgICAgLy8gQWRkIHNwYWNlcywgYnV0IGJyZWFrcyB0eXBpbmcgbmFtZXMgaW50byBqdW1wIG1lbnUgbmF0dXJhbGx5CiAgICAgICAgLy8gb3V0ID0gdWNGaXJzdChvdXQucmVwbGFjZSgvKFthLXpdKShbQS1aXSkvZywnJDEgJDInKSk7CgogICAgICAgIGlmIChjb3VudCA9PT0gMSkgewogICAgICAgICAgcmV0dXJuIG91dDsKICAgICAgICB9CgogICAgICAgIC8vIFRoaXMgd29ya3MgZm9yIG1vc3QgdGhpbmdzLi4uIGlmIHlvdSBkb24ndCBsaWtlIGl0LCBwdXQgaW4gYSB0eXBlTGFiZWwgdHJhbnNsYXRpb24gZm9yIGFib3ZlLgogICAgICAgIHJldHVybiBwbHVyYWxpemUob3V0KTsKICAgICAgfSk7CiAgICB9OwogIH0sCiAgLy8gVHVybnMgYSBncm91cCBuYW1lIGludG8gYSBkaXNwbGF5IGxhYmVsIChlLmcuIG1hbmFnZW1lbnQuY2F0dGxlLmlvLnYzLmNsdXN0ZXIgLT4gQ2x1c3RlcikKICBncm91cExhYmVsRm9yKHN0YXRlKSB7CiAgICByZXR1cm4gc2NoZW1hT3JOYW1lID0+IHsKICAgICAgbGV0IGdyb3VwID0gc2NoZW1hT3JOYW1lOwogICAgICBpZiAodHlwZW9mIHNjaGVtYU9yTmFtZSA9PT0gJ29iamVjdCcpIHsKICAgICAgICBsZXQgbW92ZWQgPSBmYWxzZTsKICAgICAgICBmb3IgKGNvbnN0IHJ1bGUgb2Ygc3RhdGUudHlwZU1vdmVNYXBwaW5ncykgewogICAgICAgICAgY29uc3QgcmUgPSBzdHJpbmdUb1JlZ2V4KHJ1bGUubWF0Y2gpOwogICAgICAgICAgaWYgKHNjaGVtYU9yTmFtZS5pZC5tYXRjaChyZSkpIHsKICAgICAgICAgICAgbW92ZWQgPSB0cnVlOwogICAgICAgICAgICBncm91cCA9IHJ1bGUucmVwbGFjZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFtb3ZlZCkgewogICAgICAgICAgZ3JvdXAgPSBncm91cC5hdHRyaWJ1dGVzLmdyb3VwOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAodHlwZW9mIGdyb3VwICE9PSAnc3RyaW5nJykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IG91dCA9IF9hcHBseU1hcHBpbmcoZ3JvdXAsIHN0YXRlLmdyb3VwTWFwcGluZ3MsIG51bGwsIHN0YXRlLmNhY2hlLmdyb3VwTGFiZWwsIGdyb3VwID0+IHsKICAgICAgICBjb25zdCBtYXRjaCA9IGdyb3VwLm1hdGNoKC9eKC4qKVwuazhzXC5pbyQvKTsKICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgIHJldHVybiBtYXRjaFsxXS5zcGxpdCgvXC4vKS5tYXAoeCA9PiB1Y0ZpcnN0KHgpKS5qb2luKCcuJyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBncm91cDsKICAgICAgfSk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9OwogIH0sCiAgZ3JvdXBGb3JCYXNpY1R5cGUoc3RhdGUpIHsKICAgIHJldHVybiAocHJvZHVjdCwgc2NoZW1hSWQpID0+IHsKICAgICAgdmFyIF9zdGF0ZSRiYXNpY1R5cGVzOwogICAgICByZXR1cm4gKF9zdGF0ZSRiYXNpY1R5cGVzID0gc3RhdGUuYmFzaWNUeXBlcykgPT09IG51bGwgfHwgX3N0YXRlJGJhc2ljVHlwZXMgPT09IHZvaWQgMCB8fCAoX3N0YXRlJGJhc2ljVHlwZXMgPSBfc3RhdGUkYmFzaWNUeXBlc1twcm9kdWN0XSkgPT09IG51bGwgfHwgX3N0YXRlJGJhc2ljVHlwZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zdGF0ZSRiYXNpY1R5cGVzW3NjaGVtYUlkXTsKICAgIH07CiAgfSwKICBvcHRpb25zRm9yKHN0YXRlLCBnZXR0ZXJzLCByb290U3RhdGUsIHJvb3RHZXR0ZXJzKSB7CiAgICBjb25zdCBkZWYgPSB7CiAgICAgIGlzQ3JlYXRhYmxlOiB0cnVlLAogICAgICBpc0VkaXRhYmxlOiB0cnVlLAogICAgICBpc1JlbW92YWJsZTogdHJ1ZSwKICAgICAgc2hvd1N0YXRlOiB0cnVlLAogICAgICBzaG93QWdlOiB0cnVlLAogICAgICBjYW5ZYW1sOiB0cnVlLAogICAgICBuYW1lc3BhY2VkOiBudWxsLAogICAgICBsaXN0R3JvdXBzOiBbXSwKICAgICAgbGlzdEdyb3Vwc1dpbGxPdmVycmlkZTogZmFsc2UsCiAgICAgIGxpc3RNYW5kYXRvcnlTb3J0OiBudWxsLAogICAgICBkZXBhZ2luYXRlOiBmYWxzZSwKICAgICAgY3VzdG9tUm91dGU6IHVuZGVmaW5lZCwKICAgICAgcmVzb3VyY2VFZGl0TWFzdGhlYWQ6IHRydWUKICAgIH07CiAgICByZXR1cm4gKHNjaGVtYU9yVHlwZSwgcGFnaW5hdGlvbikgPT4gewogICAgICB2YXIgX3NjaGVtYU9yVHlwZSQkY3R4OwogICAgICAvLyBOb3RlIC0gVGhpcyBjYW4gcnVuIGEgTE9UIHNvIG5lZWRzIHRvIGJlIHBlcmZvcm1hbnQKCiAgICAgIGlmICghc2NoZW1hT3JUeXBlKSB7CiAgICAgICAgcmV0dXJuIHt9OwogICAgICB9CiAgICAgIGNvbnN0IHR5cGUgPSB0eXBlb2Ygc2NoZW1hT3JUeXBlID09PSAnb2JqZWN0JyA/IHNjaGVtYU9yVHlwZS5pZCA6IHNjaGVtYU9yVHlwZTsKICAgICAgY29uc3QgZm91bmQgPSBzdGF0ZS50eXBlT3B0aW9ucy5maW5kKGVudHJ5ID0+IHsKICAgICAgICBjb25zdCByZSA9IHN0cmluZ1RvUmVnZXgoZW50cnkubWF0Y2gpOwogICAgICAgIHJldHVybiByZS50ZXN0KHR5cGUpOwogICAgICB9KTsKICAgICAgY29uc3Qgb3B0cyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZiwgZm91bmQgfHwge30pOwoKICAgICAgLy8gQXMgdGhpcyBydW5zIGEgbG90LCBhdm9pZCBhbnl0aGluZyB3ZSBkb24ndCBzdHJpY3RseSBuZWVkIChsaWtlIGdvaW5nIG91dCB0byBhbm90aGVyIHN0b3JlKQogICAgICBpZiAoIXBhZ2luYXRpb24pIHsKICAgICAgICByZXR1cm4gb3B0czsKICAgICAgfQogICAgICBjb25zdCBzdG9yZU9wdGlvbnNGb3IgPSBzY2hlbWFPclR5cGUgPT09IG51bGwgfHwgc2NoZW1hT3JUeXBlID09PSB2b2lkIDAgfHwgKF9zY2hlbWFPclR5cGUkJGN0eCA9IHNjaGVtYU9yVHlwZS4kY3R4KSA9PT0gbnVsbCB8fCBfc2NoZW1hT3JUeXBlJCRjdHggPT09IHZvaWQgMCB8fCAoX3NjaGVtYU9yVHlwZSQkY3R4ID0gX3NjaGVtYU9yVHlwZSQkY3R4LmdldHRlcnMpID09PSBudWxsIHx8IF9zY2hlbWFPclR5cGUkJGN0eCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3NjaGVtYU9yVHlwZSQkY3R4WydvcHRpb25zRm9yJ107CiAgICAgIGNvbnN0IHN0b3JlT3B0cyA9IHN0b3JlT3B0aW9uc0ZvciA/IHN0b3JlT3B0aW9uc0Zvcih7CiAgICAgICAgZ2V0dGVycywKICAgICAgICBzdGF0ZQogICAgICB9LCB7CiAgICAgICAgc2NoZW1hOiBzY2hlbWFPclR5cGUsCiAgICAgICAgcGFnaW5hdGlvbiwKICAgICAgICBvcHRzCiAgICAgIH0pIDoge307CiAgICAgIHJldHVybiB7CiAgICAgICAgLi4ub3B0cywKICAgICAgICAuLi5zdG9yZU9wdHMKICAgICAgfTsKICAgIH07CiAgfSwKICBpc0Zhdm9yaXRlKHN0YXRlLCBnZXR0ZXJzLCByb290U3RhdGUsIHJvb3RHZXR0ZXJzKSB7CiAgICByZXR1cm4gc2NoZW1hSWQgPT4gewogICAgICByZXR1cm4gcm9vdEdldHRlcnNbJ3ByZWZzL2dldCddKEZBVk9SSVRFX1RZUEVTKS5pbmNsdWRlcyhzY2hlbWFJZCkgfHwgZmFsc2U7CiAgICB9OwogIH0sCiAgdHlwZVdlaWdodEZvcihzdGF0ZSkgewogICAgcmV0dXJuICh0eXBlLCBmb3JCYXNpYykgPT4gewogICAgICB2YXIgX3R5cGU7CiAgICAgIHR5cGUgPSAoX3R5cGUgPSB0eXBlKSA9PT0gbnVsbCB8fCBfdHlwZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3R5cGUudG9Mb3dlckNhc2UoKTsKICAgICAgaWYgKGZvckJhc2ljKSB7CiAgICAgICAgcmV0dXJuIHN0YXRlLmJhc2ljVHlwZVdlaWdodHNbdHlwZV0gfHwgMDsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gc3RhdGUudHlwZVdlaWdodHNbdHlwZV0gfHwgMDsKICAgICAgfQogICAgfTsKICB9LAogIGdyb3VwV2VpZ2h0Rm9yKHN0YXRlKSB7CiAgICByZXR1cm4gKGdyb3VwLCBmb3JCYXNpYykgPT4gewogICAgICBncm91cCA9IGdyb3VwLnRvTG93ZXJDYXNlKCk7CiAgICAgIGlmIChmb3JCYXNpYykgewogICAgICAgIHJldHVybiBzdGF0ZS5iYXNpY0dyb3VwV2VpZ2h0c1tncm91cF0gfHwgMDsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gc3RhdGUuZ3JvdXBXZWlnaHRzW2dyb3VwXSB8fCAwOwogICAgICB9CiAgICB9OwogIH0sCiAgZ3JvdXBEZWZhdWx0VHlwZUZvcihzdGF0ZSkgewogICAgcmV0dXJuIGdyb3VwID0+IHsKICAgICAgZ3JvdXAgPSBncm91cC50b0xvd2VyQ2FzZSgpOwogICAgICByZXR1cm4gc3RhdGUuZ3JvdXBEZWZhdWx0VHlwZXNbZ3JvdXBdOwogICAgfTsKICB9LAogIGdldFRyZWUoc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSwgcm9vdEdldHRlcnMpIHsKICAgIC8vIE5hbWUgdGhlIGZ1bmN0aW9uIHNvIGl0J3MgZWFzaWx5IGlkZW50aWZpYWJsZSB3aGVuIHBlcmZvcm1hbmNlIHRyYWNpbmcKICAgIHJldHVybiBmdW5jdGlvbiBnZXRUcmVlKHByb2R1Y3RJZCwgbW9kZSwgYWxsVHlwZXMsIGNsdXN0ZXJJZCwgbmFtZXNwYWNlTW9kZSwgY3VycmVudFR5cGUsIHNlYXJjaCkgewogICAgICAvLyBnZXRUcmVlIGhhcyBmb3VyIG1vZGVzOgogICAgICAvLyAtIGBiYXNpY2AgbWF0Y2hlcyBkYXRhIHR5cGVzIHRoYXQgc2hvdWxkIGFsd2F5cyBiZSBzaG93biAoZXZlbiBpZiB0aGVyZSBhcmUgMCBvZiB0aGVtKS4KICAgICAgLy8gLSBgdXNlZGAgbWF0Y2hlcyB0aGUgZGF0YSB0eXBlcyB3aGVyZSB0aGVyZSBhcmUgbW9yZSB0aGFuIDAgb2YgdGhlbSBpbiB0aGUgY3VycmVudCBzZXQgb2YgbmFtZXNwYWNlcy4KICAgICAgLy8gLSBgYWxsYCBtYXRjaGVzIGFsbCB0eXBlcy4KICAgICAgLy8gLSBgZmF2b3JpdGVgIG1hdGNoZXMgc3RhcnJlZCB0eXBlcy4KICAgICAgLy8gbmFtZXNwYWNlTW9kZTogJ25hbWVzcGFjZWQnLCAnY2x1c3RlcicsIG9yICdib3RoJwogICAgICAvLyBuYW1lc3BhY2VzOiBudWxsIG1lYW5zIGFsbCwgb3RoZXJ3aXNlIGl0IHdpbGwgYmUgYW4gYXJyYXkgb2Ygc3BlY2lmaWMgbmFtZXNwYWNlcyB0byBpbmNsdWRlCiAgICAgIGNvbnN0IGlzQmFzaWMgPSBtb2RlID09PSBUWVBFX01PREVTLkJBU0lDOwogICAgICBsZXQgc2VhcmNoUmVnZXg7CiAgICAgIGlmIChzZWFyY2gpIHsKICAgICAgICBzZWFyY2hSZWdleCA9IG5ldyBSZWdFeHAoYF4oLiopKCR7ZXNjYXBlUmVnZXgoc2VhcmNoKX0pKC4qKSRgLCAnaScpOwogICAgICB9CiAgICAgIGNvbnN0IHJvb3QgPSB7CiAgICAgICAgY2hpbGRyZW46IFtdCiAgICAgIH07CgogICAgICAvLyBBZGQgdHlwZXMgZnJvbSBzaG9ydGVzdCB0byBsb25nZXN0IHNvIHRoYXQgcGFyZW50cwogICAgICAvLyBnZXQgYWRkZWQgYmVmb3JlIGNoaWxkcmVuCiAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhhbGxUeXBlcykuc29ydCgoYSwgYikgPT4gYS5sZW5ndGggLSBiLmxlbmd0aCk7CgogICAgICAvLyBTZXQgdGhlc2UgZm9yIGxhdGVyCiAgICAgIGNvbnN0IGN1cnJlbnRMb2NhbCA9IHJvb3RHZXR0ZXJzWydpMThuL2N1cnJlbnQnXSgpOwogICAgICBjb25zdCBkZWZhdWx0TG9jYWwgPSByb290R2V0dGVyc1snaTE4bi9kZWZhdWx0J10oKTsKICAgICAgZm9yIChjb25zdCB0eXBlIG9mIGtleXMpIHsKICAgICAgICB2YXIgX3R5cGVPYmokc2NoZW1hOwogICAgICAgIGNvbnN0IHR5cGVPYmogPSBhbGxUeXBlc1t0eXBlXTsKICAgICAgICBpZiAodHlwZU9iai5zY2hlbWEgJiYgZ2V0dGVycy5pc0lnbm9yZWQodHlwZU9iai5zY2hlbWEpKSB7CiAgICAgICAgICAvLyBTa2lwIGlnbm9yZWQgZ3JvdXBzICYgdHlwZXMKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBuYW1lc3BhY2VkID0gdHlwZU9iai5uYW1lc3BhY2VkOwogICAgICAgIGlmIChuYW1lc3BhY2VNb2RlID09PSBOQU1FU1BBQ0VEICYmICFuYW1lc3BhY2VkIHx8IG5hbWVzcGFjZU1vZGUgPT09IENMVVNURVJfTEVWRUwgJiYgbmFtZXNwYWNlZCkgewogICAgICAgICAgLy8gU2tpcCB0eXBlcyB0aGF0IGFyZSBub3QgdGhlIHJpZ2h0IG5hbWVzcGFjZSBtb2RlCiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgaW5TdG9yZSA9IHJvb3RHZXR0ZXJzLmN1cnJlbnRTdG9yZSh0eXBlT2JqLm5hbWUpOwogICAgICAgIGNvbnN0IGNvdW50ID0gcm9vdEdldHRlcnNbYCR7aW5TdG9yZX0vY291bnRgXSh0eXBlT2JqKTsKICAgICAgICBjb25zdCBncm91cEZvckJhc2ljVHlwZSA9IGdldHRlcnMuZ3JvdXBGb3JCYXNpY1R5cGUocHJvZHVjdElkLCB0eXBlT2JqLm5hbWUpOwogICAgICAgIGlmICh0eXBlT2JqLmlkID09PSBjdXJyZW50VHlwZSkgewogICAgICAgICAgLy8gSWYgdGhpcyBpcyB0aGUgdHlwZSBjdXJyZW50bHkgYmVpbmcgc2hvd24sIGFsd2F5cyBzaG93IGl0CiAgICAgICAgfSBlbHNlIGlmIChpc0Jhc2ljICYmICFncm91cEZvckJhc2ljVHlwZSkgewogICAgICAgICAgLy8gSWYgd2Ugd2FudCB0aGUgYmFzaWMgdHJlZSBvbmx5IHJldHVybiBiYXNpYyB0eXBlczsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gVFlQRV9NT0RFUy5VU0VEICYmIGNvdW50IDw9IDApIHsKICAgICAgICAgIC8vIElmIHRoZXJlJ3Mgbm9uZSBvZiB0aGlzIHR5cGUsIGlnbm9yZSB0aGlzIGVudHJ5IHdoZW4gdmlld2luZyBvbmx5IGluLXVzZSB0eXBlcwogICAgICAgICAgLy8gTm90ZTogY291bnQgaXMgc29tZXRpbWVzIG51bGwsIGluIGpzIGBudWxsIDw9IDBgIGlzIGB0cnVlYC4KICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBsYWJlbCA9IHR5cGVPYmoubGFiZWxLZXkgPyByb290R2V0dGVyc1snaTE4bi90J10odHlwZU9iai5sYWJlbEtleSkgfHwgdHlwZU9iai5sYWJlbCA6IHR5cGVPYmoubGFiZWw7CiAgICAgICAgY29uc3QgbGFiZWxEaXNwbGF5ID0gaGlnaGxpZ2h0TGFiZWwobGFiZWwsIGNvdW50LCB0eXBlT2JqLnNjaGVtYSk7CiAgICAgICAgaWYgKCFsYWJlbERpc3BsYXkpIHsKICAgICAgICAgIC8vIFNlYXJjaCBoYXBwZW5zIGluIGhpZ2hsaWdodCBhbmQgcmV0dXJucyBudWxsIGlmIG5vdCBmb3VuZAogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGxldCBncm91cDsKICAgICAgICBpZiAoaXNCYXNpYykgewogICAgICAgICAgZ3JvdXAgPSBfZW5zdXJlR3JvdXAocm9vdCwgZ3JvdXBGb3JCYXNpY1R5cGUsIHRydWUpOwogICAgICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gVFlQRV9NT0RFUy5GQVZPUklURSkgewogICAgICAgICAgZ3JvdXAgPSBfZW5zdXJlR3JvdXAocm9vdCwgJ3N0YXJyZWQnKTsKICAgICAgICAgIGdyb3VwLndlaWdodCA9IDEwMDA7CiAgICAgICAgfSBlbHNlIGlmIChtb2RlID09PSBUWVBFX01PREVTLlVTRUQpIHsKICAgICAgICAgIGdyb3VwID0gX2Vuc3VyZUdyb3VwKHJvb3QsIGBpblVzZTo6JHtnZXR0ZXJzLmdyb3VwTGFiZWxGb3IodHlwZU9iai5zY2hlbWEpfWApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBncm91cCA9IF9lbnN1cmVHcm91cChyb290LCB0eXBlT2JqLnNjaGVtYSB8fCB0eXBlT2JqLmdyb3VwIHx8IFJPT1QpOwogICAgICAgIH0KICAgICAgICBsZXQgcm91dGUgPSB0eXBlT2JqLnJvdXRlOwoKICAgICAgICAvLyBNYWtlIHRoZSBkZWZhdWx0IHJvdXRlIGlmIG9uZSBpc24ndCBzZXQKICAgICAgICBpZiAoIXJvdXRlKSB7CiAgICAgICAgICByb3V0ZSA9IHsKICAgICAgICAgICAgbmFtZTogJ2MtY2x1c3Rlci1wcm9kdWN0LXJlc291cmNlJywKICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgcHJvZHVjdDogcHJvZHVjdElkLAogICAgICAgICAgICAgIGNsdXN0ZXI6IGNsdXN0ZXJJZCwKICAgICAgICAgICAgICByZXNvdXJjZTogdHlwZU9iai5uYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgICB0eXBlT2JqLnJvdXRlID0gcm91dGU7CiAgICAgICAgfQoKICAgICAgICAvLyBDbHVzdGVyIElEIGFuZCBQcm9kdWN0IHNob3VsZCBhbHdheXMgYmUgc2V0CiAgICAgICAgaWYgKHJvdXRlICYmIHR5cGVvZiByb3V0ZSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgIHJvdXRlLnBhcmFtcyA9IHJvdXRlLnBhcmFtcyB8fCB7fTsKICAgICAgICAgIHJvdXRlLnBhcmFtcy5jbHVzdGVyID0gY2x1c3RlcklkOwogICAgICAgICAgcm91dGUucGFyYW1zLnByb2R1Y3QgPSBwcm9kdWN0SWQ7CiAgICAgICAgfQogICAgICAgIGdyb3VwLmNoaWxkcmVuLnB1c2goewogICAgICAgICAgbGFiZWwsCiAgICAgICAgICBsYWJlbERpc3BsYXksCiAgICAgICAgICBtb2RlOiB0eXBlT2JqLm1vZGUsCiAgICAgICAgICBleGFjdDogdHlwZU9iai5leGFjdCB8fCBmYWxzZSwKICAgICAgICAgICdleGFjdC1wYXRoJzogdHlwZU9ialsnZXhhY3QtcGF0aCddIHx8IGZhbHNlLAogICAgICAgICAgbmFtZXNwYWNlZCwKICAgICAgICAgIHJvdXRlLAogICAgICAgICAgbmFtZTogdHlwZU9iai5uYW1lLAogICAgICAgICAgd2VpZ2h0OiB0eXBlT2JqLndlaWdodCB8fCBnZXR0ZXJzLnR5cGVXZWlnaHRGb3IoKChfdHlwZU9iaiRzY2hlbWEgPSB0eXBlT2JqLnNjaGVtYSkgPT09IG51bGwgfHwgX3R5cGVPYmokc2NoZW1hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdHlwZU9iaiRzY2hlbWEuaWQpIHx8IGxhYmVsLCBpc0Jhc2ljKSwKICAgICAgICAgIG92ZXJ2aWV3OiAhIXR5cGVPYmoub3ZlcnZpZXcKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgLy8gUmVjdXJzaXZlbHkgc29ydCB0aGUgZ3JvdXBzCiAgICAgIF9zb3J0R3JvdXAocm9vdCwgbW9kZSk7CiAgICAgIHJldHVybiByb290LmNoaWxkcmVuOwoKICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgICAgZnVuY3Rpb24gX2Vuc3VyZUdyb3VwKHRyZWUsIHNjaGVtYU9yTmFtZSwgZm9yQmFzaWMgPSBmYWxzZSkgewogICAgICAgIGxldCBuYW1lID0gZ2V0dGVycy5ncm91cExhYmVsRm9yKHNjaGVtYU9yTmFtZSk7CiAgICAgICAgY29uc3QgaXNSb290ID0gbmFtZSA9PT0gUk9PVCB8fCBuYW1lLnN0YXJ0c1dpdGgoYCR7Uk9PVH06OmApOwogICAgICAgIGlmIChuYW1lICYmIG5hbWUuaW5jbHVkZXMoJzo6JykpIHsKICAgICAgICAgIGxldCBwYXJlbnQ7CiAgICAgICAgICBbcGFyZW50LCBuYW1lXSA9IG5hbWUuc3BsaXQoJzo6JywgMik7CiAgICAgICAgICB0cmVlID0gX2Vuc3VyZUdyb3VwKHRyZWUsIHBhcmVudCk7CiAgICAgICAgfQoKICAgICAgICAvLyBUcmFuc2xhdGUgaWYgYW4gZW50cnkgZXhpc3RzCiAgICAgICAgbGV0IGxhYmVsID0gbmFtZTsKICAgICAgICAvLyBpMThuLXVzZXMgbmF2Lmdyb3VwLioKICAgICAgICBjb25zdCBrZXkgPSBgbmF2Lmdyb3VwLiIke25hbWV9ImA7CiAgICAgICAgaWYgKHJvb3RHZXR0ZXJzWydpMThuL2V4aXN0cyddKGtleSkpIHsKICAgICAgICAgIGxhYmVsID0gcm9vdEdldHRlcnNbJ2kxOG4vdCddKGtleSk7CiAgICAgICAgfQogICAgICAgIGxldCBncm91cCA9IGZpbmRCeSh0cmVlLmNoaWxkcmVuLCAnbmFtZScsIG5hbWUpOwogICAgICAgIGlmICghZ3JvdXApIHsKICAgICAgICAgIGdyb3VwID0gewogICAgICAgICAgICBuYW1lLAogICAgICAgICAgICBsYWJlbCwKICAgICAgICAgICAgd2VpZ2h0OiBnZXR0ZXJzLmdyb3VwV2VpZ2h0Rm9yKG5hbWUsIGZvckJhc2ljKSwKICAgICAgICAgICAgZGVmYXVsdFR5cGU6IGdldHRlcnMuZ3JvdXBEZWZhdWx0VHlwZUZvcihuYW1lKQogICAgICAgICAgfTsKICAgICAgICAgIHRyZWUuY2hpbGRyZW4ucHVzaChncm91cCk7CiAgICAgICAgfQogICAgICAgIGlmIChpc1Jvb3QpIHsKICAgICAgICAgIGdyb3VwLmlzUm9vdCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmICghZ3JvdXAuY2hpbGRyZW4pIHsKICAgICAgICAgIGdyb3VwLmNoaWxkcmVuID0gW107CiAgICAgICAgfQogICAgICAgIHJldHVybiBncm91cDsKICAgICAgfQogICAgICBmdW5jdGlvbiBoaWdobGlnaHRMYWJlbChvcmlnaW5hbCwgY291bnQsIHNjaGVtYSkgewogICAgICAgIGxldCBsYWJlbCA9IGVzY2FwZUh0bWwob3JpZ2luYWwpOwogICAgICAgIGlmIChzZWFyY2hSZWdleCkgewogICAgICAgICAgbGV0IG1hdGNoID0gbGFiZWwubWF0Y2goc2VhcmNoUmVnZXgpOwogICAgICAgICAgaWYgKCFtYXRjaCkgewogICAgICAgICAgICBpZiAoY3VycmVudExvY2FsICE9PSBkZWZhdWx0TG9jYWwgJiYgc2NoZW1hKSB7CiAgICAgICAgICAgICAgY29uc3QgZGVmYXVsdExhYmVsID0gZ2V0dGVycy5sYWJlbEZvcihzY2hlbWEsIGNvdW50LCBkZWZhdWx0TG9jYWwpOwogICAgICAgICAgICAgIGlmIChkZWZhdWx0TGFiZWwgJiYgZGVmYXVsdExhYmVsICE9PSBsYWJlbCkgewogICAgICAgICAgICAgICAgbGFiZWwgKz0gYCAoJHtkZWZhdWx0TGFiZWx9KWA7CiAgICAgICAgICAgICAgICBtYXRjaCA9IGxhYmVsLm1hdGNoKHNlYXJjaFJlZ2V4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgICBsYWJlbCA9IGAke2VzY2FwZUh0bWwobWF0Y2hbMV0pfTxzcGFuIGNsYXNzPSJoaWdobGlnaHQiPiR7ZXNjYXBlSHRtbChtYXRjaFsyXSl9PC9zcGFuPiR7ZXNjYXBlSHRtbChtYXRjaFszXSl9YDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbGFiZWw7CiAgICAgIH0KICAgIH07CiAgfSwKICBpc1Nwb29mZWQoc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSwgcm9vdEdldHRlcnMpIHsKICAgIHJldHVybiAodHlwZSwgcHJvZHVjdCkgPT4gewogICAgICBwcm9kdWN0ID0gcHJvZHVjdCB8fCByb290R2V0dGVyc1sncHJvZHVjdElkJ107CiAgICAgIGNvbnN0IHByb2R1Y3RTcG9vZmVkVHlwZXMgPSBzdGF0ZS5zcG9vZmVkVHlwZXNbcHJvZHVjdF0gfHwgW107CiAgICAgIHJldHVybiBwcm9kdWN0U3Bvb2ZlZFR5cGVzLnNvbWUoc3QgPT4gc3QudHlwZSA9PT0gdHlwZSk7CiAgICB9OwogIH0sCiAgaXNWaXJ0dWFsKHN0YXRlLCBnZXR0ZXJzLCByb290U3RhdGUsIHJvb3RHZXR0ZXJzKSB7CiAgICByZXR1cm4gKG5hbWUsIHByb2R1Y3QpID0+IHsKICAgICAgcHJvZHVjdCA9IHByb2R1Y3QgfHwgcm9vdEdldHRlcnNbJ3Byb2R1Y3RJZCddOwogICAgICBjb25zdCBwcm9kdWN0VmlydHVhbFR5cGVzID0gc3RhdGUudmlydHVhbFR5cGVzW3Byb2R1Y3RdIHx8IFtdOwogICAgICByZXR1cm4gcHJvZHVjdFZpcnR1YWxUeXBlcy5zb21lKHN0ID0+IHN0Lm5hbWUgPT09IG5hbWUpOwogICAgfTsKICB9LAogIGdldFNwb29mZWRJbnN0YW5jZXMoc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSwgcm9vdEdldHRlcnMpIHsKICAgIHJldHVybiBhc3luYyAodHlwZSwgcHJvZHVjdCkgPT4gewogICAgICB2YXIgX2luc3RhbmNlTWV0aG9kcyRwcm9kOwogICAgICBwcm9kdWN0ID0gcHJvZHVjdCB8fCByb290R2V0dGVyc1sncHJvZHVjdElkJ107CiAgICAgIGNvbnN0IGdldEluc3RhbmNlcyA9ICgoX2luc3RhbmNlTWV0aG9kcyRwcm9kID0gaW5zdGFuY2VNZXRob2RzW3Byb2R1Y3RdKSA9PT0gbnVsbCB8fCBfaW5zdGFuY2VNZXRob2RzJHByb2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9pbnN0YW5jZU1ldGhvZHMkcHJvZFt0eXBlXSkgfHwgKCgpID0+IFtdKTsKICAgICAgY29uc3QgaW5zdGFuY2VzID0gYXdhaXQgZ2V0SW5zdGFuY2VzKCk7CiAgICAgIGluc3RhbmNlcy5mb3JFYWNoKGluc3RhbmNlID0+IHsKICAgICAgICB2YXIgX2luc3RhbmNlJGxpbmtzLCBfaW5zdGFuY2UkbGlua3MyLCBfaW5zdGFuY2UkbGlua3MzLCBfaW5zdGFuY2UkbGlua3M0OwogICAgICAgIGNvbnN0IHR5cGUgPSBpbnN0YW5jZS50eXBlOwogICAgICAgIGNvbnN0IGlkID0gaW5zdGFuY2UuaWQ7CiAgICAgICAgY29uc3QgbGluayA9IGAvJHtTUE9PRkVEX1BSRUZJWH0vJHt0eXBlfS8ke2lkfWA7CiAgICAgICAgY29uc3QgYXBpTGluayA9IGAvJHtTUE9PRkVEX0FQSV9QUkVGSVh9LyR7dHlwZX0vJHtpZH1gOwogICAgICAgIGluc3RhbmNlLmxpbmtzID0gewogICAgICAgICAgcmVtb3ZlOiAoKF9pbnN0YW5jZSRsaW5rcyA9IGluc3RhbmNlLmxpbmtzKSA9PT0gbnVsbCB8fCBfaW5zdGFuY2UkbGlua3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9pbnN0YW5jZSRsaW5rcy5yZW1vdmUpIHx8IGxpbmssCiAgICAgICAgICBzZWxmOiAoKF9pbnN0YW5jZSRsaW5rczIgPSBpbnN0YW5jZS5saW5rcykgPT09IG51bGwgfHwgX2luc3RhbmNlJGxpbmtzMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2luc3RhbmNlJGxpbmtzMi5zZWxmKSB8fCBsaW5rLAogICAgICAgICAgdXBkYXRlOiAoKF9pbnN0YW5jZSRsaW5rczMgPSBpbnN0YW5jZS5saW5rcykgPT09IG51bGwgfHwgX2luc3RhbmNlJGxpbmtzMyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2luc3RhbmNlJGxpbmtzMy51cGRhdGUpIHx8IGxpbmssCiAgICAgICAgICB2aWV3OiAoKF9pbnN0YW5jZSRsaW5rczQgPSBpbnN0YW5jZS5saW5rcykgPT09IG51bGwgfHwgX2luc3RhbmNlJGxpbmtzNCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2luc3RhbmNlJGxpbmtzNC52aWV3KSB8fCBhcGlMaW5rCiAgICAgICAgfTsKICAgICAgICBpbnN0YW5jZS5pc1Nwb29mZWQgPSB0cnVlOwogICAgICB9KTsKICAgICAgcmV0dXJuIGluc3RhbmNlczsKICAgIH07CiAgfSwKICBnZXRTcG9vZmVkSW5zdGFuY2Uoc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSwgcm9vdEdldHRlcnMpIHsKICAgIHJldHVybiBhc3luYyAodHlwZSwgcHJvZHVjdCwgaWQpID0+IHsKICAgICAgY29uc3QgcHJvZHVjdEluc3RhbmNlcyA9IGF3YWl0IGdldHRlcnMuZ2V0U3Bvb2ZlZEluc3RhbmNlcyh0eXBlLCBwcm9kdWN0KTsKICAgICAgcmV0dXJuIHByb2R1Y3RJbnN0YW5jZXMuZmluZChpbnN0YW5jZSA9PiBpbnN0YW5jZS5pZCA9PT0gaWQpOwogICAgfTsKICB9LAogIGFsbFNwb29mZWRUeXBlcyhzdGF0ZSwgZ2V0dGVycywgcm9vdFN0YXRlLCByb290R2V0dGVycykgewogICAgcmV0dXJuIE9iamVjdC52YWx1ZXMoc3RhdGUuc3Bvb2ZlZFR5cGVzKS5mbGF0KCk7CiAgfSwKICBzcG9vZmVkU2NoZW1hcyhzdGF0ZSwgZ2V0dGVycywgcm9vdFN0YXRlLCByb290R2V0dGVycykgewogICAgcmV0dXJuIHByb2R1Y3QgPT4gewogICAgICBjb25zdCB0eXBlcyA9IHN0YXRlLnNwb29mZWRUeXBlc1twcm9kdWN0XSB8fCBbXTsKICAgICAgcmV0dXJuIHR5cGVzLmZsYXRNYXAodHlwZSA9PiB7CiAgICAgICAgY29uc3Qgc2NoZW1hcyA9IHR5cGUuc2NoZW1hcyB8fCBbXTsKICAgICAgICByZXR1cm4gc2NoZW1hcy5tYXAoc2NoZW1hID0+ICh7CiAgICAgICAgICAuLi5zY2hlbWEsCiAgICAgICAgICBpc1Nwb29mZWQ6IHRydWUKICAgICAgICB9KSk7CiAgICAgIH0pOwogICAgfTsKICB9LAogIGFsbFNwb29mZWRTY2hlbWFzKHN0YXRlLCBnZXR0ZXJzLCByb290U3RhdGUsIHJvb3RHZXR0ZXJzKSB7CiAgICByZXR1cm4gZ2V0dGVycy5hbGxTcG9vZmVkVHlwZXMuZmxhdE1hcCh0eXBlID0+IHsKICAgICAgY29uc3Qgc2NoZW1hcyA9IHR5cGUuc2NoZW1hcyB8fCBbXTsKICAgICAgcmV0dXJuIHNjaGVtYXMubWFwKHNjaGVtYSA9PiAoewogICAgICAgIC4uLnNjaGVtYSwKICAgICAgICBpc1Nwb29mZWQ6IHRydWUKICAgICAgfSkpOwogICAgfSk7CiAgfSwKICAvKioKICAgKiBHaXZlbiBtYW55IHRoaW5ncywgY3JlYXRlIGEgbGlzdCBvZiBtZW51IGl0ZW1zIHBlciBzY2hlbWEgZ2l2ZW4gdGhlIG1vZGUKICAgKi8KICBhbGxUeXBlcyhzdGF0ZSwgZ2V0dGVycywgcm9vdFN0YXRlLCByb290R2V0dGVycykgewogICAgLy8gTmFtZSB0aGUgZnVuY3Rpb24gc28gaXQncyBlYXNpbHkgaWRlbnRpZmlhYmxlIHdoZW4gcGVyZm9ybWFuY2UgdHJhY2luZwogICAgcmV0dXJuIGZ1bmN0aW9uIGFsbFR5cGVzKHByb2R1Y3QsIG1vZGVzID0gW1RZUEVfTU9ERVMuQUxMXSkgewogICAgICB2YXIgX3N0YXRlJHByb2R1Y3RzJGZpbmQsIF9yb290R2V0dGVycyRjdXJyZW50QywgX3Jvb3RHZXR0ZXJzOwogICAgICBjb25zdCBtb2R1bGUgPSAoX3N0YXRlJHByb2R1Y3RzJGZpbmQgPSBzdGF0ZS5wcm9kdWN0cy5maW5kKHAgPT4gcC5uYW1lID09PSBwcm9kdWN0KSkgPT09IG51bGwgfHwgX3N0YXRlJHByb2R1Y3RzJGZpbmQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zdGF0ZSRwcm9kdWN0cyRmaW5kLmluU3RvcmU7CiAgICAgIGNvbnN0IHNjaGVtYXMgPSByb290R2V0dGVyc1tgJHttb2R1bGV9L2FsbGBdKFNDSEVNQSk7CiAgICAgIGNvbnN0IGlzTG9jYWwgPSAhKChfcm9vdEdldHRlcnMkY3VycmVudEMgPSByb290R2V0dGVycy5jdXJyZW50Q2x1c3RlcikgIT09IG51bGwgJiYgX3Jvb3RHZXR0ZXJzJGN1cnJlbnRDICE9PSB2b2lkIDAgJiYgX3Jvb3RHZXR0ZXJzJGN1cnJlbnRDLmlzTG9jYWwpOwogICAgICBjb25zdCBpc1JhbmNoZXIgPSByb290R2V0dGVycy5pc1JhbmNoZXI7CiAgICAgIGNvbnN0IGNvdW50cyA9ICgoX3Jvb3RHZXR0ZXJzID0gcm9vdEdldHRlcnNbYCR7bW9kdWxlfS9hbGxgXShDT1VOVCkpID09PSBudWxsIHx8IF9yb290R2V0dGVycyA9PT0gdm9pZCAwIHx8IChfcm9vdEdldHRlcnMgPSBfcm9vdEdldHRlcnNbMF0pID09PSBudWxsIHx8IF9yb290R2V0dGVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3Jvb3RHZXR0ZXJzLmNvdW50cykgfHwge307CiAgICAgIGNvbnN0IG91dCA9IHt9OwoKICAgICAgLy8gRm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMgdGhpcyBtdXN0IGJlIHN1cGVyIHF1aWNrIHRvIGl0ZXJhdGUgb3Zlci4KICAgICAgLy8gRm9yIGVhY2ggc2NoZW1hLi4uCiAgICAgIC8vIDEpIERldGVybWluZSBpZiBpdCdzIGFwcGxpY2FibGUgZ2l2ZW4gdGhlIG1vZGUKICAgICAgLy8gMikgRm9yIGVhY2ggYXBwbGljYWJsZSBtb2RlIGNyZWF0ZSBhIGBUeXBlYCBlbnRyeQogICAgICBmb3IgKGNvbnN0IHNjaGVtYSBvZiBzY2hlbWFzKSB7CiAgICAgICAgbGV0IHNjaGVtYU1vZGVzID0ge307CiAgICAgICAgbW9kZXMuZm9yRWFjaChtID0+IHsKICAgICAgICAgIHNjaGVtYU1vZGVzW21dID0gdHJ1ZTsKICAgICAgICB9KTsKICAgICAgICBjb25zdCBhdHRycyA9IHNjaGVtYS5hdHRyaWJ1dGVzIHx8IHt9OwogICAgICAgIGNvbnN0IHR5cGVPcHRpb25zID0gZ2V0dGVyc1snb3B0aW9uc0ZvciddKHNjaGVtYSk7CiAgICAgICAgc2NoZW1hTW9kZXNbVFlQRV9NT0RFUy5CQVNJQ10gPSBzY2hlbWFNb2Rlc1tUWVBFX01PREVTLkJBU0lDXSAmJiBnZXR0ZXJzLmdyb3VwRm9yQmFzaWNUeXBlKHByb2R1Y3QsIHNjaGVtYS5pZCk7CiAgICAgICAgaWYgKE9iamVjdC52YWx1ZXMoc2NoZW1hTW9kZXMpLmV2ZXJ5KHMgPT4gIXMpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgc2NoZW1hTW9kZXNbVFlQRV9NT0RFUy5GQVZPUklURV0gPSBzY2hlbWFNb2Rlc1tUWVBFX01PREVTLkZBVk9SSVRFXSAmJiBnZXR0ZXJzLmlzRmF2b3JpdGUoc2NoZW1hLmlkKTsKICAgICAgICBpZiAoT2JqZWN0LnZhbHVlcyhzY2hlbWFNb2RlcykuZXZlcnkocyA9PiAhcykpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBvbmx5QmFzaWMgPSBzY2hlbWFNb2Rlc1tUWVBFX01PREVTLkJBU0lDXSAmJiBtb2Rlcy5sZW5ndGggPT09IDE7CgogICAgICAgIC8vIFRoaXMgY2xhdXNlIGlzIG9ubHkgdmFsaWQgZm9yIG5vbi1iYXNpYyBtb2Rlcy4gU28gaWYgd2UgaGF2ZSBvbmx5IGJhc2ljLi4uIHNraXAgaXQKICAgICAgICBpZiAoIW9ubHlCYXNpYykgewogICAgICAgICAgY29uc3QgaW52YWxpZFR5cGUgPSAhYXR0cnMua2luZCB8fCB0eXBlb2YgdHlwZU9wdGlvbnMuaWZSYW5jaGVyQ2x1c3RlciAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZU9wdGlvbnMuaWZSYW5jaGVyQ2x1c3RlciAhPT0gaXNSYW5jaGVyIHx8IHR5cGVPcHRpb25zLmxvY2FsT25seSAmJiBpc0xvY2FsOwogICAgICAgICAgaWYgKGludmFsaWRUeXBlKSB7CiAgICAgICAgICAgIC8vIFJlbW92ZSBhbnl0aGluZyBub3QgYmFzaWMKICAgICAgICAgICAgc2NoZW1hTW9kZXMgPSB7CiAgICAgICAgICAgICAgW1RZUEVfTU9ERVMuQkFTSUNdOiBzY2hlbWFNb2Rlc1tUWVBFX01PREVTLkJBU0lDXQogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gVGhpcyBpcyBhbiBleHBlbnNpdmUgcmVxdWVzdCB0byBtYWtlLCBzbyBvbmx5IGRvIGl0IGlmIHdlIHJlYWxseSBuZWVkIHRvCiAgICAgICAgbGV0IGxhYmVsOwogICAgICAgIE9iamVjdC5lbnRyaWVzKHNjaGVtYU1vZGVzKS5mb3JFYWNoKChbbW9kZSwgZW5hYmxlZF0pID0+IHsKICAgICAgICAgIGlmICghZW5hYmxlZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIW91dFttb2RlXSkgewogICAgICAgICAgICBvdXRbbW9kZV0gPSB7fTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghbGFiZWwpIHsKICAgICAgICAgICAgbGFiZWwgPSBnZXR0ZXJzLmxhYmVsRm9yKHNjaGVtYSwgY291bnRzW3NjaGVtYS5pZF0pOwogICAgICAgICAgfQogICAgICAgICAgb3V0W21vZGVdW3NjaGVtYS5pZF0gPSB7CiAgICAgICAgICAgIGxhYmVsLAogICAgICAgICAgICBtb2RlLAogICAgICAgICAgICB3ZWlnaHQ6IGdldHRlcnMudHlwZVdlaWdodEZvcigoc2NoZW1hID09PSBudWxsIHx8IHNjaGVtYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2NoZW1hLmlkKSB8fCBsYWJlbCwgbW9kZSA9PT0gVFlQRV9NT0RFUy5CQVNJQyksCiAgICAgICAgICAgIHNjaGVtYSwKICAgICAgICAgICAgbmFtZTogc2NoZW1hLmlkLAogICAgICAgICAgICBuYW1lc3BhY2VkOiB0eXBlT3B0aW9ucy5uYW1lc3BhY2VkID09PSBudWxsID8gYXR0cnMubmFtZXNwYWNlZCA6IHR5cGVPcHRpb25zLm5hbWVzcGFjZWQsCiAgICAgICAgICAgIHJvdXRlOiB0eXBlT3B0aW9ucy5jdXN0b21Sb3V0ZQogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBjb25zdCBub25Vc2VkTW9kZXMgPSBtb2Rlcy5maWx0ZXIobSA9PiBtICE9PSBUWVBFX01PREVTLlVTRUQpOwogICAgICBjb25zdCBpc0RldiA9IHJvb3RHZXR0ZXJzWydwcmVmcy9nZXQnXShWSUVXX0lOX0FQSSk7CgogICAgICAvLyBBZGQgdmlydHVhbCBhbmQgc3Bvb2ZlZCB0eXBlcwogICAgICBpZiAobm9uVXNlZE1vZGVzLmxlbmd0aCkgewogICAgICAgIGNvbnN0IHZpcnR1YWxUeXBlcyA9IHN0YXRlLnZpcnR1YWxUeXBlc1twcm9kdWN0XSB8fCBbXTsKICAgICAgICBjb25zdCBzcG9vZmVkVHlwZXMgPSBzdGF0ZS5zcG9vZmVkVHlwZXNbcHJvZHVjdF0gfHwgW107CiAgICAgICAgY29uc3QgYWxsVHlwZXMgPSBbLi4udmlydHVhbFR5cGVzLCAuLi5zcG9vZmVkVHlwZXNdOwogICAgICAgIGZvciAoY29uc3QgdHlwZSBvZiBhbGxUeXBlcykgewogICAgICAgICAgY29uc3QgaXRlbSA9IGNsb25lKHR5cGUpOwogICAgICAgICAgY29uc3QgaWQgPSBpdGVtLm5hbWU7CiAgICAgICAgICBjb25zdCB2aXJ0U3Bvb2ZlZE1vZGVzID0gWy4uLm5vblVzZWRNb2Rlc107CgogICAgICAgICAgLy8gSXMgdGhlcmUgYSB2aXJ0dWFsL3Nwb29mZWQgdHlwZSBvdmVycmlkZSBmb3Igc2NoZW1hIHR5cGU/CiAgICAgICAgICAvLyBDdXJyZW50bHkgdXNlZCBieSBoYXJ2ZXN0ZXIsIHRoaXMgc2hvdWxkIGJlIGludmVzdGlnYXRlZCBhbmQgcmVtb3ZlZCBpZiBwb3NzaWJsZQogICAgICAgICAgdmlydFNwb29mZWRNb2Rlcy5mb3JFYWNoKG1vZGUgPT4gewogICAgICAgICAgICB2YXIgX291dCRtb2RlOwogICAgICAgICAgICBpZiAoKF9vdXQkbW9kZSA9IG91dFttb2RlXSkgIT09IG51bGwgJiYgX291dCRtb2RlICE9PSB2b2lkIDAgJiYgX291dCRtb2RlW2lkXSkgewogICAgICAgICAgICAgIGRlbGV0ZSBvdXRbbW9kZV1baWRdOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChpdGVtWydwdWJsaWMnXSA9PT0gZmFsc2UgJiYgIWlzRGV2KSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGl0ZW0uaWZIYXZlICYmICFpZkhhdmUocm9vdEdldHRlcnMsIGl0ZW0uaWZIYXZlKSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpdGVtLmlmSGF2ZVR5cGUpIHsKICAgICAgICAgICAgY29uc3QgaWZIYXZlVHlwZUFycmF5ID0gQXJyYXkuaXNBcnJheShpdGVtLmlmSGF2ZVR5cGUpID8gaXRlbS5pZkhhdmVUeXBlIDogW2l0ZW0uaWZIYXZlVHlwZV07CiAgICAgICAgICAgIGxldCBzYXRpc2ZpZXNJZkhhdmUgPSB0cnVlOwoKICAgICAgICAgICAgLy8gU3VwcG9ydCBhbiBhcnJheSBvZiByZXF1aXJlZCB0eXBlcyB0aGF0IHRoZSB1c2VyIG11c3QgaGF2ZSBhY2Nlc3MgdG8KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpZkhhdmVUeXBlQXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBjb25zdCBpZkhhdmVUeXBlID0gaWZIYXZlVHlwZUFycmF5W2ldOwogICAgICAgICAgICAgIGNvbnN0IHRhcmdldGVkU2NoZW1hcyA9IHR5cGVvZiBpZkhhdmVUeXBlID09PSAnc3RyaW5nJyA/IHNjaGVtYXMgOiByb290R2V0dGVyc1tgJHtpZkhhdmVUeXBlLnN0b3JlfS9hbGxgXShTQ0hFTUEpOwogICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSB0eXBlb2YgaWZIYXZlVHlwZSA9PT0gJ3N0cmluZycgPyBpZkhhdmVUeXBlIDogaWZIYXZlVHlwZSA9PT0gbnVsbCB8fCBpZkhhdmVUeXBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpZkhhdmVUeXBlLnR5cGU7CiAgICAgICAgICAgICAgY29uc3QgaGF2ZUlkcyA9IGZpbHRlckJ5KHRhcmdldGVkU2NoZW1hcywgJ2lkJywgbm9ybWFsaXplVHlwZSh0eXBlKSkubWFwKHMgPT4gcy5pZCk7CiAgICAgICAgICAgICAgaWYgKCFoYXZlSWRzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgc2F0aXNmaWVzSWZIYXZlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGl0ZW0uaWZIYXZlVmVyYiAmJiAhaWZIYXZlVmVyYihyb290R2V0dGVycywgbW9kdWxlLCBpdGVtLmlmSGF2ZVZlcmIsIGhhdmVJZHMpKSB7CiAgICAgICAgICAgICAgICBzYXRpc2ZpZXNJZkhhdmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXNhdGlzZmllc0lmSGF2ZSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaXRlbS5pZkhhdmVTdWJUeXBlcykgewogICAgICAgICAgICBjb25zdCBoYXNTb21lID0gKGl0ZW0uaWZIYXZlU3ViVHlwZXMgfHwgW10pLnNvbWUodHlwZSA9PiB7CiAgICAgICAgICAgICAgcmV0dXJuICEhZmluZEJ5KHNjaGVtYXMsICdpZCcsIG5vcm1hbGl6ZVR5cGUodHlwZSkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKCFoYXNTb21lKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmICh0eXBlb2YgaXRlbS5pZlJhbmNoZXJDbHVzdGVyICE9PSAndW5kZWZpbmVkJyAmJiBpdGVtLmlmUmFuY2hlckNsdXN0ZXIgIT09IHJvb3RHZXR0ZXJzLmlzUmFuY2hlcikgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpdGVtLmlmRmVhdHVyZSkgewogICAgICAgICAgICBpZiAoaXRlbS5pZkZlYXR1cmVbMF0gPT09ICchJykgewogICAgICAgICAgICAgIGNvbnN0IGZlYXR1cmUgPSBpdGVtLmlmRmVhdHVyZS5yZXBsYWNlKCchJywgJycpOwogICAgICAgICAgICAgIGlmIChyb290R2V0dGVyc1snZmVhdHVyZXMvZ2V0J10oZmVhdHVyZSkpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAoIXJvb3RHZXR0ZXJzWydmZWF0dXJlcy9nZXQnXShpdGVtLmlmRmVhdHVyZSkpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKHZpcnRTcG9vZmVkTW9kZXMuaW5jbHVkZXMoVFlQRV9NT0RFUy5CQVNJQykgJiYgIWdldHRlcnMuZ3JvdXBGb3JCYXNpY1R5cGUocHJvZHVjdCwgaWQpKSB7CiAgICAgICAgICAgIHZpcnRTcG9vZmVkTW9kZXMuc3BsaWNlKHZpcnRTcG9vZmVkTW9kZXMuaW5kZXhPZihUWVBFX01PREVTLkJBU0lDKSwgMSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodmlydFNwb29mZWRNb2Rlcy5pbmNsdWRlcyhUWVBFX01PREVTLkZBVk9SSVRFKSAmJiAhZ2V0dGVycy5pc0Zhdm9yaXRlKGlkKSkgewogICAgICAgICAgICAvLyBtb2RlID09PSBUWVBFX01PREVTLkZBVk9SSVRFICYmCiAgICAgICAgICAgIHZpcnRTcG9vZmVkTW9kZXMuc3BsaWNlKHZpcnRTcG9vZmVkTW9kZXMuaW5kZXhPZihUWVBFX01PREVTLkZBVk9SSVRFKSwgMSk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gRW5zdXJlIGxhYmVsS2V5IGlzIHRha2VuIGludG8gYWNjb3VudC4uLiB3aXRoIGEgbW9jayBjb3VudAogICAgICAgICAgLy8gVGhpcyBpcyBoYXJtbGVzcyBpZiB0aGUgdHJhbnNsYXRpb24gZG9lc24ndCByZXF1aXJlIGNvdW50CiAgICAgICAgICBpZiAoaXRlbS5sYWJlbEtleSAmJiByb290R2V0dGVyc1snaTE4bi9leGlzdHMnXShpdGVtLmxhYmVsS2V5KSkgewogICAgICAgICAgICBpdGVtLmxhYmVsID0gcm9vdEdldHRlcnNbJ2kxOG4vdCddKGl0ZW0ubGFiZWxLZXksIHsKICAgICAgICAgICAgICBjb3VudDogMgogICAgICAgICAgICB9KS50cmltKCk7CiAgICAgICAgICAgIGRlbGV0ZSBpdGVtLmxhYmVsS2V5OyAvLyBMYWJlbCBzaG91bGQgcmVhbGx5IHRha2UgcHJlY2VkZW5jZSBvdmVyIGxhYmVsS2V5LCBidXQgaXQgZG9lc24ndCwgc28gcmVtb3ZlIGl0CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpdGVtLmxhYmVsID0gaXRlbS5sYWJlbCB8fCBpdGVtLm5hbWU7CiAgICAgICAgICB9CiAgICAgICAgICB2aXJ0U3Bvb2ZlZE1vZGVzLmZvckVhY2gobW9kZSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGlzQmFzaWMgPSBtb2RlID09PSBUWVBFX01PREVTLkJBU0lDOwogICAgICAgICAgICBjb25zdCB3ZWlnaHQgPSB0eXBlLndlaWdodCB8fCBnZXR0ZXJzLnR5cGVXZWlnaHRGb3IoaXRlbS5sYWJlbCwgaXNCYXNpYyk7CiAgICAgICAgICAgIGl0ZW0ubW9kZSA9IG1vZGU7CiAgICAgICAgICAgIGl0ZW0ud2VpZ2h0ID0gd2VpZ2h0OwogICAgICAgICAgICBpZiAoIW91dFttb2RlXSkgewogICAgICAgICAgICAgIG91dFttb2RlXSA9IHt9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIG91dFttb2RlXVtpZF0gPSBpdGVtOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvdXQ7CiAgICB9OwogIH0sCiAgZ3JvdXBCeUZvcihzdGF0ZSkgewogICAgcmV0dXJuIHNjaGVtYSA9PiB7CiAgICAgIHJldHVybiBzdGF0ZS5ncm91cEJ5W3NjaGVtYSA9PT0gbnVsbCB8fCBzY2hlbWEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNjaGVtYS5pZF07CiAgICB9OwogIH0sCiAgaGlkZUJ1bGtBY3Rpb25zRm9yKHN0YXRlKSB7CiAgICByZXR1cm4gc2NoZW1hID0+IHsKICAgICAgcmV0dXJuIHN0YXRlLmhpZGVCdWxrQWN0aW9uc1tzY2hlbWEuaWRdOwogICAgfTsKICB9LAogIGhlYWRlcnNGb3Ioc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSwgcm9vdEdldHRlcnMpIHsKICAgIHJldHVybiAoc2NoZW1hLCBwYWdpbmF0aW9uKSA9PiB7CiAgICAgIGlmIChwYWdpbmF0aW9uKSB7CiAgICAgICAgdmFyIF9zY2hlbWEkJGN0eDsKICAgICAgICBjb25zdCBzdG9yZUhlYWRlcnNGb3IgPSBzY2hlbWEgPT09IG51bGwgfHwgc2NoZW1hID09PSB2b2lkIDAgfHwgKF9zY2hlbWEkJGN0eCA9IHNjaGVtYS4kY3R4KSA9PT0gbnVsbCB8fCBfc2NoZW1hJCRjdHggPT09IHZvaWQgMCB8fCAoX3NjaGVtYSQkY3R4ID0gX3NjaGVtYSQkY3R4LmdldHRlcnMpID09PSBudWxsIHx8IF9zY2hlbWEkJGN0eCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3NjaGVtYSQkY3R4WydoZWFkZXJzRm9yJ107CiAgICAgICAgaWYgKHN0b3JlSGVhZGVyc0ZvcikgewogICAgICAgICAgY29uc3QgcmVzID0gc3RvcmVIZWFkZXJzRm9yKHsKICAgICAgICAgICAgZ2V0dGVycywKICAgICAgICAgICAgc3RhdGUKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgc2NoZW1hLAogICAgICAgICAgICBwYWdpbmF0aW9uCiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChyZXMpIHsKICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGNyZWF0ZUhlYWRlcnMoewogICAgICAgIHJvb3RHZXR0ZXJzCiAgICAgIH0sIHsKICAgICAgICBoZWFkZXJzOiBzdGF0ZS5oZWFkZXJzLAogICAgICAgIHR5cGVPcHRpb25zOiBnZXR0ZXJzWydvcHRpb25zRm9yJ10oc2NoZW1hLCBmYWxzZSksCiAgICAgICAgc2NoZW1hLAogICAgICAgIGNvbHVtbnM6IHsKICAgICAgICAgIHN0YXRlOiBTVEFURSwKICAgICAgICAgIG5hbWU6IE5BTUUsCiAgICAgICAgICBuYW1lc3BhY2U6IE5BTUVTUEFDRV9DT0wsCiAgICAgICAgICBhZ2U6IEFHRQogICAgICAgIH0sCiAgICAgICAgcGFnaW5hdGlvbgogICAgICB9KTsKICAgIH07CiAgfSwKICAvKioKICAgKiBTaW1wbGUgZ2V0dGVyIHRvIGZldGNoIHByZS1jb25maWd1cmVkIGhlYWRlcnMgdXNlZCBpbiBwYWdpbmF0aW9uCiAgICovCiAgY29uZmlndXJlZFBhZ2luYXRpb25IZWFkZXJzKHN0YXRlKSB7CiAgICByZXR1cm4gc2NoZW1hT3JUeXBlID0+IHsKICAgICAgdmFyIF9zdGF0ZSRwYWdpbmF0aW9uSGVhZDsKICAgICAgcmV0dXJuIChfc3RhdGUkcGFnaW5hdGlvbkhlYWQgPSBzdGF0ZS5wYWdpbmF0aW9uSGVhZGVycykgPT09IG51bGwgfHwgX3N0YXRlJHBhZ2luYXRpb25IZWFkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfc3RhdGUkcGFnaW5hdGlvbkhlYWRbc2NoZW1hT3JUeXBlLmlkIHx8IHNjaGVtYU9yVHlwZV07CiAgICB9OwogIH0sCiAgLyoqCiAgICogU2ltcGxlIGdldHRlciB0byBmZXRjaCBwcmUtY29uZmlndXJlZCBoZWFkZXJzIChub3QgdXNlZCBpbiBwYWdpbmF0ZWQgbGlzdHMpCiAgICovCiAgY29uZmlndXJlZEhlYWRlcnMoc3RhdGUpIHsKICAgIHJldHVybiBzY2hlbWFPclR5cGUgPT4gewogICAgICB2YXIgX3N0YXRlJGhlYWRlcnM7CiAgICAgIHJldHVybiAoX3N0YXRlJGhlYWRlcnMgPSBzdGF0ZS5oZWFkZXJzKSA9PT0gbnVsbCB8fCBfc3RhdGUkaGVhZGVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3N0YXRlJGhlYWRlcnNbc2NoZW1hT3JUeXBlLmlkIHx8IHNjaGVtYU9yVHlwZV07CiAgICB9OwogIH0sCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgLy8gQ3VzdG9tIGxpc3QvZGV0YWlsL2VkaXQvaGVhZGVyIGNvbXBvbmVudCBkZXRlY3Rpb24KICAvLwogIC8vIE5vdGU6IHlvdSBjYW4ndCByZWZhY3RvciB0aGVzZSBpbnRvIG9uZSBmdW5jdGlvbiB0aGF0IGRvZXMgYEAvJHtraW5kfS8ke3R5cGV9YCwKICAvLyBiZWNhdXNlIGJhYmVsIG5lZWRzIHNvbWUgaGFyZGNvZGVkIGlkZWEgd2hlcmUgdG8gbG9vayBmb3IgdGhlIGRlcGVuZGVuY3kuCiAgLy8KICAvLyBOb3RlIDI6IFllcyB0aGVzZSBhcmUgZWRpdGluZyBzdGF0ZSBpbiBhIGdldHRlciBmb3IgY2FjaGluZy4uLiBpdCdzIG9rLCBwcm9iYWJseS4KICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICBoYXNDdXN0b21MaXN0KHN0YXRlLCBnZXR0ZXJzLCByb290U3RhdGUpIHsKICAgIHJldHVybiByYXdUeXBlID0+IHsKICAgICAgY29uc3Qga2V5ID0gZ2V0dGVycy5jb21wb25lbnRGb3IocmF3VHlwZSk7CiAgICAgIHJldHVybiBoYXNDdXN0b20oc3RhdGUsIHJvb3RTdGF0ZSwgJ2xpc3QnLCBrZXksIGtleSA9PiByZXNvbHZlTGlzdChrZXkpKTsKICAgIH07CiAgfSwKICBoYXNDdXN0b21DaGFydChzdGF0ZSwgZ2V0dGVycywgcm9vdFN0YXRlKSB7CiAgICByZXR1cm4gcmF3VHlwZSA9PiB7CiAgICAgIGNvbnN0IGtleSA9IGdldHRlcnMuY29tcG9uZW50Rm9yKHJhd1R5cGUpOwogICAgICByZXR1cm4gaGFzQ3VzdG9tKHN0YXRlLCByb290U3RhdGUsICdjaGFydCcsIGtleSwga2V5ID0+IHJlc29sdmVDaGFydChrZXkpKTsKICAgIH07CiAgfSwKICBoYXNDdXN0b21EZXRhaWwoc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSkgewogICAgcmV0dXJuIChyYXdUeXBlLCBzdWJUeXBlKSA9PiB7CiAgICAgIGNvbnN0IGtleSA9IGdldHRlcnMuY29tcG9uZW50Rm9yKHJhd1R5cGUsIHN1YlR5cGUpOwogICAgICByZXR1cm4gaGFzQ3VzdG9tKHN0YXRlLCByb290U3RhdGUsICdkZXRhaWwnLCBrZXksIGtleSA9PiByZXNvbHZlRGV0YWlsKGtleSkpOwogICAgfTsKICB9LAogIGhhc0dyYXBoKHN0YXRlLCBnZXR0ZXJzKSB7CiAgICByZXR1cm4gcmVzb3VyY2UgPT4gewogICAgICBjb25zdCB0eXBlT3B0aW9ucyA9IGdldHRlcnNbJ29wdGlvbnNGb3InXShyZXNvdXJjZSk7CiAgICAgIGlmICh0eXBlT3B0aW9ucyAmJiB0eXBlT3B0aW9ucy5oYXNHcmFwaCkgewogICAgICAgIHJldHVybiBncmFwaENvbmZpZ01hcFtyZXNvdXJjZV07CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9OwogIH0sCiAgaGFzQ3VzdG9tRWRpdChzdGF0ZSwgZ2V0dGVycywgcm9vdFN0YXRlKSB7CiAgICByZXR1cm4gKHJhd1R5cGUsIHN1YlR5cGUpID0+IHsKICAgICAgY29uc3Qga2V5ID0gZ2V0dGVycy5jb21wb25lbnRGb3IocmF3VHlwZSwgc3ViVHlwZSk7CiAgICAgIHJldHVybiBoYXNDdXN0b20oc3RhdGUsIHJvb3RTdGF0ZSwgJ2VkaXQnLCBrZXksIGtleSA9PiByZXNvbHZlRWRpdChrZXkpKTsKICAgIH07CiAgfSwKICBoYXNDb21wb25lbnQoc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSkgewogICAgcmV0dXJuIHBhdGggPT4gewogICAgICByZXR1cm4gaGFzQ3VzdG9tKHN0YXRlLCByb290U3RhdGUsICdlZGl0JywgcGF0aCwgcGF0aCA9PiByZXNvbHZlRWRpdChwYXRoKSk7CiAgICB9OwogIH0sCiAgaGFzQ3VzdG9tUHJvbXB0UmVtb3ZlKHN0YXRlLCBnZXR0ZXJzLCByb290U3RhdGUpIHsKICAgIHJldHVybiAocmF3VHlwZSwgc3ViVHlwZSkgPT4gewogICAgICBjb25zdCBrZXkgPSBnZXR0ZXJzLmNvbXBvbmVudEZvcihyYXdUeXBlLCBzdWJUeXBlKTsKICAgICAgcmV0dXJuIGhhc0N1c3RvbShzdGF0ZSwgcm9vdFN0YXRlLCAncHJvbXB0UmVtb3ZlJywga2V5LCAoKSA9PiByZXF1aXJlLnJlc29sdmUoYEBzaGVsbC9wcm9tcHRSZW1vdmUvJHtrZXl9YCkpOwogICAgfTsKICB9LAogIGhhc0N1c3RvbVdpbmRvd0NvbXBvbmVudChzdGF0ZSwgZ2V0dGVycywgcm9vdFN0YXRlKSB7CiAgICByZXR1cm4gKHJhd1R5cGUsIHN1YlR5cGUpID0+IHsKICAgICAgY29uc3Qga2V5ID0gZ2V0dGVycy5jb21wb25lbnRGb3IocmF3VHlwZSwgc3ViVHlwZSk7CiAgICAgIHJldHVybiBoYXNDdXN0b20oc3RhdGUsIHJvb3RTdGF0ZSwgJ3dpbmRvd0NvbXBvbmVudHMnLCBrZXksIGtleSA9PiByZXNvbHZlV2luZG93Q29tcG9uZW50KGtleSkpOwogICAgfTsKICB9LAogIGhhc0N1c3RvbU1hY2hpbmVDb25maWdDb21wb25lbnQoc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSkgewogICAgcmV0dXJuIChyYXdUeXBlLCBzdWJUeXBlKSA9PiB7CiAgICAgIGNvbnN0IGtleSA9IGdldHRlcnMuY29tcG9uZW50Rm9yKHJhd1R5cGUsIHN1YlR5cGUpOwogICAgICByZXR1cm4gaGFzQ3VzdG9tKHN0YXRlLCByb290U3RhdGUsICdtYWNoaW5lLWNvbmZpZycsIGtleSwga2V5ID0+IHJlc29sdmVNYWNoaW5lQ29uZmlnQ29tcG9uZW50KGtleSkpOwogICAgfTsKICB9LAogIGhhc0N1c3RvbUNsb3VkQ3JlZGVudGlhbENvbXBvbmVudChzdGF0ZSwgZ2V0dGVycywgcm9vdFN0YXRlKSB7CiAgICByZXR1cm4gKHJhd1R5cGUsIHN1YlR5cGUpID0+IHsKICAgICAgY29uc3Qga2V5ID0gZ2V0dGVycy5jb21wb25lbnRGb3IocmF3VHlwZSwgc3ViVHlwZSk7CiAgICAgIHJldHVybiBoYXNDdXN0b20oc3RhdGUsIHJvb3RTdGF0ZSwgJ2Nsb3VkLWNyZWRlbnRpYWwnLCBrZXksIGtleSA9PiByZXNvbHZlQ2xvdWRDcmVkZW50aWFsQ29tcG9uZW50KGtleSkpOwogICAgfTsKICB9LAogIGltcG9ydENvbXBvbmVudChzdGF0ZSwgZ2V0dGVycykgewogICAgcmV0dXJuIHBhdGggPT4gewogICAgICByZXR1cm4gaW1wb3J0RWRpdChwYXRoKTsKICAgIH07CiAgfSwKICBpbXBvcnREaWFsb2coc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSkgewogICAgcmV0dXJuIChyYXdUeXBlLCBzdWJUeXBlKSA9PiB7CiAgICAgIHJldHVybiBsb2FkRXh0ZW5zaW9uKHJvb3RTdGF0ZSwgJ2RpYWxvZycsIGdldHRlcnMuY29tcG9uZW50Rm9yKHJhd1R5cGUsIHN1YlR5cGUpLCBpbXBvcnREaWFsb2cpOwogICAgfTsKICB9LAogIGltcG9ydExpc3Qoc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSkgewogICAgcmV0dXJuIHJhd1R5cGUgPT4gewogICAgICByZXR1cm4gbG9hZEV4dGVuc2lvbihyb290U3RhdGUsICdsaXN0JywgZ2V0dGVycy5jb21wb25lbnRGb3IocmF3VHlwZSksIGltcG9ydExpc3QpOwogICAgfTsKICB9LAogIGltcG9ydENoYXJ0KHN0YXRlLCBnZXR0ZXJzLCByb290U3RhdGUpIHsKICAgIHJldHVybiByYXdUeXBlID0+IHsKICAgICAgcmV0dXJuIGxvYWRFeHRlbnNpb24ocm9vdFN0YXRlLCAnY2hhcnQnLCBnZXR0ZXJzLmNvbXBvbmVudEZvcihyYXdUeXBlKSwgaW1wb3J0Q2hhcnQpOwogICAgfTsKICB9LAogIGltcG9ydERldGFpbChzdGF0ZSwgZ2V0dGVycywgcm9vdFN0YXRlKSB7CiAgICByZXR1cm4gKHJhd1R5cGUsIHN1YlR5cGUpID0+IHsKICAgICAgcmV0dXJuIGxvYWRFeHRlbnNpb24ocm9vdFN0YXRlLCAnZGV0YWlsJywgZ2V0dGVycy5jb21wb25lbnRGb3IocmF3VHlwZSwgc3ViVHlwZSksIGltcG9ydERldGFpbCk7CiAgICB9OwogIH0sCiAgaW1wb3J0RWRpdChzdGF0ZSwgZ2V0dGVycywgcm9vdFN0YXRlKSB7CiAgICByZXR1cm4gKHJhd1R5cGUsIHN1YlR5cGUpID0+IHsKICAgICAgcmV0dXJuIGxvYWRFeHRlbnNpb24ocm9vdFN0YXRlLCAnZWRpdCcsIGdldHRlcnMuY29tcG9uZW50Rm9yKHJhd1R5cGUsIHN1YlR5cGUpLCBpbXBvcnRFZGl0KTsKICAgIH07CiAgfSwKICBpbXBvcnRDdXN0b21Qcm9tcHRSZW1vdmUoc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSkgewogICAgcmV0dXJuIChyYXdUeXBlLCBzdWJUeXBlKSA9PiB7CiAgICAgIHJldHVybiBsb2FkRXh0ZW5zaW9uKHJvb3RTdGF0ZSwgJ3Byb21wdFJlbW92ZScsIGdldHRlcnMuY29tcG9uZW50Rm9yKHJhd1R5cGUsIHN1YlR5cGUpLCBpbXBvcnRDdXN0b21Qcm9tcHRSZW1vdmUpOwogICAgfTsKICB9LAogIGltcG9ydFdpbmRvd0NvbXBvbmVudChzdGF0ZSwgZ2V0dGVycywgcm9vdFN0YXRlKSB7CiAgICByZXR1cm4gKHJhd1R5cGUsIHN1YlR5cGUpID0+IHsKICAgICAgcmV0dXJuIGxvYWRFeHRlbnNpb24ocm9vdFN0YXRlLCAnd2luZG93Q29tcG9uZW50cycsIGdldHRlcnMuY29tcG9uZW50Rm9yKHJhd1R5cGUsIHN1YlR5cGUpLCBpbXBvcnRXaW5kb3dDb21wb25lbnQpOwogICAgfTsKICB9LAogIGltcG9ydExvZ2luKHN0YXRlLCBnZXR0ZXJzLCByb290U3RhdGUpIHsKICAgIHJldHVybiBhdXRoVHlwZSA9PiB7CiAgICAgIHJldHVybiBsb2FkRXh0ZW5zaW9uKHJvb3RTdGF0ZSwgJ2xvZ2luJywgYXV0aFR5cGUsIGltcG9ydExvZ2luKTsKICAgIH07CiAgfSwKICBpbXBvcnRNYWNoaW5lQ29uZmlnKHN0YXRlLCBnZXR0ZXJzLCByb290U3RhdGUpIHsKICAgIHJldHVybiAocmF3VHlwZSwgc3ViVHlwZSkgPT4gewogICAgICByZXR1cm4gbG9hZEV4dGVuc2lvbihyb290U3RhdGUsICdtYWNoaW5lLWNvbmZpZycsIGdldHRlcnMuY29tcG9uZW50Rm9yKHJhd1R5cGUsIHN1YlR5cGUpLCBpbXBvcnRNYWNoaW5lQ29uZmlnKTsKICAgIH07CiAgfSwKICBpbXBvcnRDbG91ZENyZWRlbnRpYWwoc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSkgewogICAgcmV0dXJuIChyYXdUeXBlLCBzdWJUeXBlKSA9PiB7CiAgICAgIHJldHVybiBsb2FkRXh0ZW5zaW9uKHJvb3RTdGF0ZSwgJ2Nsb3VkLWNyZWRlbnRpYWwnLCBnZXR0ZXJzLmNvbXBvbmVudEZvcihyYXdUeXBlLCBzdWJUeXBlKSwgaW1wb3J0Q2xvdWRDcmVkZW50aWFsKTsKICAgIH07CiAgfSwKICBjb21wb25lbnRGb3Ioc3RhdGUsIGdldHRlcnMpIHsKICAgIHJldHVybiAodHlwZSwgc3ViVHlwZSkgPT4gewogICAgICBsZXQga2V5ID0gdHlwZTsKICAgICAgaWYgKHN1YlR5cGUpIHsKICAgICAgICBrZXkgPSBgJHt0eXBlfS8ke3N1YlR5cGV9YDsKICAgICAgfQogICAgICBpZiAoc3RhdGUuY2FjaGUuY29tcG9uZW50Rm9yW2tleV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBzdGF0ZS5jYWNoZS5jb21wb25lbnRGb3Jba2V5XTsKICAgICAgfQogICAgICBsZXQgb3V0ID0gdHlwZTsKICAgICAgY29uc3QgbWFwcGluZyA9IHN0YXRlLnR5cGVUb0NvbXBvbmVudE1hcHBpbmdzLmZpbmQobWFwcGluZyA9PiB7CiAgICAgICAgY29uc3QgcmUgPSBzdHJpbmdUb1JlZ2V4KG1hcHBpbmcubWF0Y2gpOwogICAgICAgIHJldHVybiByZS50ZXN0KGtleSk7CiAgICAgIH0pOwogICAgICBpZiAobWFwcGluZykgewogICAgICAgIG91dCA9IG1hcHBpbmcucmVwbGFjZTsKICAgICAgfSBlbHNlIGlmIChzdWJUeXBlKSB7CiAgICAgICAgLy8gVHJ5IGFnYWluIHdpdGhvdXQgdGhlIHN1YlR5cGUKICAgICAgICBvdXQgPSBnZXR0ZXJzLmNvbXBvbmVudEZvcih0eXBlKTsKICAgICAgfQogICAgICBzdGF0ZS5jYWNoZS5jb21wb25lbnRGb3Jba2V5XSA9IG91dDsKICAgICAgcmV0dXJuIG91dDsKICAgIH07CiAgfSwKICBpc0lnbm9yZWQoc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSwgcm9vdEdldHRlcnMpIHsKICAgIHJldHVybiBzY2hlbWEgPT4gewogICAgICBsZXQgb3V0ID0gZmFsc2U7CiAgICAgIGZvciAoY29uc3QgcnVsZSBvZiBzdGF0ZS5ncm91cElnbm9yZSkgewogICAgICAgIHZhciBfc2NoZW1hJGF0dHJpYnV0ZXMyOwogICAgICAgIGNvbnN0IGdyb3VwID0gc2NoZW1hID09PSBudWxsIHx8IHNjaGVtYSA9PT0gdm9pZCAwIHx8IChfc2NoZW1hJGF0dHJpYnV0ZXMyID0gc2NoZW1hLmF0dHJpYnV0ZXMpID09PSBudWxsIHx8IF9zY2hlbWEkYXR0cmlidXRlczIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zY2hlbWEkYXR0cmlidXRlczIuZ3JvdXA7CiAgICAgICAgaWYgKGdyb3VwICYmIGdyb3VwLm1hdGNoKHN0cmluZ1RvUmVnZXgocnVsZS50eXBlKSAmJiBpc09iamVjdChydWxlKSAmJiBydWxlLnR5cGUpKSB7CiAgICAgICAgICBvdXQgPSBydWxlLmNiKHJvb3RHZXR0ZXJzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoZ3JvdXAgJiYgdHlwZW9mIHJ1bGUgPT09ICdzdHJpbmcnICYmIGdyb3VwLm1hdGNoKHN0cmluZ1RvUmVnZXgocnVsZSkpKSB7CiAgICAgICAgICBvdXQgPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICghb3V0KSB7CiAgICAgICAgZm9yIChjb25zdCBydWxlIG9mIHN0YXRlLnR5cGVJZ25vcmUpIHsKICAgICAgICAgIGlmIChzY2hlbWEuaWQubWF0Y2goc3RyaW5nVG9SZWdleChydWxlKSkpIHsKICAgICAgICAgICAgb3V0ID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHN0YXRlLmNhY2hlLmlnbm9yZVtzY2hlbWEuaWRdID0gb3V0OwogICAgICByZXR1cm4gb3V0OwogICAgfTsKICB9LAogIGFjdGl2ZVByb2R1Y3RzKHN0YXRlLCBnZXR0ZXJzLCByb290U3RhdGUsIHJvb3RHZXR0ZXJzKSB7CiAgICBjb25zdCBrbm93blR5cGVzID0ge307CiAgICBjb25zdCBrbm93bkdyb3VwcyA9IHt9OwogICAgY29uc3QgaXNEZXYgPSByb290R2V0dGVyc1sncHJlZnMvZ2V0J10oVklFV19JTl9BUEkpOwogICAgaWYgKHN0YXRlLnNjaGVtYUdlbmVyYXRpb24gPCAwKSB7CiAgICAgIC8vIFRoaXMgZG9lcyBub3RoaW5nLCBidXQgbWFrZXMgYWN0aXZlUHJvZHVjdHMgZGVwZW5kIG9uIHNjaGVtYUdlbmVyYXRpb24KICAgICAgLy8gc28gdGhhdCBpdCBjYW4gYmUgdXNlZCB0byB1cGRhdGUgdGhlIHByb2R1Y3QgbGlzdCBvbiBzY2hlbWEgY2hhbmdlLgogICAgICByZXR1cm47CiAgICB9CiAgICByZXR1cm4gc3RhdGUucHJvZHVjdHMuZmlsdGVyKHAgPT4gewogICAgICBjb25zdCBtb2R1bGUgPSBwLmluU3RvcmU7CiAgICAgIGlmIChwWydwdWJsaWMnXSA9PT0gZmFsc2UgJiYgIWlzRGV2KSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmIChwLmlmR2V0dGVyICYmICFyb290R2V0dGVyc1twLmlmR2V0dGVyXSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAoIWtub3duVHlwZXNbbW9kdWxlXSkgewogICAgICAgIGNvbnN0IHNjaGVtYXMgPSByb290R2V0dGVyc1tgJHttb2R1bGV9L2FsbGBdKFNDSEVNQSk7CiAgICAgICAga25vd25UeXBlc1ttb2R1bGVdID0gW107CiAgICAgICAga25vd25Hcm91cHNbbW9kdWxlXSA9IFtdOwogICAgICAgIGZvciAoY29uc3QgcyBvZiBzY2hlbWFzKSB7CiAgICAgICAgICBrbm93blR5cGVzW21vZHVsZV0ucHVzaChzLl9pZCk7CiAgICAgICAgICBpZiAocy5fZ3JvdXApIHsKICAgICAgICAgICAgYWRkT2JqZWN0KGtub3duR3JvdXBzW21vZHVsZV0sIHMuX2dyb3VwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHAuaWZGZWF0dXJlKSB7CiAgICAgICAgY29uc3QgZmVhdHVyZXMgPSBBcnJheS5pc0FycmF5KHAuaWZGZWF0dXJlKSA/IHAuaWZGZWF0dXJlIDogW3AuaWZGZWF0dXJlXTsKICAgICAgICBmb3IgKGNvbnN0IGYgb2YgZmVhdHVyZXMpIHsKICAgICAgICAgIGlmICghcm9vdEdldHRlcnNbJ2ZlYXR1cmVzL2dldCddKGYpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHAuaWZIYXZlICYmICFpZkhhdmUocm9vdEdldHRlcnMsIHAuaWZIYXZlKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAocC5pZkhhdmVUeXBlKSB7CiAgICAgICAgY29uc3QgaGF2ZUlkcyA9IGtub3duVHlwZXNbbW9kdWxlXS5maWx0ZXIodCA9PiB0Lm1hdGNoKHN0cmluZ1RvUmVnZXgocC5pZkhhdmVUeXBlKSkpOwogICAgICAgIGlmICghaGF2ZUlkcy5sZW5ndGgpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKHAuaWZIYXZlVmVyYiAmJiAhaWZIYXZlVmVyYihyb290R2V0dGVycywgbW9kdWxlLCBwLmlmSGF2ZVZlcmIsIGhhdmVJZHMpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwLmlmSGF2ZUdyb3VwICYmICFrbm93bkdyb3Vwc1ttb2R1bGVdLmZpbmQodCA9PiB0Lm1hdGNoKHN0cmluZ1RvUmVnZXgocC5pZkhhdmVHcm91cCkpKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0pOwogIH0sCiAgaXNQcm9kdWN0QWN0aXZlKHN0YXRlLCBnZXR0ZXJzKSB7CiAgICByZXR1cm4gbmFtZSA9PiB7CiAgICAgIGlmIChmaW5kQnkoZ2V0dGVyc1snYWN0aXZlUHJvZHVjdHMnXSwgJ25hbWUnLCBuYW1lKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CiAgfSwKICByb3dWYWx1ZUdldHRlcihzdGF0ZSkgewogICAgcmV0dXJuIChzY2hlbWEsIGNvbE5hbWUpID0+IHsKICAgICAgY29uc3QgY29sID0gX2ZpbmRDb2x1bW5CeU5hbWUoc2NoZW1hLCBjb2xOYW1lKTsKICAgICAgcmV0dXJuIHJvd1ZhbHVlR2V0dGVyKGNvbCk7CiAgICB9OwogIH0sCiAgaXNQcm9kdWN0UmVnaXN0ZXJlZChzdGF0ZSkgewogICAgcmV0dXJuIHByb2R1Y3ROYW1lID0+IHsKICAgICAgY29uc3QgcHJvZCA9IHN0YXRlLnByb2R1Y3RzLmZpbmQocCA9PiBwLm5hbWUgPT09IHByb2R1Y3ROYW1lKTsKICAgICAgcmV0dXJuICEhcHJvZDsKICAgIH07CiAgfSwKICBwcm9kdWN0QnlOYW1lKHN0YXRlKSB7CiAgICByZXR1cm4gcHJvZHVjdE5hbWUgPT4gc3RhdGUucHJvZHVjdHMuZmluZChwID0+IHAubmFtZSA9PT0gcHJvZHVjdE5hbWUpOwogIH0KfTsKZXhwb3J0IGNvbnN0IG11dGF0aW9ucyA9IHsKICBzY2hlbWFDaGFuZ2VkKHN0YXRlKSB7CiAgICBzdGF0ZS5zY2hlbWFHZW5lcmF0aW9uID0gc3RhdGUuc2NoZW1hR2VuZXJhdGlvbiArIDE7CiAgfSwKICAvLyBSZW1vdmUgdGhlIHNwZWNpZmllZCBwcm9kdWN0CiAgcmVtb3ZlKHN0YXRlLCB7CiAgICBwcm9kdWN0LAogICAgcGx1Z2luCiAgfSkgewogICAgY29uc3QgZXhpc3RpbmcgPSBzdGF0ZS5wcm9kdWN0cy5maW5kSW5kZXgocCA9PiBwLm5hbWUgPT09IHByb2R1Y3QpOwoKICAgIC8vIFJlbW92ZSB0aGUgcHJvZHVjdAogICAgaWYgKGV4aXN0aW5nICE9PSAtMSkgewogICAgICBzdGF0ZS5wcm9kdWN0cy5zcGxpY2UoZXhpc3RpbmcsIDEpOwogICAgfQoKICAgIC8vIEdvIHRocm91Z2ggdGhlIGJhc2ljIHR5cGVzIGFuZCByZW1vdmUgdGhlIGhlYWRlcnMKICAgIGlmIChzdGF0ZS52aXJ0dWFsVHlwZXNbcHJvZHVjdF0pIHsKICAgICAgZGVsZXRlIHN0YXRlLnZpcnR1YWxUeXBlc1twcm9kdWN0XTsKICAgIH0KICAgIGlmIChzdGF0ZS5iYXNpY1R5cGVzW3Byb2R1Y3RdKSB7CiAgICAgIC8vIFJlbW92ZSB0YWJsZSBoZWFkZXIgY29uZmlndXJhdGlvbgogICAgICBPYmplY3Qua2V5cyhzdGF0ZS5iYXNpY1R5cGVzW3Byb2R1Y3RdKS5mb3JFYWNoKHR5cGUgPT4gewogICAgICAgIGRlbGV0ZSBzdGF0ZS5oZWFkZXJzW3R5cGVdOwogICAgICAgIGRlbGV0ZSBzdGF0ZS5iYXNpY1R5cGVXZWlnaHRzW3R5cGVdOwogICAgICAgIGRlbGV0ZSBzdGF0ZS5jYWNoZS5pZ25vcmVbdHlwZV07CiAgICAgICAgLy8gVGhlc2UgdHJhY2sgd2hldGhlciB0aGUgdHlwZSBoYXMgYSBjdXN0b20gY29tcG9uZW50CiAgICAgICAgZGVsZXRlIHN0YXRlLmNhY2hlLmRldGFpbFt0eXBlXTsKICAgICAgICBkZWxldGUgc3RhdGUuY2FjaGUuZWRpdFt0eXBlXTsKICAgICAgICBkZWxldGUgc3RhdGUuY2FjaGUubGlzdFt0eXBlXTsKCiAgICAgICAgLy8gRGVsZXRlIGFsbCBvZiB0aGUgZW50cmllcyBmcm9tIHRoZSBjb21wb25lbnRGb3IgY2FjaGUgd2hlcmUgdGhlIHZhbHllIGlzIHRoZSB0eXBlCiAgICAgICAgLy8gQ2FuIGRvIHRoaXMgbW9yZSBlZmZpY2llbnRseQogICAgICAgIE9iamVjdC5rZXlzKHN0YXRlLmNhY2hlLmNvbXBvbmVudEZvcikuZm9yRWFjaChrID0+IHsKICAgICAgICAgIGNvbnN0IHYgPSBzdGF0ZS5jYWNoZS5jb21wb25lbnRGb3Jba107CiAgICAgICAgICBpZiAodiA9PT0gdHlwZSkgewogICAgICAgICAgICBkZWxldGUgc3RhdGUuY2FjaGUuY29tcG9uZW50Rm9yW2tdOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgZGVsZXRlIHN0YXRlLmJhc2ljVHlwZXNbcHJvZHVjdF07CiAgICB9CiAgICBpZiAocGx1Z2luKSB7CiAgICAgIC8vIGtpbmQgaXMgbGlzdCwgZWRpdCwgZGV0YWlsIGV0YwogICAgICBPYmplY3Qua2V5cyhwbHVnaW4udHlwZXMpLmZvckVhY2goa2luZCA9PiB7CiAgICAgICAgaWYgKHN0YXRlLmNhY2hlW2tpbmRdKSB7CiAgICAgICAgICBPYmplY3Qua2V5cyhwbHVnaW4udHlwZXNba2luZF0pLmZvckVhY2godHlwZSA9PiB7CiAgICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5jYWNoZVtraW5kXVt0eXBlXTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSwKICBwcm9kdWN0KHN0YXRlLCBvYmopIHsKICAgIHZhciBfZXhpc3RpbmcsIF9leGlzdGluZzIsIF9leGlzdGluZzMsIF9leGlzdGluZzQ7CiAgICBsZXQgZXhpc3RpbmcgPSBzdGF0ZS5wcm9kdWN0cy5maW5kKHAgPT4gcC5uYW1lID09PSBvYmoubmFtZSk7CiAgICBpZiAoZXhpc3RpbmcpIHsKICAgICAgT2JqZWN0LmFzc2lnbihleGlzdGluZywgb2JqKTsKICAgIH0gZWxzZSB7CiAgICAgIGFkZE9iamVjdChzdGF0ZS5wcm9kdWN0cywgb2JqKTsKICAgICAgZXhpc3RpbmcgPSBzdGF0ZS5wcm9kdWN0cy5maW5kKHAgPT4gcC5uYW1lID09PSBvYmoubmFtZSk7CiAgICB9CgogICAgLy8gTWFrZSBzdXJlIGRlcHJlY2F0ZWQgYGluRXhwbG9yZXJgIGlzIHN5bmNocm9uaXplZCB3aXRoIGByb290UHJvZHVjdGAgKGFuZCB2aWNlLXZlcnNhKQogICAgaWYgKChfZXhpc3RpbmcgPSBleGlzdGluZykgIT09IG51bGwgJiYgX2V4aXN0aW5nICE9PSB2b2lkIDAgJiYgX2V4aXN0aW5nLmluRXhwbG9yZXIpIHsKICAgICAgZXhpc3Rpbmcucm9vdFByb2R1Y3QgPSBFWFBMT1JFUjsKICAgIH0gZWxzZSBpZiAoKChfZXhpc3RpbmcyID0gZXhpc3RpbmcpID09PSBudWxsIHx8IF9leGlzdGluZzIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9leGlzdGluZzIucm9vdFByb2R1Y3QpID09PSBFWFBMT1JFUikgewogICAgICBleGlzdGluZy5pbkV4cGxvcmVyID0gdHJ1ZTsKICAgIH0KCiAgICAvLyBXZSBtYWtlIGFuIGFzc3VtcHRpb24gdGhhdCBpZiB0aGUgc3RvcmUgZm9yIGEgcHJvZHVjdCBpcyAnY2x1c3RlcicgaXQgd2lsbCBiZSBkaXNwbGF5ZWQgd2l0aGluIGNsdXN0ZXIgZXhwbG9yZXIKICAgIC8vIERldGVjdCB0aGF0IGhlcmUgYW5kIHNldCByb290UHJvZHVjdCBhbmQgaW5FeHBvcmVyIGluIHRoaXMgY2FzZQogICAgaWYgKCEoKF9leGlzdGluZzMgPSBleGlzdGluZykgIT09IG51bGwgJiYgX2V4aXN0aW5nMyAhPT0gdm9pZCAwICYmIF9leGlzdGluZzMucm9vdFByb2R1Y3QpICYmICgoX2V4aXN0aW5nNCA9IGV4aXN0aW5nKSA9PT0gbnVsbCB8fCBfZXhpc3Rpbmc0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZXhpc3Rpbmc0LmluU3RvcmUpID09PSAnY2x1c3RlcicpIHsKICAgICAgZXhpc3Rpbmcucm9vdFByb2R1Y3QgPSBFWFBMT1JFUjsKICAgICAgZXhpc3RpbmcuaW5FeHBsb3JlciA9IGV4aXN0aW5nLnJvb3RQcm9kdWN0ID09PSBFWFBMT1JFUjsKICAgIH0KICB9LAogIHZpcnR1YWxUeXBlKHN0YXRlLCB7CiAgICBwcm9kdWN0LAogICAgb2JqCiAgfSkgewogICAgaWYgKCFzdGF0ZS52aXJ0dWFsVHlwZXNbcHJvZHVjdF0pIHsKICAgICAgc3RhdGUudmlydHVhbFR5cGVzW3Byb2R1Y3RdID0gW107CiAgICB9CiAgICBjb25zdCBjb3B5ID0gY2xvbmUob2JqKTsKICAgIGNvcHkudmlydHVhbCA9IHRydWU7CiAgICBjb25zdCBleGlzdGluZyA9IGZpbmRCeShzdGF0ZS52aXJ0dWFsVHlwZXNbcHJvZHVjdF0sICduYW1lJywgY29weS5uYW1lKTsKICAgIGlmIChleGlzdGluZykgewogICAgICBPYmplY3QuYXNzaWduKGV4aXN0aW5nLCBjb3B5KTsKICAgIH0gZWxzZSB7CiAgICAgIGFkZE9iamVjdChzdGF0ZS52aXJ0dWFsVHlwZXNbcHJvZHVjdF0sIGNvcHkpOwogICAgfQogIH0sCiAgc3Bvb2ZlZFR5cGUoc3RhdGUsIHsKICAgIHByb2R1Y3QsCiAgICBvYmoKICB9KSB7CiAgICBpZiAoIXN0YXRlLnNwb29mZWRUeXBlc1twcm9kdWN0XSkgewogICAgICBzdGF0ZS5zcG9vZmVkVHlwZXNbcHJvZHVjdF0gPSBbXTsKICAgIH0KICAgIGNvbnN0IGNvcHkgPSBjbG9uZShvYmopOwogICAgaW5zdGFuY2VNZXRob2RzW3Byb2R1Y3RdID0gaW5zdGFuY2VNZXRob2RzW3Byb2R1Y3RdIHx8IHt9OwogICAgaW5zdGFuY2VNZXRob2RzW3Byb2R1Y3RdW2NvcHkudHlwZV0gPSBjb3B5LmdldEluc3RhbmNlczsKICAgIGRlbGV0ZSBjb3B5LmdldEluc3RhbmNlczsKICAgIGNvcHkubmFtZSA9IGNvcHkudHlwZTsKICAgIGNvcHkuaXNTcG9vZmVkID0gdHJ1ZTsKICAgIGNvcHkudmlydHVhbCA9IHRydWU7CiAgICBjb3B5LnNjaGVtYXMuZm9yRWFjaChzY2hlbWEgPT4gewogICAgICBzY2hlbWEubGlua3MgPSB7CiAgICAgICAgY29sbGVjdGlvbjogYC8ke1NQT09GRURfUFJFRklYfS8ke3NjaGVtYS5pZH1gLAogICAgICAgIC4uLihzY2hlbWEubGlua3MgfHwge30pCiAgICAgIH07CiAgICB9KTsKICAgIGNvbnN0IGV4aXN0aW5nID0gZmluZEJ5KHN0YXRlLnNwb29mZWRUeXBlc1twcm9kdWN0XSwgJ3R5cGUnLCBjb3B5LnR5cGUpOwogICAgaWYgKGV4aXN0aW5nKSB7CiAgICAgIE9iamVjdC5hc3NpZ24oZXhpc3RpbmcsIGNvcHkpOwogICAgfSBlbHNlIHsKICAgICAgYWRkT2JqZWN0KHN0YXRlLnNwb29mZWRUeXBlc1twcm9kdWN0XSwgY29weSk7CiAgICB9CiAgfSwKICBiYXNpY1R5cGUoc3RhdGUsIHsKICAgIHByb2R1Y3QsCiAgICBncm91cCwKICAgIHR5cGVzCiAgfSkgewogICAgaWYgKCFwcm9kdWN0KSB7CiAgICAgIHByb2R1Y3QgPSBFWFBMT1JFUjsKICAgIH0KICAgIGlmICghZ3JvdXApIHsKICAgICAgZ3JvdXAgPSBST09UOwogICAgfQogICAgaWYgKCFpc0FycmF5KHR5cGVzKSkgewogICAgICB0eXBlcyA9IFt0eXBlc107CiAgICB9CiAgICBpZiAoIXN0YXRlLmJhc2ljVHlwZXNbcHJvZHVjdF0pIHsKICAgICAgc3RhdGUuYmFzaWNUeXBlc1twcm9kdWN0XSA9IHt9OwogICAgfQogICAgZm9yIChjb25zdCB0IG9mIHR5cGVzKSB7CiAgICAgIHN0YXRlLmJhc2ljVHlwZXNbcHJvZHVjdF1bdF0gPSBncm91cDsKICAgIH0KICB9LAogIGlnbm9yZUdyb3VwKHN0YXRlLCB7CiAgICByZWdleE9yU3RyaW5nOiBtYXRjaCwKICAgIGNiCiAgfSkgewogICAgbWF0Y2ggPSBlbnN1cmVSZWdleChtYXRjaCk7CiAgICAvLyBTdGF0ZSBzaG91bGRuJ3QgY29udGFpbiBhY3R1YWwgUmVnRXhwIG9iamVjdHMsIGJlY2F1c2UgdGhleSBkb24ndCBzZXJpYWxpemUKICAgIGNiID8gc3RhdGUuZ3JvdXBJZ25vcmUucHVzaCh7CiAgICAgIHR5cGU6IHJlZ2V4VG9TdHJpbmcobWF0Y2gpLAogICAgICBjYgogICAgfSkgOiBzdGF0ZS5ncm91cElnbm9yZS5wdXNoKHJlZ2V4VG9TdHJpbmcobWF0Y2gpKTsKICB9LAogIGlnbm9yZVR5cGUoc3RhdGUsIG1hdGNoKSB7CiAgICBtYXRjaCA9IGVuc3VyZVJlZ2V4KG1hdGNoKTsKICAgIHN0YXRlLnR5cGVJZ25vcmUucHVzaChyZWdleFRvU3RyaW5nKG1hdGNoKSk7CiAgfSwKICBncm91cEJ5KHN0YXRlLCB7CiAgICB0eXBlLAogICAgZmllbGQKICB9KSB7CiAgICBzdGF0ZS5ncm91cEJ5W3R5cGVdID0gZmllbGQ7CiAgfSwKICBoZWFkZXJzKHN0YXRlLCB7CiAgICB0eXBlLAogICAgaGVhZGVycwogIH0pIHsKICAgIHN0YXRlLmhlYWRlcnNbdHlwZV0gPSBoZWFkZXJzOwogIH0sCiAgcGFnaW5hdGlvbkhlYWRlcnMoc3RhdGUsIHsKICAgIHR5cGUsCiAgICBwYWdpbmF0aW9uSGVhZGVycwogIH0pIHsKICAgIHN0YXRlLnBhZ2luYXRpb25IZWFkZXJzW3R5cGVdID0gcGFnaW5hdGlvbkhlYWRlcnM7CiAgfSwKICBoaWRlQnVsa0FjdGlvbnMoc3RhdGUsIHsKICAgIHR5cGUsCiAgICBmaWVsZAogIH0pIHsKICAgIHN0YXRlLmhpZGVCdWxrQWN0aW9uc1t0eXBlXSA9IGZpZWxkOwogIH0sCiAgLy8gd2VpZ2h0R3JvdXAoe2dyb3VwOiAnY29yZScsIHdlaWdodDogOTl9KTsgLS0gaGlnaGVyIGdyb3VwcyBhcmUgc2hvd24gZmlyc3QKICAvLyBUaGVzZSBvcGVyYXRlIG9uIGdyb3VwIG5hbWVzICphZnRlciogbWFwcGluZyBidXQgKmJlZm9yZSogdHJhbnNsYXRpb24KICB3ZWlnaHRHcm91cChzdGF0ZSwgewogICAgZ3JvdXAsCiAgICBncm91cHMsCiAgICB3ZWlnaHQsCiAgICBmb3JCYXNpYwogIH0pIHsKICAgIGlmICghZ3JvdXBzKSB7CiAgICAgIGdyb3VwcyA9IFtdOwogICAgfQogICAgaWYgKGdyb3VwKSB7CiAgICAgIGdyb3Vwcy5wdXNoKGdyb3VwKTsKICAgIH0KICAgIGNvbnN0IG1hcCA9IGZvckJhc2ljID8gc3RhdGUuYmFzaWNHcm91cFdlaWdodHMgOiBzdGF0ZS5ncm91cFdlaWdodHM7CiAgICBmb3IgKGNvbnN0IGcgb2YgZ3JvdXBzKSB7CiAgICAgIG1hcFtnLnRvTG93ZXJDYXNlKCldID0gd2VpZ2h0OwogICAgfQogIH0sCiAgLy8gc2V0R3JvdXBEZWZhdWx0VHlwZSh7Z3JvdXA6ICdjb3JlJywgZGVmYXVsdFR5cGU6ICduYW1lJ30pOwogIC8vIEJ5IGRlZmF1bHQgd2hlbiBhIGdyb3VwIGlzIGNsaWNrZWQsIHRoZSBmaXJzdCBpdGVtIGlzIHNlbGVjdGVkIC0gdGhpcyBhbGxvd3MKICAvLyB0aGlzIGJlaGF2aW91ciB0byBiZSBjaGFuZ2VkIGFuZCBhIG5hbWVkIGNoaWxkIHR5cGUgY2FuIGJlIGNob3NlbgogIC8vIFRoZXNlIG9wZXJhdGUgb24gZ3JvdXAgbmFtZXMgKmFmdGVyKiBtYXBwaW5nIGJ1dCAqYmVmb3JlKiB0cmFuc2xhdGlvbgogIHNldEdyb3VwRGVmYXVsdFR5cGUoc3RhdGUsIHsKICAgIGdyb3VwLAogICAgZ3JvdXBzLAogICAgZGVmYXVsdFR5cGUKICB9KSB7CiAgICBpZiAoIWdyb3VwcykgewogICAgICBncm91cHMgPSBbXTsKICAgIH0KICAgIGlmIChncm91cCkgewogICAgICBncm91cHMucHVzaChncm91cCk7CiAgICB9CiAgICBmb3IgKGNvbnN0IGcgb2YgZ3JvdXBzKSB7CiAgICAgIHN0YXRlLmdyb3VwRGVmYXVsdFR5cGVzW2cudG9Mb3dlckNhc2UoKV0gPSBkZWZhdWx0VHlwZTsKICAgIH0KICB9LAogIC8vIHdlaWdodFR5cGUoJ0NsdXN0ZXInIDk5KTsgLS0gaGlnaGVyIGdyb3VwcyBhcmUgc2hvd24gZmlyc3QKICAvLyBUaGVzZSBvcGVyYXRlIG9uICpzY2hlbWEqIHR5cGUgbmFtZXMsIGJlZm9yZSBtYXBwaW5nCiAgd2VpZ2h0VHlwZShzdGF0ZSwgewogICAgdHlwZSwKICAgIHR5cGVzLAogICAgd2VpZ2h0LAogICAgZm9yQmFzaWMKICB9KSB7CiAgICBpZiAoIXR5cGVzKSB7CiAgICAgIHR5cGVzID0gW107CiAgICB9CiAgICBpZiAodHlwZSkgewogICAgICB0eXBlcy5wdXNoKHR5cGUpOwogICAgfQogICAgY29uc3QgbWFwID0gZm9yQmFzaWMgPyBzdGF0ZS5iYXNpY1R5cGVXZWlnaHRzIDogc3RhdGUudHlwZVdlaWdodHM7CiAgICBmb3IgKGNvbnN0IHQgb2YgdHlwZXMpIHsKICAgICAgbWFwW3QudG9Mb3dlckNhc2UoKV0gPSB3ZWlnaHQ7CiAgICB9CiAgfSwKICAvLyBtYXBHcm91cCgndWdseS50aGluZycsICdOaWNlIFRoaW5nJywgMSk7CiAgLy8gbWFwR3JvdXAoL3VnbHkudGhpbmcuKHN0dWZmKScsICckMScsIDIpOwogIC8vIG1hcEdyb3VwKC91Z2x5LnRoaW5nLihzdHVmZiknLCBmdW5jdGlvbihncm91cFN0ciwgcnVsZU9iaiwgcmVnZXhNYXRjaCwgdHlwZU9iaikgeyByZXR1cm4gdWNGaXJzdChncm91cC5pZCkgfSAsIDIpOwogIG1hcEdyb3VwKHN0YXRlLCB7CiAgICBtYXRjaCwKICAgIHJlcGxhY2UsCiAgICB3ZWlnaHQgPSA1LAogICAgY29udGludWVPbk1hdGNoID0gZmFsc2UKICB9KSB7CiAgICBfYWRkTWFwcGluZyhzdGF0ZS5ncm91cE1hcHBpbmdzLCBtYXRjaCwgcmVwbGFjZSwgd2VpZ2h0LCBjb250aW51ZU9uTWF0Y2gpOwogIH0sCiAgbWFwVHlwZShzdGF0ZSwgewogICAgbWF0Y2gsCiAgICByZXBsYWNlLAogICAgd2VpZ2h0ID0gNSwKICAgIGNvbnRpbnVlT25NYXRjaCA9IGZhbHNlCiAgfSkgewogICAgX2FkZE1hcHBpbmcoc3RhdGUudHlwZU1hcHBpbmdzLCBtYXRjaCwgcmVwbGFjZSwgd2VpZ2h0LCBjb250aW51ZU9uTWF0Y2gpOwogIH0sCiAgLy8gbW92ZVR5cGUoJ2FwcHMuZGVwbG95bWVudCcsICdDb3JlJyk7CiAgbW92ZVR5cGUoc3RhdGUsIHsKICAgIG1hdGNoLAogICAgZ3JvdXAsCiAgICB3ZWlnaHQgPSA1CiAgfSkgewogICAgX2FkZE1hcHBpbmcoc3RhdGUudHlwZU1vdmVNYXBwaW5ncywgbWF0Y2gsIGdyb3VwLCB3ZWlnaHQpOwogIH0sCiAgY29tcG9uZW50Rm9yVHlwZShzdGF0ZSwgewogICAgbWF0Y2gsCiAgICByZXBsYWNlCiAgfSkgewogICAgbWF0Y2ggPSBlbnN1cmVSZWdleChtYXRjaCk7CiAgICBtYXRjaCA9IHJlZ2V4VG9TdHJpbmcobWF0Y2gpOwogICAgc3RhdGUudHlwZVRvQ29tcG9uZW50TWFwcGluZ3MucHVzaCh7CiAgICAgIG1hdGNoLAogICAgICByZXBsYWNlCiAgICB9KTsKICB9LAogIGNvbmZpZ3VyZVR5cGUoc3RhdGUsIG9wdGlvbnMpIHsKICAgIGNvbnN0IG1hdGNoID0gcmVnZXhUb1N0cmluZyhlbnN1cmVSZWdleChvcHRpb25zLm1hdGNoKSk7CiAgICBjb25zdCBpZHggPSBzdGF0ZS50eXBlT3B0aW9ucy5maW5kSW5kZXgob2JqID0+IG9iai5tYXRjaCA9PT0gbWF0Y2gpOwogICAgbGV0IG9iaiA9IHsKICAgICAgLi4ub3B0aW9ucywKICAgICAgbWF0Y2gKICAgIH07CiAgICBpZiAoaWR4ID49IDApIHsKICAgICAgb2JqID0gT2JqZWN0LmFzc2lnbihzdGF0ZS50eXBlT3B0aW9uc1tpZHhdLCBvYmopOwogICAgICBzdGF0ZS50eXBlT3B0aW9ucy5zcGxpY2UoaWR4LCAxLCBvYmopOwogICAgfSBlbHNlIHsKICAgICAgY29uc3Qgb2JqID0gT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucywgewogICAgICAgIG1hdGNoCiAgICAgIH0pOwogICAgICBzdGF0ZS50eXBlT3B0aW9ucy5wdXNoKG9iaik7CiAgICB9CiAgfQp9OwpleHBvcnQgY29uc3QgYWN0aW9ucyA9IHsKICByZW1vdmVQcm9kdWN0KHsKICAgIGNvbW1pdAogIH0sIG1ldGFkYXRhKSB7CiAgICBjb21taXQoJ3JlbW92ZScsIG1ldGFkYXRhKTsKICB9LAogIGFkZEZhdm9yaXRlKHsKICAgIGRpc3BhdGNoLAogICAgcm9vdEdldHRlcnMKICB9LCB0eXBlKSB7CiAgICBjb25zdCB0eXBlcyA9IHJvb3RHZXR0ZXJzWydwcmVmcy9nZXQnXShGQVZPUklURV9UWVBFUykgfHwgW107CiAgICBhZGRPYmplY3QodHlwZXMsIHR5cGUpOwogICAgZGlzcGF0Y2goJ3ByZWZzL3NldCcsIHsKICAgICAga2V5OiBGQVZPUklURV9UWVBFUywKICAgICAgdmFsdWU6IHR5cGVzCiAgICB9LCB7CiAgICAgIHJvb3Q6IHRydWUKICAgIH0pOwogIH0sCiAgcmVtb3ZlRmF2b3JpdGUoewogICAgZGlzcGF0Y2gsCiAgICByb290R2V0dGVycwogIH0sIHR5cGUpIHsKICAgIGNvbnN0IHR5cGVzID0gcm9vdEdldHRlcnNbJ3ByZWZzL2dldCddKEZBVk9SSVRFX1RZUEVTKSB8fCBbXTsKICAgIHJlbW92ZU9iamVjdCh0eXBlcywgdHlwZSk7CiAgICBkaXNwYXRjaCgncHJlZnMvc2V0JywgewogICAgICBrZXk6IEZBVk9SSVRFX1RZUEVTLAogICAgICB2YWx1ZTogdHlwZXMKICAgIH0sIHsKICAgICAgcm9vdDogdHJ1ZQogICAgfSk7CiAgfSwKICB0b2dnbGVHcm91cCh7CiAgICBkaXNwYXRjaCwKICAgIHJvb3RHZXR0ZXJzCiAgfSwgewogICAgZ3JvdXAsCiAgICBleHBhbmRlZAogIH0pIHsKICAgIGNvbnN0IGdyb3VwcyA9IHJvb3RHZXR0ZXJzWydwcmVmcy9nZXQnXShFWFBBTkRFRF9HUk9VUFMpOwogICAgaWYgKGV4cGFuZGVkKSB7CiAgICAgIGFkZE9iamVjdChncm91cHMsIGdyb3VwKTsKICAgIH0gZWxzZSB7CiAgICAgIHJlbW92ZU9iamVjdChncm91cHMsIGdyb3VwKTsKICAgIH0KICAgIGRpc3BhdGNoKCdwcmVmcy9zZXQnLCB7CiAgICAgIGtleTogRVhQQU5ERURfR1JPVVBTLAogICAgICB2YWx1ZTogZ3JvdXBzCiAgICB9LCB7CiAgICAgIHJvb3Q6IHRydWUKICAgIH0pOwogIH0sCiAgY29uZmlndXJlVHlwZSh7CiAgICBjb21taXQKICB9LCBvcHRpb25zKSB7CiAgICBjb21taXQoJ2NvbmZpZ3VyZVR5cGUnLCBvcHRpb25zKTsKICB9Cn07CmZ1bmN0aW9uIF9zb3J0R3JvdXAodHJlZSwgbW9kZSkgewogIGNvbnN0IGJ5ID0gWyd3ZWlnaHQ6ZGVzYycsICduYW1lc3BhY2VkJywgJ2xhYmVsJ107CiAgdHJlZS5jaGlsZHJlbiA9IHNvcnRCeSh0cmVlLmNoaWxkcmVuLCBieSk7CiAgZm9yIChjb25zdCBlbnRyeSBvZiB0cmVlLmNoaWxkcmVuKSB7CiAgICBpZiAoZW50cnkuY2hpbGRyZW4pIHsKICAgICAgX3NvcnRHcm91cChlbnRyeSwgbW9kZSk7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIF9hcHBseU1hcHBpbmcob2JqT3JWYWx1ZSwgbWFwcGluZ3MsIGtleUZpZWxkLCBjYWNoZSwgZGVmYXVsdEZuKSB7CiAgbGV0IGtleSA9IG9iak9yVmFsdWU7CiAgbGV0IGZvdW5kID0gZmFsc2U7CiAgaWYgKGtleUZpZWxkKSB7CiAgICBpZiAodHlwZW9mIG9iak9yVmFsdWUgIT09ICdvYmplY3QnKSB7CiAgICAgIHJldHVybiBvYmpPclZhbHVlOwogICAgfQogICAga2V5ID0gZ2V0KG9iak9yVmFsdWUsIGtleUZpZWxkKTsKICAgIGlmICh0eXBlb2Yga2V5ICE9PSAnc3RyaW5nJykgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9CiAgaWYgKGtleSAmJiBjYWNoZSAmJiBjYWNoZVtrZXldKSB7CiAgICByZXR1cm4gY2FjaGVba2V5XTsKICB9CiAgbGV0IG91dCA9IGAke2tleX1gOwogIGZvciAoY29uc3QgcnVsZSBvZiBtYXBwaW5ncykgewogICAgY29uc3QgcmUgPSBzdHJpbmdUb1JlZ2V4KHJ1bGUubWF0Y2gpOwogICAgY29uc3QgY2FwdHVyZWQgPSBvdXQubWF0Y2gocmUpOwogICAgaWYgKGNhcHR1cmVkICYmIHJ1bGUucmVwbGFjZSkgewogICAgICBvdXQgPSBvdXQucmVwbGFjZShyZSwgcnVsZS5yZXBsYWNlKTsKICAgICAgZm91bmQgPSB0cnVlOwogICAgICBpZiAoIXJ1bGUuY29udGludWVPbk1hdGNoKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9CiAgaWYgKCFmb3VuZCAmJiBkZWZhdWx0Rm4pIHsKICAgIG91dCA9IGRlZmF1bHRGbihvdXQsIG9iak9yVmFsdWUpOwogIH0KICBpZiAoY2FjaGUpIHsKICAgIGNhY2hlW2tleV0gPSBvdXQ7CiAgfQogIHJldHVybiBvdXQ7Cn0KZnVuY3Rpb24gX2FkZE1hcHBpbmcobWFwcGluZ3MsIG1hdGNoLCByZXBsYWNlLCB3ZWlnaHQsIGNvbnRpbnVlT25NYXRjaCkgewogIG1hdGNoID0gcmVnZXhUb1N0cmluZyhlbnN1cmVSZWdleChtYXRjaCkpOwogIG1hcHBpbmdzLnB1c2goewogICAgbWF0Y2gsCiAgICByZXBsYWNlLAogICAgd2VpZ2h0LAogICAgY29udGludWVPbk1hdGNoLAogICAgaW5zZXJ0SW5kZXg6IG1hcHBpbmdzLmxlbmd0aAogIH0pOwoKICAvLyBSZS1zb3J0IHRoZSBsaXN0IGJ5IHdlaWdodCAoaGlnaGVzdCBmaXJzdCkgYW5kIGluc2VydCB0aW1lIChvbGRlc3QgZmlyc3QpCiAgbWFwcGluZ3Muc29ydCgoYSwgYikgPT4gewogICAgY29uc3QgcHJpID0gYi53ZWlnaHQgLSBhLndlaWdodDsKICAgIGlmIChwcmkpIHsKICAgICAgcmV0dXJuIHByaTsKICAgIH0KICAgIHJldHVybiBhLmluc2VydEluZGV4IC0gYi5pbnNlcnRJbmRleDsKICB9KTsKfQoKLy8gUmVnZXhlcyBjYW4ndCBiZSByZXByZXNlbnRlZCBpbiBzdGF0ZSBiZWNhdXNlIHRoZXkgZG9uJ3Qgc2VyaWFsaXplIHRvIEpTT04uLgpjb25zdCByZWdleENhY2hlID0ge307CmZ1bmN0aW9uIHJlZ2V4VG9TdHJpbmcocmVnZXgpIHsKICByZXR1cm4gcmVnZXguc291cmNlOwp9CmZ1bmN0aW9uIHN0cmluZ1RvUmVnZXgoc3RyKSB7CiAgbGV0IG91dCA9IHJlZ2V4Q2FjaGVbc3RyXTsKICBpZiAoIW91dCkgewogICAgb3V0ID0gbmV3IFJlZ0V4cChzdHIpOwogICAgcmVnZXhDYWNoZVtzdHJdID0gb3V0OwogIH0KICByZXR1cm4gb3V0Owp9CmZ1bmN0aW9uIGlmSGF2ZShnZXR0ZXJzLCBvcHRpb24pIHsKICBzd2l0Y2ggKG9wdGlvbikgewogICAgY2FzZSBJRl9IQVZFLlYyX01PTklUT1JJTkc6CiAgICAgIHsKICAgICAgICByZXR1cm4gaGF2ZVYyTW9uaXRvcmluZyhnZXR0ZXJzKTsKICAgICAgfQogICAgY2FzZSBJRl9IQVZFLlBST0pFQ1Q6CiAgICAgIHsKICAgICAgICByZXR1cm4gISFwcm9qZWN0KGdldHRlcnMpOwogICAgICB9CiAgICBjYXNlIElGX0hBVkUuTk9fUFJPSkVDVDoKICAgICAgewogICAgICAgIHJldHVybiAhcHJvamVjdChnZXR0ZXJzKTsKICAgICAgfQogICAgY2FzZSBJRl9IQVZFLk5PVF9WMV9JU1RJTzoKICAgICAgewogICAgICAgIHJldHVybiAhaXNWMUlzdGlvKGdldHRlcnMpOwogICAgICB9CiAgICBjYXNlIElGX0hBVkUuTVVMVElfQ0xVU1RFUjoKICAgICAgewogICAgICAgIHJldHVybiBnZXR0ZXJzLmlzTXVsdGlDbHVzdGVyOwogICAgICB9CiAgICBjYXNlIElGX0hBVkUuTkVVVkVDVE9SX05BTUVTUEFDRToKICAgICAgewogICAgICAgIHJldHVybiBnZXR0ZXJzW2BjbHVzdGVyL2FsbGBdKE5BTUVTUEFDRSkuZmluZChuID0+IG4ubWV0YWRhdGEubmFtZSA9PT0gTkVVX1ZFQ1RPUl9OQU1FU1BBQ0UpOwogICAgICB9CiAgICBjYXNlIElGX0hBVkUuQURNSU46CiAgICAgIHsKICAgICAgICByZXR1cm4gaXNBZG1pblVzZXIoZ2V0dGVycyk7CiAgICAgIH0KICAgIGNhc2UgSUZfSEFWRS5NQ01fRElTQUJMRUQ6CiAgICAgIHsKICAgICAgICByZXR1cm4gIWdldHRlcnNbJ2lzUmFuY2hlckluSGFydmVzdGVyJ107CiAgICAgIH0KICAgIGNhc2UgSUZfSEFWRS5OT1RfU1RBTkRBTE9ORV9IQVJWRVNURVI6CiAgICAgIHsKICAgICAgICByZXR1cm4gIWdldHRlcnNbJ2lzU3RhbmRhbG9uZUhhcnZlc3RlciddOwogICAgICB9CiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gZmFsc2U7CiAgfQp9CgovLyBDb3VsZCBsaXN0IGEgbGFyZ2VyIHNldCBvZiByZXNvdXJjZXMgdGhhdCB0eXBpY2FsbHkgb25seSBhbiBhZG1pbiB1c2VyIHdvdWxkIGhhdmUKZXhwb3J0IGZ1bmN0aW9uIGlzQWRtaW5Vc2VyKGdldHRlcnMpIHsKICB2YXIgX2dldHRlcnMkbWFuYWdlbWVudFMsIF9nZXR0ZXJzJG1hbmFnZW1lbnRTMiwgX2dldHRlcnMkbWFuYWdlbWVudFMzLCBfZ2V0dGVycyRtYW5hZ2VtZW50UzQsIF9nZXR0ZXJzJG1hbmFnZW1lbnRTNTsKICBjb25zdCBjYW5FZGl0U2V0dGluZ3MgPSAoKChfZ2V0dGVycyRtYW5hZ2VtZW50UyA9IGdldHRlcnNbJ21hbmFnZW1lbnQvc2NoZW1hRm9yJ10oTUFOQUdFTUVOVC5TRVRUSU5HKSkgPT09IG51bGwgfHwgX2dldHRlcnMkbWFuYWdlbWVudFMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9nZXR0ZXJzJG1hbmFnZW1lbnRTLnJlc291cmNlTWV0aG9kcykgfHwgW10pLmluY2x1ZGVzKCdQVVQnKTsKICBjb25zdCBjYW5FZGl0RmVhdHVyZUZsYWdzID0gKCgoX2dldHRlcnMkbWFuYWdlbWVudFMyID0gZ2V0dGVyc1snbWFuYWdlbWVudC9zY2hlbWFGb3InXShNQU5BR0VNRU5ULkZFQVRVUkUpKSA9PT0gbnVsbCB8fCBfZ2V0dGVycyRtYW5hZ2VtZW50UzIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9nZXR0ZXJzJG1hbmFnZW1lbnRTMi5yZXNvdXJjZU1ldGhvZHMpIHx8IFtdKS5pbmNsdWRlcygnUFVUJyk7CiAgY29uc3QgY2FuSW5zdGFsbEFwcHMgPSAoKChfZ2V0dGVycyRtYW5hZ2VtZW50UzMgPSBnZXR0ZXJzWydtYW5hZ2VtZW50L3NjaGVtYUZvciddKENBVEFMT0cuQVBQKSkgPT09IG51bGwgfHwgX2dldHRlcnMkbWFuYWdlbWVudFMzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZ2V0dGVycyRtYW5hZ2VtZW50UzMucmVzb3VyY2VNZXRob2RzKSB8fCBbXSkuaW5jbHVkZXMoJ1BVVCcpOwogIGNvbnN0IGNhbkFkZFJlcG9zID0gKCgoX2dldHRlcnMkbWFuYWdlbWVudFM0ID0gZ2V0dGVyc1snbWFuYWdlbWVudC9zY2hlbWFGb3InXShDQVRBTE9HLkNMVVNURVJfUkVQTykpID09PSBudWxsIHx8IF9nZXR0ZXJzJG1hbmFnZW1lbnRTNCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2dldHRlcnMkbWFuYWdlbWVudFM0LnJlc291cmNlTWV0aG9kcykgfHwgW10pLmluY2x1ZGVzKCdQVVQnKTsKICBjb25zdCBjYW5QdXRIZWxtT3BlcmF0aW9ucyA9ICgoKF9nZXR0ZXJzJG1hbmFnZW1lbnRTNSA9IGdldHRlcnNbJ21hbmFnZW1lbnQvc2NoZW1hRm9yJ10oQ0FUQUxPRy5PUEVSQVRJT04pKSA9PT0gbnVsbCB8fCBfZ2V0dGVycyRtYW5hZ2VtZW50UzUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9nZXR0ZXJzJG1hbmFnZW1lbnRTNS5yZXNvdXJjZU1ldGhvZHMpIHx8IFtdKS5pbmNsdWRlcygnUFVUJyk7CiAgcmV0dXJuIGNhbkVkaXRTZXR0aW5ncyAmJiBjYW5FZGl0RmVhdHVyZUZsYWdzICYmIGNhbkluc3RhbGxBcHBzICYmIGNhbkFkZFJlcG9zICYmIGNhblB1dEhlbG1PcGVyYXRpb25zOwp9CmZ1bmN0aW9uIF9maW5kQ29sdW1uQnlOYW1lKHNjaGVtYSwgY29sTmFtZSkgewogIGNvbnN0IGF0dHJpYnV0ZXMgPSBzY2hlbWEuYXR0cmlidXRlcyB8fCB7fTsKICBjb25zdCBjb2x1bW5zID0gYXR0cmlidXRlcy5jb2x1bW5zIHx8IFtdOwogIHJldHVybiBmaW5kQnkoY29sdW1ucywgJ25hbWUnLCBjb2xOYW1lKTsKfQoKLy8gSXMgVjEgSXN0aW8gaW5zdGFsbGVkPwpmdW5jdGlvbiBpc1YxSXN0aW8oZ2V0dGVycykgewogIHZhciBfY2x1c3RlciRzdGF0dXM7CiAgY29uc3QgY2x1c3RlciA9IGdldHRlcnNbJ2N1cnJlbnRDbHVzdGVyJ107CiAgcmV0dXJuICEhKGNsdXN0ZXIgIT09IG51bGwgJiYgY2x1c3RlciAhPT0gdm9pZCAwICYmIChfY2x1c3RlciRzdGF0dXMgPSBjbHVzdGVyLnN0YXR1cykgIT09IG51bGwgJiYgX2NsdXN0ZXIkc3RhdHVzICE9PSB2b2lkIDAgJiYgX2NsdXN0ZXIkc3RhdHVzLmlzdGlvRW5hYmxlZCk7Cn0KZnVuY3Rpb24gaWZIYXZlVmVyYihyb290R2V0dGVycywgbW9kdWxlLCB2ZXJiLCBoYXZlSWRzKSB7CiAgZm9yIChjb25zdCBoYXZlSWQgb2YgaGF2ZUlkcykgewogICAgY29uc3Qgc2NoZW1hID0gcm9vdEdldHRlcnNbYCR7bW9kdWxlfS9zY2hlbWFGb3JgXShoYXZlSWQpOwogICAgY29uc3Qgd2FudCA9IHZlcmIudG9Mb3dlckNhc2UoKTsKICAgIGNvbnN0IGNvbGxlY3Rpb25NZXRob2RzID0gc2NoZW1hLmNvbGxlY3Rpb25NZXRob2RzIHx8IFtdOwogICAgY29uc3QgcmVzb3VyY2VNZXRob2RzID0gc2NoZW1hLnJlc291cmNlTWV0aG9kcyB8fCBbXTsKICAgIGNvbnN0IGhhdmUgPSBbLi4uY29sbGVjdGlvbk1ldGhvZHMsIC4uLnJlc291cmNlTWV0aG9kc10ubWFwKHggPT4geC50b0xvd2VyQ2FzZSgpKTsKICAgIGlmICghaGF2ZS5pbmNsdWRlcyh3YW50KSAmJiAhaGF2ZS5pbmNsdWRlcyhgYmxvY2tlZC0ke3dhbnR9YCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KICByZXR1cm4gdHJ1ZTsKfQoKLy8gTG9vayBhdCB0aGUgbmFtZXNwYWNlIGZpbHRlcnMgdG8gZGV0ZXJtaW5lIGlmIGEgcHJvamVjdCBpcyBzZWxlY3RlZApleHBvcnQgZnVuY3Rpb24gcHJvamVjdChnZXR0ZXJzKSB7CiAgdmFyIF9nZXR0ZXJzJGN1cnJlbnRDbHVzdDsKICBjb25zdCBjbHVzdGVySWQgPSAoX2dldHRlcnMkY3VycmVudENsdXN0ID0gZ2V0dGVyc1snY3VycmVudENsdXN0ZXInXSkgPT09IG51bGwgfHwgX2dldHRlcnMkY3VycmVudENsdXN0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZ2V0dGVycyRjdXJyZW50Q2x1c3QuaWQ7CiAgaWYgKCFjbHVzdGVySWQpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBmaWx0ZXJzID0gZ2V0dGVyc1snbmFtZXNwYWNlRmlsdGVycyddOwogIGNvbnN0IG5hbWVzcGFjZXMgPSBbXTsKICBsZXQgcHJvamVjdE5hbWUgPSBudWxsOwogIGZvciAoY29uc3QgZmlsdGVyIG9mIGZpbHRlcnMpIHsKICAgIGNvbnN0IFt0eXBlLCBpZF0gPSBmaWx0ZXIuc3BsaXQoJzovLycsIDIpOwogICAgaWYgKHR5cGUgPT09ICdwcm9qZWN0JykgewogICAgICBpZiAocHJvamVjdE5hbWUgIT09IG51bGwpIHsKICAgICAgICAvLyBNb3JlIHRoYW4gb25lIHByb2plY3Qgc2VsZWN0ZWQKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBwcm9qZWN0TmFtZSA9IGlkOwogICAgfSBlbHNlIGlmICh0eXBlID09PSAnbnMnKSB7CiAgICAgIG5hbWVzcGFjZXMucHVzaChpZCk7CiAgICB9IGVsc2UgewogICAgICAvLyBTb21ldGhpbmcgb3RoZXIgdGhhbiBwcm9qZWN0IG9yIG5hbWVzcGFjZQogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9CgogIC8vIE5vIHByb2plY3QgZm91bmQ/CiAgaWYgKCFwcm9qZWN0TmFtZSkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICAvLyBXZSBoYXZlIG9uZSBwcm9qZWN0IGFuZCBhIHNldCBvZiBuYW1lc3BhY2VzCiAgLy8gQ2hlY2sgdGhhdCBhbGwgb2YgdGhlIG5hbWVzcGFjZXMgYmVsb25nIHRvIHRoZSBwcm9qZWN0CiAgY29uc3QgcHJvamVjdCA9IGdldHRlcnNbJ21hbmFnZW1lbnQvYnlJZCddKE1BTkFHRU1FTlQuUFJPSkVDVCwgYCR7Y2x1c3RlcklkfS8ke3Byb2plY3ROYW1lfWApOwoKICAvLyBObyBhZGRpdGlvbmFsIG5hbWVzcGFjZXMgbWVhbnMganVzdCB0aGUgcHJvamVjdCBpcyBzZWxlY3RlZAogIGlmIChuYW1lc3BhY2VzLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIHByb2plY3Q7CiAgfQoKICAvLyBDb252ZXJ0IHRoZSBwcm9qZWN0IG5hbWVzcGFjZXMgaW50byBhIG1hcCBzbyB3ZSBjYW4gY2hlY2sgZXhpc3RlbmNlIGVhc2lseQogIGNvbnN0IHByak5hbWVzcGFjZU1hcCA9IHByb2plY3QubmFtZXNwYWNlcy5yZWR1Y2UoKG0sIG5zKSA9PiB7CiAgICBtW25zLm1ldGFkYXRhLm5hbWVdID0gdHJ1ZTsKICAgIHJldHVybiBtOwogIH0sIHt9KTsKCiAgLy8gQWxsIG9mIHRoZSBuYW1lc3BhY2UgZmlsdGVycyBtdXN0IGJlbG9uZyB0byB0aGUgcHJvamVjdAogIGNvbnN0IGZvdW5kID0gbmFtZXNwYWNlcy5yZWR1Y2UoKHRvdGFsLCBucykgPT4gewogICAgcmV0dXJuIHByak5hbWVzcGFjZU1hcFtuc10gPyB0b3RhbCArIDEgOiAwOwogIH0sIDApOwogIGlmIChmb3VuZCAhPT0gbmFtZXNwYWNlcy5sZW5ndGgpIHsKICAgIHJldHVybiBudWxsOwogIH0KICByZXR1cm4gcHJvamVjdDsKfQpmdW5jdGlvbiBoYXNDdXN0b20oc3RhdGUsIHJvb3RTdGF0ZSwga2luZCwga2V5LCBmYWxsYmFjaykgewogIGNvbnN0IGNhY2hlID0gc3RhdGUuY2FjaGVba2luZF07CiAgaWYgKGNhY2hlW2tleV0gIT09IHVuZGVmaW5lZCkgewogICAgcmV0dXJuIGNhY2hlW2tleV07CiAgfQoKICAvLyBDaGVjayB0byBzZWUgaWYgdGhlIGN1c3RvbSBraW5kIGlzIHByb3ZpZGVkIGJ5IGEgcGx1Z2luIChpZ25vcmUgYm9vbGVhbnMpCiAgY29uc3QgcGx1Z2luQ29tcG9uZW50ID0gcm9vdFN0YXRlLiRwbHVnaW4uZ2V0RHluYW1pYyhraW5kLCBrZXkpOwogIGlmICh0eXBlb2YgcGx1Z2luQ29tcG9uZW50ICE9PSAnYm9vbGVhbicgJiYgISFwbHVnaW5Db21wb25lbnQpIHsKICAgIGNhY2hlW2tleV0gPSB0cnVlOwogICAgcmV0dXJuIGNhY2hlW2tleV07CiAgfQoKICAvLyBGYWxsYmFjawogIHRyeSB7CiAgICBmYWxsYmFjayhrZXkpOwogICAgY2FjaGVba2V5XSA9IHRydWU7CiAgfSBjYXRjaCAoZSkgewogICAgY2FjaGVba2V5XSA9IGZhbHNlOwogIH0KICByZXR1cm4gY2FjaGVba2V5XTsKfQpmdW5jdGlvbiBsb2FkRXh0ZW5zaW9uKHJvb3RTdGF0ZSwga2luZCwga2V5LCBmYWxsYmFjaykgewogIGNvbnN0IGV4dCA9IHJvb3RTdGF0ZS4kcGx1Z2luLmdldER5bmFtaWMoa2luZCwga2V5KTsKICBpZiAoZXh0KSB7CiAgICBpZiAodHlwZW9mIGV4dCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICByZXR1cm4gZXh0OwogICAgfQogICAgcmV0dXJuICgpID0+IGV4dDsKICB9CiAgcmV0dXJuIGZhbGxiYWNrKGtleSk7Cn0="},{"version":3,"names":["AGE","NAME","NAMESPACE","NAMESPACE_COL","STATE","CATALOG","COUNT","SCHEMA","MANAGEMENT","VIEW_IN_API","EXPANDED_GROUPS","FAVORITE_TYPES","addObject","findBy","isArray","removeObject","filterBy","clone","get","ensureRegex","escapeHtml","escapeRegex","ucFirst","pluralize","importChart","importList","importDetail","importEdit","listProducts","loadProduct","importCustomPromptRemove","resolveList","resolveEdit","resolveWindowComponent","importWindowComponent","importLogin","resolveChart","resolveDetail","importDialog","importMachineConfig","resolveMachineConfigComponent","resolveCloudCredentialComponent","importCloudCredential","EXPLORER","isObject","normalizeType","sortBy","haveV2Monitoring","NEU_VECTOR_NAMESPACE","createHeaders","rowValueGetter","NAMESPACED","CLUSTER_LEVEL","BOTH","TYPE_MODES","ALL","BASIC","FAVORITE","USED","ROOT","SPOOFED_PREFIX","SPOOFED_API_PREFIX","instanceMethods","graphConfigMap","IF_HAVE","V2_MONITORING","PROJECT","NO_PROJECT","NOT_V1_ISTIO","MULTI_CLUSTER","NEUVECTOR_NAMESPACE","ADMIN","MCM_DISABLED","NOT_STANDALONE_HARVESTER","DSL","store","product","module","inOpt","opt","name","weight","inStore","inExplorer","removable","showClusterSwitcher","showNamespaceFilter","public","filterMode","k","Array","map","r","regexToString","commit","basicType","types","group","Object","values","groupBy","type","field","headers","paginationHeaders","forEach","header","getValue","valueProp","value","hideBulkActions","configureType","match","options","graphConfig","componentForType","replace","ignoreType","regexOrString","ignoreGroup","cb","weightGroup","input","forBasic","groups","setGroupDefaultType","defaultType","weightType","mapGroup","continueOnMatch","mapType","moveType","virtualType","obj","spoofedType","called","applyProducts","$plugin","impl","init","loadProducts","productsLoaded","state","products","virtualTypes","spoofedTypes","basicTypes","groupIgnore","groupWeights","groupDefaultTypes","basicGroupWeights","groupMappings","typeIgnore","basicTypeWeights","typeWeights","typeMappings","typeMoveMappings","typeToComponentMappings","typeOptions","schemaGeneration","cache","typeMove","groupLabel","ignore","list","chart","detail","edit","componentFor","promptRemove","windowComponents","getters","labelFor","rootState","rootGetters","schema","count","language","_applyMapping","_schema$attributes","key","id","toLowerCase","trim","out","attributes","kind","groupLabelFor","schemaOrName","moved","rule","re","stringToRegex","split","x","join","groupForBasicType","schemaId","_state$basicTypes","optionsFor","def","isCreatable","isEditable","isRemovable","showState","showAge","canYaml","namespaced","listGroups","listGroupsWillOverride","listMandatorySort","depaginate","customRoute","undefined","resourceEditMasthead","schemaOrType","pagination","_schemaOrType$$ctx","found","find","entry","test","opts","assign","storeOptionsFor","$ctx","storeOpts","isFavorite","includes","typeWeightFor","_type","groupWeightFor","groupDefaultTypeFor","getTree","productId","mode","allTypes","clusterId","namespaceMode","currentType","search","isBasic","searchRegex","RegExp","root","children","keys","sort","a","b","length","currentLocal","defaultLocal","_typeObj$schema","typeObj","isIgnored","currentStore","label","labelKey","labelDisplay","highlightLabel","_ensureGroup","route","params","cluster","resource","push","exact","overview","_sortGroup","tree","isRoot","startsWith","parent","original","defaultLabel","isSpoofed","productSpoofedTypes","some","st","isVirtual","productVirtualTypes","getSpoofedInstances","_instanceMethods$prod","getInstances","instances","instance","_instance$links","_instance$links2","_instance$links3","_instance$links4","link","apiLink","links","remove","self","update","view","getSpoofedInstance","productInstances","allSpoofedTypes","flat","spoofedSchemas","flatMap","schemas","allSpoofedSchemas","modes","_state$products$find","_rootGetters$currentC","_rootGetters","p","isLocal","currentCluster","isRancher","counts","schemaModes","m","attrs","every","s","onlyBasic","invalidType","ifRancherCluster","localOnly","entries","enabled","nonUsedModes","filter","isDev","item","virtSpoofedModes","_out$mode","ifHave","ifHaveType","ifHaveTypeArray","satisfiesIfHave","i","targetedSchemas","haveIds","ifHaveVerb","ifHaveSubTypes","hasSome","ifFeature","feature","splice","indexOf","groupByFor","hideBulkActionsFor","headersFor","_schema$$ctx","storeHeadersFor","res","columns","namespace","age","configuredPaginationHeaders","_state$paginationHead","configuredHeaders","_state$headers","hasCustomList","rawType","hasCustom","hasCustomChart","hasCustomDetail","subType","hasGraph","hasCustomEdit","hasComponent","path","hasCustomPromptRemove","require","resolve","hasCustomWindowComponent","hasCustomMachineConfigComponent","hasCustomCloudCredentialComponent","importComponent","loadExtension","authType","mapping","_schema$attributes2","activeProducts","knownTypes","knownGroups","ifGetter","_id","_group","features","f","t","ifHaveGroup","isProductActive","colName","col","_findColumnByName","isProductRegistered","productName","prod","productByName","mutations","schemaChanged","plugin","existing","findIndex","v","_existing","_existing2","_existing3","_existing4","rootProduct","copy","virtual","collection","g","_addMapping","idx","actions","removeProduct","metadata","addFavorite","dispatch","removeFavorite","toggleGroup","expanded","by","objOrValue","mappings","keyField","defaultFn","captured","insertIndex","pri","regexCache","regex","source","str","option","project","isV1Istio","isMultiCluster","n","isAdminUser","_getters$managementS","_getters$managementS2","_getters$managementS3","_getters$managementS4","_getters$managementS5","canEditSettings","SETTING","resourceMethods","canEditFeatureFlags","FEATURE","canInstallApps","APP","canAddRepos","CLUSTER_REPO","canPutHelmOperations","OPERATION","_cluster$status","status","istioEnabled","verb","haveId","want","collectionMethods","have","_getters$currentClust","filters","namespaces","projectName","prjNamespaceMap","reduce","ns","total","fallback","pluginComponent","getDynamic","e","ext"],"sources":["/app/node_modules/@rancher/shell/store/type-map.js"],"sourcesContent":["// This file has 2 sections that control getting and using specializations of particular types\n// over the generic info that is specified or generated from schemas.\n//\n// 1) Getting info about types\n//\n// labelFor(schema, count)    Get the display label for a schema.  Count is (in English) 1 or not-1 for pluralizing\n// groupLabelFor(schema)      Get the label for the API group of this schema's type\n// isIgnored(schema)          Returns true if this type should be hidden from the tree\n// groupForBasicType(schema)  Returns the group a type should be shown in basic view, or false-y if it shouldn't be shown.\n// typeWeightFor(type, forBasic)   Get the weight value for a particular type label\n// groupWeightFor(group, forBasic) Get the weight value for a particular group\n// headersFor(schema)         Returns the column definitions for a type to give to SortableTable\n// activeProducts()           Returns the list of products that are installed and should be shown\n//\n// 2) Detecting and using custom list/detail/edit/header components\n//\n// hasCustomList(type)              Does type have a custom list implementation?\n// hasCustomDetail(type[,subType])  Does type have a custom detail implementation?\n// hasCustomEdit(type[,subType])    Does type have a custom edit implementation?\n// importList(type)                 Returns a promise that resolves to the list component for type\n// importDetail(type[,subType])     Returns a promise that resolves to the detail component for type\n// importEdit(type[,subType])       Returns a promise that resolves to the edit component for type\n// optionsFor(schemaOrType)         Return the configured options for a type (from configureType)\n//\n// 3) Changing specialization info about a type\n// For all:\n//   let { thingYouWant } = DSL(instanceOfTheStore, 'product');\n//\n// product(                   Add a product into the nav\n//   removable,               -- Is the product removable (true) or built-in (false).\n//   weight,                  -- Sort order and divider sections in the product menu.  3=global (fleet, ecm), 2=always on (apps, explorer) 1=other\n//   showClusterSwitcher,     -- Show the cluster switcher in the header (default true)\n//   showNamespaceFilter,     -- Show the namespace filter in the header (default false)\n//   showWorkspaceSwitcher,   -- Show the workspace switcher in the header (conflicts with namespace) (default false)\n//   ifHave,                  -- Show this product only if the given capability is available\n//   ifHaveGroup,             -- Show this product only if the given group exists in the store [inStore]\n//   ifHaveType,              -- Show this product only if the given type exists in the store [inStore], This can also be specified as an object { type: TYPE, store: 'management' } if the type isn't in the current [inStore]\n//   ifHaveVerb,              -- In combination with ifHaveTYpe, show it only if the type also has this collectionMethod\n//   inStore,                 -- Which store to look at for if* above and the left-nav, defaults to \"cluster\"\n//   rootProduct,             -- Optional root (parent) product - if set, used to optimize navigation when product changes stays within root product\n//   inExplorer,              -- Determines if the product is to be scoped to the explorer\n//   public,                  -- If true, show to all users.  If false, only show when the Developer Tools pref is on (default true)\n//   category,                -- Group to show the product in for the nav hamburger menu\n//   typeStoreMap,            -- An object mapping types to the store that should be used to retrieve information about the type\n//   hideSystemResources      -- Hide resources in namespaces where namespace.isSystem === true, or a namespace managed by fleet (per its annotation) and hide those namespaces from ns/project list and nsfilter (default false)\n//   hideNamespaceLocation    -- Hide the namespace link in the ResourceDetail masthead of namespaced resources and hide the ExplorerProjectsNamespaces namespace link (default false)\n// })\n//\n// externalLink(stringOrFn)  The product has an external page (function gets context object\n//\n// virtualType(obj)           Add an item to the tree that goes to a route instead of an actual type.\n//                            --  obj can contain anything in the objects getTree returns.\n//                            --  obj must have a `name` that is unique among all virtual types.\n//                            -- `cluster` is automatically added to route.params if it exists.\n//\n// spoofedType(obj)           Create a fake type that can be treated like a normal type\n//\n// basicType(                 Mark type(s) as always shown in the top of the nav\n//   type(s),                 -- Type name or array of type names\n//   group                    -- Group to show the type(s) under; false-y for top-level.\n// )\n// basicType(                 Mark all types in group as always shown in the top of the nav\n//   group,                   -- Group to show\n//   asLabel                  -- Label to display the group as; false-y for top-level.\n// )\n// ignoreType(type)           Never show type\n// weightType(                Set the weight (sorting) order of one or more types\n//   typeOrArrayOfTypes,\n//   weight,                  -- Higher numbers are shown first/higher up on the nav tree\n//   forBasic                 -- Apply to basic type instead of regular type tree\n// )\n// mapType(                   Remap a type id to a display name\n//   matchRegexOrString,      -- Type to match, or regex that matches types\n//   replacementStringOrFn,   -- String to replace the type with, or\n//                            -- sync function: (type, capturedString, schemaObj => { return 'new-type'; }\n//   mapWeight,               -- Priority for apply this mapping (higher numbers applied first)\n//   continueOnMatch          -- If true, continue applying to hit other rules that might match the new type.\n// )\n// moveType(                  Change the group a type is in\n//   matchRegexOrString,      -- Type to match, or regex that matches types\n//   newGroup,                -- Group to move the type into\n//   mapWeight,               -- Priority for apply this mapping (higher numbers applied first)\n// )\n// componentForType(          Map matching types to a single component name\n// (                          (this is helpful if multiple types should be rendered by a single component)\n//   matchRegexOrString,      -- Type to match, or regex that matches types\n//   replacementString        -- String to replace the type with\n// )\n// configureType(            Display options for a particular type\n//   type,                    -- Type to apply to\n//  options                   -- Object of options.  Defaults/Supported: {\n//                               isCreatable: true, -- If false, disable create even if schema says it's allowed\n//                               isEditable: true,  -- Ditto, for edit\n//                               isRemovable: true,  -- Ditto, for remove/delete\n//                               showState: true,  -- If false, hide state in columns and masthead\n//                               showAge: true,    -- If false, hide age in columns and masthead\n//                               showConfigView: true -- If false, hide masthead config button in view mode\n//                               showListMasthead: true, -- If false, hide masthead in list view\n//                               canYaml: true,\n//                               resource: undefined       -- Use this resource in ResourceDetails instead\n//                               resourceDetail: undefined -- Use this resource specifically for ResourceDetail's detail component\n//                               resourceEdit: undefined   -- Use this resource specifically for ResourceDetail's edit component\n//                               depaginate: undefined -- Use this to depaginate requests for this type\n//                               resourceEditMasthead: true   -- Show the Masthead in the edit resource component\n//                               customRoute: undefined,\n//                               hasGraph: undefined   -- If true, render ForceDirectedTreeChart graph (ATTENTION: option graphConfig is needed also!!!)\n//                               graphConfig: undefined   -- Use this to pass along the graph configuration\n//                               notFilterNamespace:  undefined -- Define namespaces that do not need to be filtered\n//                               localOnly: False -- Hide this type from the nav/search bar on downstream clusters\n//                           }\n// )\n// ignoreGroup(group):        Never show group or any types in it\n// weightGroup(               Set the weight (sorting) of one or more groups\n//   groupOrArrayOfGroups,    -- see weightType...\n//   weight\n// )\n// setGroupDefaultType(       Set the default child type to show when the group is expanded\n//   groupOrArrayOfGroups,    -- see setGroupDefaultType...\n//   defaultType\n// )\n// mapGroup(                  Remap a group name to a display name\n//   matchRegexOrString,      -- see mapType...\n//   replacementString,\n//   mapWeight,\n//   continueOnMatch\n// )\nimport { AGE, NAME, NAMESPACE as NAMESPACE_COL, STATE } from '@shell/config/table-headers';\nimport {\n  CATALOG,\n  COUNT,\n  SCHEMA,\n  MANAGEMENT,\n  NAMESPACE\n} from '@shell/config/types';\nimport { VIEW_IN_API, EXPANDED_GROUPS, FAVORITE_TYPES } from '@shell/store/prefs';\nimport {\n  addObject, findBy, isArray, removeObject, filterBy\n} from '@shell/utils/array';\nimport { clone, get } from '@shell/utils/object';\nimport {\n  ensureRegex, escapeHtml, escapeRegex, ucFirst, pluralize\n} from '@shell/utils/string';\nimport {\n  importChart, importList, importDetail, importEdit, listProducts, loadProduct, importCustomPromptRemove, resolveList, resolveEdit, resolveWindowComponent, importWindowComponent, importLogin, resolveChart, resolveDetail, importDialog, importMachineConfig, resolveMachineConfigComponent, resolveCloudCredentialComponent, importCloudCredential\n} from '@shell/utils/dynamic-importer';\n\nimport { NAME as EXPLORER } from '@shell/config/product/explorer';\nimport isObject from 'lodash/isObject';\nimport { normalizeType } from '@shell/plugins/dashboard-store/normalize';\nimport { sortBy } from '@shell/utils/sort';\n\nimport { haveV2Monitoring } from '@shell/utils/monitoring';\nimport { NEU_VECTOR_NAMESPACE } from '@shell/config/product/neuvector';\nimport { createHeaders, rowValueGetter } from '@shell/store/type-map.utils';\n\nexport const NAMESPACED = 'namespaced';\nexport const CLUSTER_LEVEL = 'cluster';\nexport const BOTH = 'both';\n\nexport const TYPE_MODES = {\n  /**\n   * allTypes usage: All resource types\n   *\n   * getTree usage: Remove ignored schemas, resources not applicable to ns, etc\n   */\n  ALL:      'all',\n  /**\n   * Represents resource types that should be shown at the top of the side nav.\n   *\n   * For example all fixed resource types above `More Resources` in the cluster explorer\n   *\n   * These will always be shown in the side nav\n   *\n   * allTypes usage: Resources that are in a group\n   *\n   * getTree usage: Remove ignored schemas, resources not applicable to ns, etc\n   */\n  BASIC:    'basic',\n  /**\n   * Represents any type of resource type that has been favourited\n   *\n   * These will always be shown in the side nav.\n   *\n   * allTypes usage: Resource types that have been favorited\n   *\n   * getTree usage: Remove ignored schemas, resources not applicable to ns, etc\n   */\n  FAVORITE: 'favorite',\n  /**\n   * Represents no virtual or spoofed types that have a count.\n   *\n   * For example the `More Resource` in the cluster explorer\n   *\n   * These will be shown in the side nav if there are resources in the ns filter OR the resource is not namespaces\n   *\n   * allTypes usage: All resource types that are not virtual or spoofed\n   *\n   * getTree usage: Remove types with no counts. Remove ignored schemas, resources not applicable to ns, etc\n   */\n  USED:     'used',\n};\n\nexport const ROOT = 'root';\n\nexport const SPOOFED_PREFIX = '__[[spoofed]]__';\nexport const SPOOFED_API_PREFIX = '__[[spoofedapi]]__';\n\nconst instanceMethods = {};\nconst graphConfigMap = {};\n\nexport const IF_HAVE = {\n  V2_MONITORING:            'v2-monitoring',\n  PROJECT:                  'project',\n  NO_PROJECT:               'no-project',\n  NOT_V1_ISTIO:             'not-v1-istio',\n  MULTI_CLUSTER:            'multi-cluster',\n  NEUVECTOR_NAMESPACE:      'neuvector-namespace',\n  ADMIN:                    'admin-user',\n  MCM_DISABLED:             'mcm-disabled',\n  NOT_STANDALONE_HARVESTER: 'not-standalone-harvester',\n};\n\nexport function DSL(store, product, module = 'type-map') {\n  // store.commit(`${ module }/product`, { name: product });\n\n  return {\n    product(inOpt) {\n      const opt = {\n        name:                product,\n        weight:              1,\n        inStore:             'cluster',\n        inExplorer:          false,\n        removable:           true,\n        showClusterSwitcher: true,\n        showNamespaceFilter: false,\n        public:              true,\n        filterMode:          'namespaces',\n        ...inOpt\n      };\n\n      // Convert strings to regex's - we do this once here for efficiency\n      for ( const k of ['ifHaveGroup', 'ifHaveType'] ) {\n        if ( opt[k] ) {\n          if (Array.isArray(opt[k])) {\n            opt[k] = opt[k].map((r) => regexToString(ensureRegex(r)));\n          } else {\n            opt[k] = regexToString(ensureRegex(opt[k]));\n          }\n        }\n      }\n\n      store.commit(`${ module }/product`, opt);\n    },\n\n    basicType(types, group) {\n      // Support passing in a map of types and using just the values\n      if ( !isArray(types) && types && isObject(types) ) {\n        types = Object.values(types);\n      }\n\n      store.commit(`${ module }/basicType`, {\n        product, types, group\n      });\n    },\n\n    // Type- and Group-dependent\n    groupBy(type, field) {\n      store.commit(`${ module }/groupBy`, { type, field });\n    },\n\n    headers(type, headers, paginationHeaders = []) {\n      headers.forEach((header) => {\n        // If on the client, then use the value getter if there is one\n        if (header.getValue) {\n          // we need to store the .value prop for the advanced filtering\n          header.valueProp = header.value;\n          header.value = header.getValue;\n        }\n\n        delete header.getValue;\n      });\n\n      store.commit(`${ module }/headers`, { type, headers });\n      store.commit(`${ module }/paginationHeaders`, { type, paginationHeaders });\n    },\n\n    hideBulkActions(type, field) {\n      store.commit(`${ module }/hideBulkActions`, { type, field });\n    },\n\n    configureType(match, options) {\n      if (options.graphConfig) {\n        graphConfigMap[match] = options.graphConfig;\n        delete options.graphConfig;\n      }\n      store.commit(`${ module }/configureType`, { ...options, match });\n    },\n\n    componentForType(match, replace) {\n      store.commit(`${ module }/componentForType`, { match, replace });\n    },\n\n    ignoreType(regexOrString) {\n      store.commit(`${ module }/ignoreType`, regexOrString);\n    },\n\n    ignoreGroup(regexOrString, cb) {\n      store.commit(`${ module }/ignoreGroup`, { regexOrString, cb });\n    },\n\n    weightGroup(input, weight, forBasic) {\n      if ( isArray(input) ) {\n        store.commit(`${ module }/weightGroup`, {\n          groups: input, weight, forBasic\n        });\n      } else {\n        store.commit(`${ module }/weightGroup`, {\n          group: input, weight, forBasic\n        });\n      }\n    },\n\n    setGroupDefaultType(input, defaultType) {\n      if ( isArray(input) ) {\n        store.commit(`${ module }/setGroupDefaultType`, { groups: input, defaultType });\n      } else {\n        store.commit(`${ module }/setGroupDefaultType`, { group: input, defaultType });\n      }\n    },\n\n    weightType(input, weight, forBasic) {\n      if ( isArray(input) ) {\n        store.commit(`${ module }/weightType`, {\n          types: input, weight, forBasic\n        });\n      } else {\n        store.commit(`${ module }/weightType`, {\n          type: input, weight, forBasic\n        });\n      }\n    },\n\n    mapGroup(match, replace, weight = 5, continueOnMatch = false) {\n      store.commit(`${ module }/mapGroup`, {\n        match, replace, weight, continueOnMatch\n      });\n    },\n\n    mapType(match, replace, weight = 5, continueOnMatch = false) {\n      store.commit(`${ module }/mapType`, {\n        match, replace, weight, continueOnMatch\n      });\n    },\n\n    moveType(match, group, weight = 5, continueOnMatch = false) {\n      store.commit(`${ module }/moveType`, {\n        match, group, weight,\n      });\n    },\n\n    virtualType(obj) {\n      store.commit(`${ module }/virtualType`, { product, obj });\n    },\n\n    spoofedType(obj) {\n      store.commit(`${ module }/spoofedType`, { product, obj });\n    }\n  };\n}\n\nlet called = false;\n\nexport async function applyProducts(store, $plugin) {\n  if (called) {\n    return;\n  }\n\n  called = true;\n  for ( const product of listProducts() ) {\n    const impl = await loadProduct(product);\n\n    if ( impl?.init ) {\n      impl.init(store);\n    }\n  }\n  // Load the products from all plugins\n  $plugin.loadProducts();\n}\n\nexport function productsLoaded() {\n  return called;\n}\n\nexport const state = function() {\n  return {\n    products:                [],\n    virtualTypes:            {},\n    spoofedTypes:            {},\n    basicTypes:              {},\n    groupIgnore:             [],\n    groupWeights:            {},\n    groupDefaultTypes:       {},\n    basicGroupWeights:       { [ROOT]: 1000 },\n    groupMappings:           [],\n    typeIgnore:              [],\n    basicTypeWeights:        {},\n    typeWeights:             {},\n    typeMappings:            [],\n    typeMoveMappings:        [],\n    typeToComponentMappings: [],\n    typeOptions:             [],\n    groupBy:                 {},\n    headers:                 {},\n    paginationHeaders:       {},\n    hideBulkActions:         {},\n    schemaGeneration:        1,\n    cache:                   {\n      typeMove:           {},\n      groupLabel:         {},\n      ignore:             {},\n      list:               {},\n      chart:              {},\n      detail:             {},\n      edit:               {},\n      componentFor:       {},\n      promptRemove:       {},\n      windowComponents:   {},\n      'machine-config':   {},\n      'cloud-credential': {}\n\n    },\n  };\n};\n\nexport const getters = {\n  // ----------------------------------------------------------------------------\n  // 1 ) Getting info\n  // ----------------------------------------------------------------------------\n  // Turns a type name into a display label (e.g. management.cattle.io.cluster -> Cluster)\n  labelFor(state, getters, rootState, rootGetters) {\n    return (schema, count = 1, language = null) => {\n      return _applyMapping(schema, state.typeMappings, 'id', false, () => {\n        // i18n-uses typeLabel.*\n        const key = `typeLabel.\"${ schema.id.toLowerCase() }\"`;\n\n        if ( rootGetters['i18n/exists'](key, language) ) {\n          return rootGetters['i18n/t'](key, { count }, language).trim();\n        }\n\n        const out = schema?.attributes?.kind || schema.id || '?';\n\n        // Add spaces, but breaks typing names into jump menu naturally\n        // out = ucFirst(out.replace(/([a-z])([A-Z])/g,'$1 $2'));\n\n        if ( count === 1 ) {\n          return out;\n        }\n\n        // This works for most things... if you don't like it, put in a typeLabel translation for above.\n        return pluralize(out);\n      });\n    };\n  },\n\n  // Turns a group name into a display label (e.g. management.cattle.io.v3.cluster -> Cluster)\n  groupLabelFor(state) {\n    return (schemaOrName) => {\n      let group = schemaOrName;\n\n      if ( typeof schemaOrName === 'object' ) {\n        let moved = false;\n\n        for ( const rule of state.typeMoveMappings ) {\n          const re = stringToRegex(rule.match);\n\n          if ( schemaOrName.id.match(re) ) {\n            moved = true;\n            group = rule.replace;\n          }\n        }\n\n        if ( !moved ) {\n          group = group.attributes.group;\n        }\n      }\n\n      if ( typeof group !== 'string' ) {\n        return null;\n      }\n\n      const out = _applyMapping(group, state.groupMappings, null, state.cache.groupLabel, (group) => {\n        const match = group.match(/^(.*)\\.k8s\\.io$/);\n\n        if ( match ) {\n          return match[1].split(/\\./).map((x) => ucFirst(x)).join('.');\n        }\n\n        return group;\n      });\n\n      return out;\n    };\n  },\n\n  groupForBasicType(state) {\n    return (product, schemaId) => {\n      return state.basicTypes?.[product]?.[schemaId];\n    };\n  },\n\n  optionsFor(state, getters, rootState, rootGetters) {\n    const def = {\n      isCreatable:            true,\n      isEditable:             true,\n      isRemovable:            true,\n      showState:              true,\n      showAge:                true,\n      canYaml:                true,\n      namespaced:             null,\n      listGroups:             [],\n      listGroupsWillOverride: false,\n      listMandatorySort:      null,\n      depaginate:             false,\n      customRoute:            undefined,\n      resourceEditMasthead:   true,\n    };\n\n    return (schemaOrType, pagination) => {\n      // Note - This can run a LOT so needs to be performant\n\n      if (!schemaOrType) {\n        return {};\n      }\n\n      const type = (typeof schemaOrType === 'object' ? schemaOrType.id : schemaOrType);\n      const found = state.typeOptions.find((entry) => {\n        const re = stringToRegex(entry.match);\n\n        return re.test(type);\n      });\n\n      const opts = Object.assign({}, def, found || {});\n\n      // As this runs a lot, avoid anything we don't strictly need (like going out to another store)\n      if (!pagination) {\n        return opts;\n      }\n\n      const storeOptionsFor = schemaOrType?.$ctx?.getters?.['optionsFor'];\n      const storeOpts = storeOptionsFor ? storeOptionsFor({ getters, state }, {\n        schema: schemaOrType, pagination, opts\n      }) : {};\n\n      return {\n        ...opts,\n        ...storeOpts,\n      };\n    };\n  },\n\n  isFavorite(state, getters, rootState, rootGetters) {\n    return (schemaId) => {\n      return rootGetters['prefs/get'](FAVORITE_TYPES).includes(schemaId) || false;\n    };\n  },\n\n  typeWeightFor(state) {\n    return (type, forBasic) => {\n      type = type?.toLowerCase();\n\n      if ( forBasic ) {\n        return state.basicTypeWeights[type] || 0;\n      } else {\n        return state.typeWeights[type] || 0;\n      }\n    };\n  },\n\n  groupWeightFor(state) {\n    return (group, forBasic) => {\n      group = group.toLowerCase();\n\n      if ( forBasic ) {\n        return state.basicGroupWeights[group] || 0;\n      } else {\n        return state.groupWeights[group] || 0;\n      }\n    };\n  },\n\n  groupDefaultTypeFor(state) {\n    return (group) => {\n      group = group.toLowerCase();\n\n      return state.groupDefaultTypes[group];\n    };\n  },\n\n  getTree(state, getters, rootState, rootGetters) {\n    // Name the function so it's easily identifiable when performance tracing\n    return function getTree(productId, mode, allTypes, clusterId, namespaceMode, currentType, search) {\n      // getTree has four modes:\n      // - `basic` matches data types that should always be shown (even if there are 0 of them).\n      // - `used` matches the data types where there are more than 0 of them in the current set of namespaces.\n      // - `all` matches all types.\n      // - `favorite` matches starred types.\n      // namespaceMode: 'namespaced', 'cluster', or 'both'\n      // namespaces: null means all, otherwise it will be an array of specific namespaces to include\n      const isBasic = mode === TYPE_MODES.BASIC;\n\n      let searchRegex;\n\n      if ( search ) {\n        searchRegex = new RegExp(`^(.*)(${ escapeRegex(search) })(.*)$`, 'i');\n      }\n\n      const root = { children: [] };\n\n      // Add types from shortest to longest so that parents\n      // get added before children\n      const keys = Object.keys(allTypes).sort((a, b) => a.length - b.length);\n\n      // Set these for later\n      const currentLocal = rootGetters['i18n/current']();\n      const defaultLocal = rootGetters['i18n/default']();\n\n      for ( const type of keys ) {\n        const typeObj = allTypes[type];\n\n        if ( typeObj.schema && getters.isIgnored(typeObj.schema) ) {\n          // Skip ignored groups & types\n          continue;\n        }\n\n        const namespaced = typeObj.namespaced;\n\n        if ( (namespaceMode === NAMESPACED && !namespaced ) || (namespaceMode === CLUSTER_LEVEL && namespaced) ) {\n          // Skip types that are not the right namespace mode\n          continue;\n        }\n\n        const inStore = rootGetters.currentStore(typeObj.name);\n        const count = rootGetters[`${ inStore }/count`](typeObj);\n        const groupForBasicType = getters.groupForBasicType(productId, typeObj.name);\n\n        if ( typeObj.id === currentType ) {\n          // If this is the type currently being shown, always show it\n        } else if ( isBasic && !groupForBasicType ) {\n          // If we want the basic tree only return basic types;\n          continue;\n        } else if ( mode === TYPE_MODES.USED && count <= 0 ) {\n          // If there's none of this type, ignore this entry when viewing only in-use types\n          // Note: count is sometimes null, in js `null <= 0` is `true`.\n          continue;\n        }\n\n        const label = typeObj.labelKey ? rootGetters['i18n/t'](typeObj.labelKey) || typeObj.label : typeObj.label;\n\n        const labelDisplay = highlightLabel(label, count, typeObj.schema);\n\n        if ( !labelDisplay ) {\n          // Search happens in highlight and returns null if not found\n          continue;\n        }\n\n        let group;\n\n        if ( isBasic ) {\n          group = _ensureGroup(root, groupForBasicType, true);\n        } else if ( mode === TYPE_MODES.FAVORITE ) {\n          group = _ensureGroup(root, 'starred');\n          group.weight = 1000;\n        } else if ( mode === TYPE_MODES.USED ) {\n          group = _ensureGroup(root, `inUse::${ getters.groupLabelFor(typeObj.schema) }`);\n        } else {\n          group = _ensureGroup(root, typeObj.schema || typeObj.group || ROOT);\n        }\n\n        let route = typeObj.route;\n\n        // Make the default route if one isn't set\n        if (!route ) {\n          route = {\n            name:   'c-cluster-product-resource',\n            params: {\n              product:  productId,\n              cluster:  clusterId,\n              resource: typeObj.name,\n            }\n          };\n\n          typeObj.route = route;\n        }\n\n        // Cluster ID and Product should always be set\n        if ( route && typeof route === 'object' ) {\n          route.params = route.params || {};\n          route.params.cluster = clusterId;\n          route.params.product = productId;\n        }\n\n        group.children.push({\n          label,\n          labelDisplay,\n          mode:         typeObj.mode,\n          exact:        typeObj.exact || false,\n          'exact-path': typeObj['exact-path'] || false,\n          namespaced,\n          route,\n          name:         typeObj.name,\n          weight:       typeObj.weight || getters.typeWeightFor(typeObj.schema?.id || label, isBasic),\n          overview:     !!typeObj.overview,\n        });\n      }\n\n      // Recursively sort the groups\n      _sortGroup(root, mode);\n\n      return root.children;\n\n      // ----------------------\n\n      function _ensureGroup(tree, schemaOrName, forBasic = false) {\n        let name = getters.groupLabelFor(schemaOrName);\n        const isRoot = ( name === ROOT || name.startsWith(`${ ROOT }::`) );\n\n        if ( name && name.includes('::') ) {\n          let parent;\n\n          [parent, name] = name.split('::', 2);\n          tree = _ensureGroup(tree, parent);\n        }\n\n        // Translate if an entry exists\n        let label = name;\n        // i18n-uses nav.group.*\n        const key = `nav.group.\"${ name }\"`;\n\n        if ( rootGetters['i18n/exists'](key) ) {\n          label = rootGetters['i18n/t'](key);\n        }\n\n        let group = findBy(tree.children, 'name', name);\n\n        if ( !group ) {\n          group = {\n            name,\n            label,\n            weight:      getters.groupWeightFor(name, forBasic),\n            defaultType: getters.groupDefaultTypeFor(name),\n          };\n\n          tree.children.push(group);\n        }\n\n        if ( isRoot ) {\n          group.isRoot = true;\n        }\n\n        if ( !group.children ) {\n          group.children = [];\n        }\n\n        return group;\n      }\n\n      function highlightLabel(original, count, schema) {\n        let label = escapeHtml(original);\n\n        if ( searchRegex ) {\n          let match = label.match(searchRegex);\n\n          if (!match) {\n            if ( currentLocal !== defaultLocal && schema ) {\n              const defaultLabel = getters.labelFor(schema, count, defaultLocal);\n\n              if (defaultLabel && defaultLabel !== label ) {\n                label += ` (${ defaultLabel })`;\n                match = label.match(searchRegex);\n              }\n            }\n          }\n\n          if ( match ) {\n            label = `${ escapeHtml(match[1]) }<span class=\"highlight\">${ escapeHtml(match[2]) }</span>${ escapeHtml(match[3]) }`;\n          } else {\n            return null;\n          }\n        }\n\n        return label;\n      }\n    };\n  },\n\n  isSpoofed(state, getters, rootState, rootGetters) {\n    return (type, product) => {\n      product = product || rootGetters['productId'];\n      const productSpoofedTypes = state.spoofedTypes[product] || [];\n\n      return productSpoofedTypes.some((st) => st.type === type);\n    };\n  },\n\n  isVirtual(state, getters, rootState, rootGetters) {\n    return (name, product) => {\n      product = product || rootGetters['productId'];\n      const productVirtualTypes = state.virtualTypes[product] || [];\n\n      return productVirtualTypes.some((st) => st.name === name);\n    };\n  },\n\n  getSpoofedInstances(state, getters, rootState, rootGetters) {\n    return async(type, product) => {\n      product = product || rootGetters['productId'];\n      const getInstances = instanceMethods[product]?.[type] || (() => []);\n      const instances = await getInstances();\n\n      instances.forEach((instance) => {\n        const type = instance.type;\n        const id = instance.id;\n        const link = `/${ SPOOFED_PREFIX }/${ type }/${ id }`;\n        const apiLink = `/${ SPOOFED_API_PREFIX }/${ type }/${ id }`;\n\n        instance.links = {\n          remove: instance.links?.remove || link,\n          self:   instance.links?.self || link,\n          update: instance.links?.update || link,\n          view:   instance.links?.view || apiLink,\n        };\n        instance.isSpoofed = true;\n      });\n\n      return instances;\n    };\n  },\n\n  getSpoofedInstance(state, getters, rootState, rootGetters) {\n    return async(type, product, id) => {\n      const productInstances = await getters.getSpoofedInstances(type, product);\n\n      return productInstances.find( (instance) => instance.id === id);\n    };\n  },\n\n  allSpoofedTypes(state, getters, rootState, rootGetters) {\n    return Object.values(state.spoofedTypes).flat();\n  },\n\n  spoofedSchemas(state, getters, rootState, rootGetters) {\n    return (product) => {\n      const types = state.spoofedTypes[product] || [];\n\n      return types.flatMap((type) => {\n        const schemas = type.schemas || [];\n\n        return schemas.map((schema) => ({\n          ...schema,\n          isSpoofed: true\n        }));\n      });\n    };\n  },\n\n  allSpoofedSchemas(state, getters, rootState, rootGetters) {\n    return getters.allSpoofedTypes.flatMap((type) => {\n      const schemas = type.schemas || [];\n\n      return schemas.map((schema) => ({\n        ...schema,\n        isSpoofed: true\n      }));\n    });\n  },\n\n  /**\n   * Given many things, create a list of menu items per schema given the mode\n   */\n  allTypes(state, getters, rootState, rootGetters) {\n    // Name the function so it's easily identifiable when performance tracing\n    return function allTypes(product, modes = [TYPE_MODES.ALL]) {\n      const module = state.products.find((p) => p.name === product)?.inStore;\n      const schemas = rootGetters[`${ module }/all`](SCHEMA);\n      const isLocal = !rootGetters.currentCluster?.isLocal;\n      const isRancher = rootGetters.isRancher;\n      const counts = rootGetters[`${ module }/all`](COUNT)?.[0]?.counts || {};\n\n      const out = {};\n\n      // For performance reasons this must be super quick to iterate over.\n      // For each schema...\n      // 1) Determine if it's applicable given the mode\n      // 2) For each applicable mode create a `Type` entry\n      for ( const schema of schemas ) {\n        let schemaModes = { };\n\n        modes.forEach((m) => {\n          schemaModes[m] = true;\n        });\n\n        const attrs = schema.attributes || {};\n        const typeOptions = getters['optionsFor'](schema);\n\n        schemaModes[TYPE_MODES.BASIC] = schemaModes[TYPE_MODES.BASIC] && getters.groupForBasicType(product, schema.id);\n\n        if (Object.values(schemaModes).every((s) => !s)) {\n          continue;\n        }\n\n        schemaModes[TYPE_MODES.FAVORITE] = schemaModes[TYPE_MODES.FAVORITE] && getters.isFavorite(schema.id);\n\n        if (Object.values(schemaModes).every((s) => !s)) {\n          continue;\n        }\n\n        const onlyBasic = schemaModes[TYPE_MODES.BASIC] && modes.length === 1;\n\n        // This clause is only valid for non-basic modes. So if we have only basic... skip it\n        if (!onlyBasic) {\n          const invalidType = !attrs.kind ||\n          (typeof typeOptions.ifRancherCluster !== 'undefined' && typeOptions.ifRancherCluster !== isRancher) ||\n          (typeOptions.localOnly && isLocal);\n\n          if (invalidType) {\n            // Remove anything not basic\n            schemaModes = { [TYPE_MODES.BASIC]: schemaModes[TYPE_MODES.BASIC] };\n          }\n        }\n\n        // This is an expensive request to make, so only do it if we really need to\n        let label;\n\n        Object.entries(schemaModes).forEach(([mode, enabled]) => {\n          if (!enabled) {\n            return;\n          }\n\n          if (!out[mode]) {\n            out[mode] = {};\n          }\n\n          if (!label) {\n            label = getters.labelFor(schema, counts[schema.id]);\n          }\n\n          out[mode][schema.id] = {\n            label,\n            mode,\n            weight:     getters.typeWeightFor(schema?.id || label, mode === TYPE_MODES.BASIC),\n            schema,\n            name:       schema.id,\n            namespaced: typeOptions.namespaced === null ? attrs.namespaced : typeOptions.namespaced,\n            route:      typeOptions.customRoute\n          };\n        });\n      }\n\n      const nonUsedModes = modes.filter((m) => m !== TYPE_MODES.USED);\n      const isDev = rootGetters['prefs/get'](VIEW_IN_API);\n\n      // Add virtual and spoofed types\n      if ( nonUsedModes.length ) {\n        const virtualTypes = state.virtualTypes[product] || [];\n        const spoofedTypes = state.spoofedTypes[product] || [];\n        const allTypes = [...virtualTypes, ...spoofedTypes];\n\n        for ( const type of allTypes ) {\n          const item = clone(type);\n          const id = item.name;\n          const virtSpoofedModes = [...nonUsedModes];\n\n          // Is there a virtual/spoofed type override for schema type?\n          // Currently used by harvester, this should be investigated and removed if possible\n          virtSpoofedModes.forEach((mode) => {\n            if (out[mode]?.[id]) {\n              delete out[mode][id];\n            }\n          });\n\n          if ( item['public'] === false && !isDev ) {\n            continue;\n          }\n\n          if (item.ifHave && !ifHave(rootGetters, item.ifHave)) {\n            continue;\n          }\n\n          if ( item.ifHaveType ) {\n            const ifHaveTypeArray = Array.isArray(item.ifHaveType) ? item.ifHaveType : [item.ifHaveType];\n            let satisfiesIfHave = true;\n\n            // Support an array of required types that the user must have access to\n            for (let i = 0; i < ifHaveTypeArray.length; i++) {\n              const ifHaveType = ifHaveTypeArray[i];\n              const targetedSchemas = typeof ifHaveType === 'string' ? schemas : rootGetters[`${ ifHaveType.store }/all`](SCHEMA);\n              const type = typeof ifHaveType === 'string' ? ifHaveType : ifHaveType?.type;\n\n              const haveIds = filterBy(targetedSchemas, 'id', normalizeType(type)).map((s) => s.id);\n\n              if (!haveIds.length) {\n                satisfiesIfHave = false;\n                break;\n              }\n\n              if (item.ifHaveVerb && !ifHaveVerb(rootGetters, module, item.ifHaveVerb, haveIds)) {\n                satisfiesIfHave = false;\n                break;\n              }\n            }\n\n            if (!satisfiesIfHave) {\n              continue;\n            }\n          }\n\n          if ( item.ifHaveSubTypes ) {\n            const hasSome = (item.ifHaveSubTypes || []).some((type) => {\n              return !!findBy(schemas, 'id', normalizeType(type));\n            });\n\n            if (!hasSome) {\n              continue;\n            }\n          }\n\n          if ( typeof item.ifRancherCluster !== 'undefined' && item.ifRancherCluster !== rootGetters.isRancher ) {\n            continue;\n          }\n\n          if (item.ifFeature) {\n            if (item.ifFeature[0] === '!') {\n              const feature = item.ifFeature.replace('!', '');\n\n              if (rootGetters['features/get'](feature)) {\n                continue;\n              }\n            } else {\n              if (!rootGetters['features/get'](item.ifFeature)) {\n                continue;\n              }\n            }\n          }\n\n          if (virtSpoofedModes.includes(TYPE_MODES.BASIC) && !getters.groupForBasicType(product, id) ) {\n            virtSpoofedModes.splice(virtSpoofedModes.indexOf(TYPE_MODES.BASIC), 1);\n          }\n\n          if (virtSpoofedModes.includes(TYPE_MODES.FAVORITE) && !getters.isFavorite(id) ) { // mode === TYPE_MODES.FAVORITE &&\n            virtSpoofedModes.splice(virtSpoofedModes.indexOf(TYPE_MODES.FAVORITE), 1);\n          }\n\n          // Ensure labelKey is taken into account... with a mock count\n          // This is harmless if the translation doesn't require count\n          if (item.labelKey && rootGetters['i18n/exists'](item.labelKey)) {\n            item.label = rootGetters['i18n/t'](item.labelKey, { count: 2 }).trim();\n            delete item.labelKey; // Label should really take precedence over labelKey, but it doesn't, so remove it\n          } else {\n            item.label = item.label || item.name;\n          }\n\n          virtSpoofedModes.forEach((mode) => {\n            const isBasic = mode === TYPE_MODES.BASIC;\n            const weight = type.weight || getters.typeWeightFor(item.label, isBasic);\n\n            item.mode = mode;\n            item.weight = weight;\n            if (!out[mode]) {\n              out[mode] = {};\n            }\n            out[mode][id] = item;\n          });\n        }\n      }\n\n      return out;\n    };\n  },\n\n  groupByFor(state) {\n    return (schema) => {\n      return state.groupBy[schema?.id];\n    };\n  },\n\n  hideBulkActionsFor(state) {\n    return (schema) => {\n      return state.hideBulkActions[schema.id];\n    };\n  },\n\n  headersFor(state, getters, rootState, rootGetters) {\n    return (schema, pagination) => {\n      if (pagination) {\n        const storeHeadersFor = schema?.$ctx?.getters?.['headersFor'];\n\n        if (storeHeadersFor) {\n          const res = storeHeadersFor({ getters, state }, { schema, pagination });\n\n          if (res) {\n            return res;\n          }\n        }\n      }\n\n      return createHeaders({ rootGetters }, {\n        headers:     state.headers,\n        typeOptions: getters['optionsFor'](schema, false),\n        schema,\n        columns:     {\n          state:     STATE,\n          name:      NAME,\n          namespace: NAMESPACE_COL,\n          age:       AGE,\n        },\n        pagination\n      });\n    };\n  },\n\n  /**\n   * Simple getter to fetch pre-configured headers used in pagination\n   */\n  configuredPaginationHeaders(state) {\n    return (schemaOrType) => state.paginationHeaders?.[schemaOrType.id || schemaOrType];\n  },\n\n  /**\n   * Simple getter to fetch pre-configured headers (not used in paginated lists)\n   */\n  configuredHeaders(state) {\n    return (schemaOrType) => state.headers?.[schemaOrType.id || schemaOrType];\n  },\n\n  // ------------------------------------\n  // Custom list/detail/edit/header component detection\n  //\n  // Note: you can't refactor these into one function that does `@/${kind}/${type}`,\n  // because babel needs some hardcoded idea where to look for the dependency.\n  //\n  // Note 2: Yes these are editing state in a getter for caching... it's ok, probably.\n  // ------------------------------------\n  hasCustomList(state, getters, rootState) {\n    return (rawType) => {\n      const key = getters.componentFor(rawType);\n\n      return hasCustom(state, rootState, 'list', key, (key) => resolveList(key));\n    };\n  },\n\n  hasCustomChart(state, getters, rootState) {\n    return (rawType) => {\n      const key = getters.componentFor(rawType);\n\n      return hasCustom(state, rootState, 'chart', key, (key) => resolveChart(key));\n    };\n  },\n\n  hasCustomDetail(state, getters, rootState) {\n    return (rawType, subType) => {\n      const key = getters.componentFor(rawType, subType);\n\n      return hasCustom(state, rootState, 'detail', key, (key) => resolveDetail(key));\n    };\n  },\n\n  hasGraph(state, getters) {\n    return (resource) => {\n      const typeOptions = getters['optionsFor'](resource);\n\n      if (typeOptions && typeOptions.hasGraph) {\n        return graphConfigMap[resource];\n      }\n\n      return null;\n    };\n  },\n\n  hasCustomEdit(state, getters, rootState) {\n    return (rawType, subType) => {\n      const key = getters.componentFor(rawType, subType);\n\n      return hasCustom(state, rootState, 'edit', key, (key) => resolveEdit(key));\n    };\n  },\n\n  hasComponent(state, getters, rootState) {\n    return (path) => {\n      return hasCustom(state, rootState, 'edit', path, (path) => resolveEdit(path));\n    };\n  },\n\n  hasCustomPromptRemove(state, getters, rootState) {\n    return (rawType, subType) => {\n      const key = getters.componentFor(rawType, subType);\n\n      return hasCustom(state, rootState, 'promptRemove', key, () => require.resolve(`@shell/promptRemove/${ key }`));\n    };\n  },\n\n  hasCustomWindowComponent(state, getters, rootState) {\n    return (rawType, subType) => {\n      const key = getters.componentFor(rawType, subType);\n\n      return hasCustom(state, rootState, 'windowComponents', key, (key) => resolveWindowComponent(key));\n    };\n  },\n\n  hasCustomMachineConfigComponent(state, getters, rootState) {\n    return (rawType, subType) => {\n      const key = getters.componentFor(rawType, subType);\n\n      return hasCustom(state, rootState, 'machine-config', key, (key) => resolveMachineConfigComponent(key));\n    };\n  },\n\n  hasCustomCloudCredentialComponent(state, getters, rootState) {\n    return (rawType, subType) => {\n      const key = getters.componentFor(rawType, subType);\n\n      return hasCustom(state, rootState, 'cloud-credential', key, (key) => resolveCloudCredentialComponent(key));\n    };\n  },\n\n  importComponent(state, getters) {\n    return (path) => {\n      return importEdit(path);\n    };\n  },\n\n  importDialog(state, getters, rootState) {\n    return (rawType, subType) => {\n      return loadExtension(rootState, 'dialog', getters.componentFor(rawType, subType), importDialog);\n    };\n  },\n\n  importList(state, getters, rootState) {\n    return (rawType) => {\n      return loadExtension(rootState, 'list', getters.componentFor(rawType), importList);\n    };\n  },\n\n  importChart(state, getters, rootState) {\n    return (rawType) => {\n      return loadExtension(rootState, 'chart', getters.componentFor(rawType), importChart);\n    };\n  },\n\n  importDetail(state, getters, rootState) {\n    return (rawType, subType) => {\n      return loadExtension(rootState, 'detail', getters.componentFor(rawType, subType), importDetail);\n    };\n  },\n\n  importEdit(state, getters, rootState) {\n    return (rawType, subType) => {\n      return loadExtension(rootState, 'edit', getters.componentFor(rawType, subType), importEdit);\n    };\n  },\n\n  importCustomPromptRemove(state, getters, rootState) {\n    return (rawType, subType) => {\n      return loadExtension(rootState, 'promptRemove', getters.componentFor(rawType, subType), importCustomPromptRemove);\n    };\n  },\n\n  importWindowComponent(state, getters, rootState) {\n    return (rawType, subType) => {\n      return loadExtension(rootState, 'windowComponents', getters.componentFor(rawType, subType), importWindowComponent);\n    };\n  },\n\n  importLogin(state, getters, rootState) {\n    return (authType) => {\n      return loadExtension(rootState, 'login', authType, importLogin);\n    };\n  },\n\n  importMachineConfig(state, getters, rootState) {\n    return (rawType, subType) => {\n      return loadExtension(rootState, 'machine-config', getters.componentFor(rawType, subType), importMachineConfig);\n    };\n  },\n\n  importCloudCredential(state, getters, rootState) {\n    return (rawType, subType) => {\n      return loadExtension(rootState, 'cloud-credential', getters.componentFor(rawType, subType), importCloudCredential);\n    };\n  },\n\n  componentFor(state, getters) {\n    return (type, subType) => {\n      let key = type;\n\n      if ( subType ) {\n        key = `${ type }/${ subType }`;\n      }\n\n      if ( state.cache.componentFor[key] !== undefined ) {\n        return state.cache.componentFor[key];\n      }\n\n      let out = type;\n\n      const mapping = state.typeToComponentMappings.find((mapping) => {\n        const re = stringToRegex(mapping.match);\n\n        return re.test(key);\n      });\n\n      if ( mapping ) {\n        out = mapping.replace;\n      } else if ( subType ) {\n        // Try again without the subType\n        out = getters.componentFor(type);\n      }\n\n      state.cache.componentFor[key] = out;\n\n      return out;\n    };\n  },\n\n  isIgnored(state, getters, rootState, rootGetters) {\n    return (schema) => {\n      let out = false;\n\n      for ( const rule of state.groupIgnore ) {\n        const group = schema?.attributes?.group;\n\n        if (group && group.match(stringToRegex(rule.type) && isObject(rule) && rule.type)) {\n          out = rule.cb(rootGetters);\n          break;\n        }\n\n        if ( group && typeof rule === 'string' && group.match(stringToRegex(rule)) ) {\n          out = true;\n          break;\n        }\n      }\n\n      if ( !out ) {\n        for ( const rule of state.typeIgnore ) {\n          if ( schema.id.match(stringToRegex(rule)) ) {\n            out = true;\n            break;\n          }\n        }\n      }\n\n      state.cache.ignore[schema.id] = out;\n\n      return out;\n    };\n  },\n\n  activeProducts(state, getters, rootState, rootGetters) {\n    const knownTypes = {};\n    const knownGroups = {};\n    const isDev = rootGetters['prefs/get'](VIEW_IN_API);\n\n    if ( state.schemaGeneration < 0 ) {\n      // This does nothing, but makes activeProducts depend on schemaGeneration\n      // so that it can be used to update the product list on schema change.\n      return;\n    }\n\n    return state.products.filter((p) => {\n      const module = p.inStore;\n\n      if ( p['public'] === false && !isDev ) {\n        return false;\n      }\n\n      if ( p.ifGetter && !rootGetters[p.ifGetter] ) {\n        return false;\n      }\n\n      if ( !knownTypes[module] ) {\n        const schemas = rootGetters[`${ module }/all`](SCHEMA);\n\n        knownTypes[module] = [];\n        knownGroups[module] = [];\n\n        for ( const s of schemas ) {\n          knownTypes[module].push(s._id);\n\n          if ( s._group ) {\n            addObject(knownGroups[module], s._group);\n          }\n        }\n      }\n\n      if ( p.ifFeature) {\n        const features = Array.isArray(p.ifFeature) ? p.ifFeature : [p.ifFeature];\n\n        for (const f of features) {\n          if (!rootGetters['features/get'](f)) {\n            return false;\n          }\n        }\n      }\n\n      if ( p.ifHave && !ifHave(rootGetters, p.ifHave)) {\n        return false;\n      }\n\n      if ( p.ifHaveType ) {\n        const haveIds = knownTypes[module].filter((t) => t.match(stringToRegex(p.ifHaveType)) );\n\n        if ( !haveIds.length ) {\n          return false;\n        }\n\n        if ( p.ifHaveVerb && !ifHaveVerb(rootGetters, module, p.ifHaveVerb, haveIds)) {\n          return false;\n        }\n      }\n\n      if ( p.ifHaveGroup && !knownGroups[module].find((t) => t.match(stringToRegex(p.ifHaveGroup)) ) ) {\n        return false;\n      }\n\n      return true;\n    });\n  },\n\n  isProductActive(state, getters) {\n    return (name) => {\n      if ( findBy(getters['activeProducts'], 'name', name) ) {\n        return true;\n      }\n\n      return false;\n    };\n  },\n\n  rowValueGetter(state) {\n    return (schema, colName) => {\n      const col = _findColumnByName(schema, colName);\n\n      return rowValueGetter(col);\n    };\n  },\n\n  isProductRegistered(state) {\n    return (productName) => {\n      const prod = state.products.find((p) => p.name === productName);\n\n      return !!prod;\n    };\n  },\n\n  productByName(state) {\n    return (productName) => state.products.find((p) => p.name === productName);\n  }\n};\n\nexport const mutations = {\n  schemaChanged(state) {\n    state.schemaGeneration = state.schemaGeneration + 1;\n  },\n\n  // Remove the specified product\n  remove(state, { product, plugin }) {\n    const existing = state.products.findIndex((p) => p.name === product);\n\n    // Remove the product\n    if (existing !== -1) {\n      state.products.splice(existing, 1);\n    }\n\n    // Go through the basic types and remove the headers\n    if (state.virtualTypes[product]) {\n      delete state.virtualTypes[product];\n    }\n\n    if (state.basicTypes[product]) {\n      // Remove table header configuration\n      Object.keys(state.basicTypes[product]).forEach((type) => {\n        delete state.headers[type];\n        delete state.basicTypeWeights[type];\n        delete state.cache.ignore[type];\n        // These track whether the type has a custom component\n        delete state.cache.detail[type];\n        delete state.cache.edit[type];\n        delete state.cache.list[type];\n\n        // Delete all of the entries from the componentFor cache where the valye is the type\n        // Can do this more efficiently\n        Object.keys(state.cache.componentFor).forEach((k) => {\n          const v = state.cache.componentFor[k];\n\n          if (v === type) {\n            delete state.cache.componentFor[k];\n          }\n        });\n      });\n\n      delete state.basicTypes[product];\n    }\n\n    if (plugin) {\n      // kind is list, edit, detail etc\n      Object.keys(plugin.types).forEach((kind) => {\n        if (state.cache[kind]) {\n          Object.keys(plugin.types[kind]).forEach((type) => {\n            delete state.cache[kind][type];\n          });\n        }\n      });\n    }\n  },\n\n  product(state, obj) {\n    let existing = state.products.find((p) => p.name === obj.name);\n\n    if ( existing ) {\n      Object.assign(existing, obj);\n    } else {\n      addObject(state.products, obj);\n      existing = state.products.find((p) => p.name === obj.name);\n    }\n\n    // Make sure deprecated `inExplorer` is synchronized with `rootProduct` (and vice-versa)\n    if (existing?.inExplorer) {\n      existing.rootProduct = EXPLORER;\n    } else if (existing?.rootProduct === EXPLORER) {\n      existing.inExplorer = true;\n    }\n\n    // We make an assumption that if the store for a product is 'cluster' it will be displayed within cluster explorer\n    // Detect that here and set rootProduct and inExporer in this case\n    if (!existing?.rootProduct && existing?.inStore === 'cluster') {\n      existing.rootProduct = EXPLORER;\n      existing.inExplorer = (existing.rootProduct === EXPLORER);\n    }\n  },\n\n  virtualType(state, { product, obj }) {\n    if ( !state.virtualTypes[product] ) {\n      state.virtualTypes[product] = [];\n    }\n\n    const copy = clone(obj);\n\n    copy.virtual = true;\n\n    const existing = findBy(state.virtualTypes[product], 'name', copy.name);\n\n    if ( existing ) {\n      Object.assign(existing, copy);\n    } else {\n      addObject(state.virtualTypes[product], copy);\n    }\n  },\n\n  spoofedType(state, { product, obj }) {\n    if ( !state.spoofedTypes[product] ) {\n      state.spoofedTypes[product] = [];\n    }\n\n    const copy = clone(obj);\n\n    instanceMethods[product] = instanceMethods[product] || {};\n    instanceMethods[product][copy.type] = copy.getInstances;\n    delete copy.getInstances;\n\n    copy.name = copy.type;\n    copy.isSpoofed = true;\n    copy.virtual = true;\n    copy.schemas.forEach((schema) => {\n      schema.links = {\n        collection: `/${ SPOOFED_PREFIX }/${ schema.id }`,\n        ...(schema.links || {})\n      };\n    });\n\n    const existing = findBy(state.spoofedTypes[product], 'type', copy.type);\n\n    if ( existing ) {\n      Object.assign(existing, copy);\n    } else {\n      addObject(state.spoofedTypes[product], copy);\n    }\n  },\n\n  basicType(state, { product, group, types }) {\n    if ( !product ) {\n      product = EXPLORER;\n    }\n\n    if ( !group ) {\n      group = ROOT;\n    }\n\n    if ( !isArray(types) ) {\n      types = [types];\n    }\n\n    if ( !state.basicTypes[product] ) {\n      state.basicTypes[product] = {};\n    }\n\n    for ( const t of types ) {\n      state.basicTypes[product][t] = group;\n    }\n  },\n\n  ignoreGroup(state, { regexOrString: match, cb }) {\n    match = ensureRegex(match);\n    // State shouldn't contain actual RegExp objects, because they don't serialize\n    cb ? state.groupIgnore.push({\n      type: regexToString(match),\n      cb\n    }) : state.groupIgnore.push(regexToString(match));\n  },\n\n  ignoreType(state, match) {\n    match = ensureRegex(match);\n    state.typeIgnore.push(regexToString(match));\n  },\n\n  groupBy(state, { type, field }) {\n    state.groupBy[type] = field;\n  },\n\n  headers(state, { type, headers }) {\n    state.headers[type] = headers;\n  },\n\n  paginationHeaders(state, { type, paginationHeaders }) {\n    state.paginationHeaders[type] = paginationHeaders;\n  },\n\n  hideBulkActions(state, { type, field }) {\n    state.hideBulkActions[type] = field;\n  },\n\n  // weightGroup({group: 'core', weight: 99}); -- higher groups are shown first\n  // These operate on group names *after* mapping but *before* translation\n  weightGroup(state, {\n    group, groups, weight, forBasic\n  }) {\n    if ( !groups ) {\n      groups = [];\n    }\n\n    if ( group ) {\n      groups.push(group);\n    }\n\n    const map = forBasic ? state.basicGroupWeights : state.groupWeights;\n\n    for ( const g of groups ) {\n      map[g.toLowerCase()] = weight;\n    }\n  },\n\n  // setGroupDefaultType({group: 'core', defaultType: 'name'});\n  // By default when a group is clicked, the first item is selected - this allows\n  // this behaviour to be changed and a named child type can be chosen\n  // These operate on group names *after* mapping but *before* translation\n  setGroupDefaultType(state, { group, groups, defaultType }) {\n    if ( !groups ) {\n      groups = [];\n    }\n\n    if ( group ) {\n      groups.push(group);\n    }\n\n    for ( const g of groups ) {\n      state.groupDefaultTypes[g.toLowerCase()] = defaultType;\n    }\n  },\n\n  // weightType('Cluster' 99); -- higher groups are shown first\n  // These operate on *schema* type names, before mapping\n  weightType(state, {\n    type, types, weight, forBasic\n  }) {\n    if ( !types ) {\n      types = [];\n    }\n\n    if ( type ) {\n      types.push(type);\n    }\n\n    const map = forBasic ? state.basicTypeWeights : state.typeWeights;\n\n    for ( const t of types ) {\n      map[t.toLowerCase()] = weight;\n    }\n  },\n\n  // mapGroup('ugly.thing', 'Nice Thing', 1);\n  // mapGroup(/ugly.thing.(stuff)', '$1', 2);\n  // mapGroup(/ugly.thing.(stuff)', function(groupStr, ruleObj, regexMatch, typeObj) { return ucFirst(group.id) } , 2);\n  mapGroup(state, {\n    match, replace, weight = 5, continueOnMatch = false\n  }) {\n    _addMapping(state.groupMappings, match, replace, weight, continueOnMatch);\n  },\n\n  mapType(state, {\n    match, replace, weight = 5, continueOnMatch = false\n  }) {\n    _addMapping(state.typeMappings, match, replace, weight, continueOnMatch);\n  },\n\n  // moveType('apps.deployment', 'Core');\n  moveType(state, { match, group, weight = 5 }) {\n    _addMapping(state.typeMoveMappings, match, group, weight);\n  },\n\n  componentForType(state, { match, replace }) {\n    match = ensureRegex(match);\n    match = regexToString(match);\n    state.typeToComponentMappings.push({ match, replace });\n  },\n\n  configureType(state, options) {\n    const match = regexToString(ensureRegex(options.match));\n\n    const idx = state.typeOptions.findIndex((obj) => obj.match === match);\n    let obj = { ...options, match };\n\n    if ( idx >= 0 ) {\n      obj = Object.assign(state.typeOptions[idx], obj);\n      state.typeOptions.splice(idx, 1, obj);\n    } else {\n      const obj = Object.assign({}, options, { match });\n\n      state.typeOptions.push(obj);\n    }\n  },\n\n};\n\nexport const actions = {\n  removeProduct({ commit }, metadata) {\n    commit('remove', metadata);\n  },\n\n  addFavorite({ dispatch, rootGetters }, type) {\n    const types = rootGetters['prefs/get'](FAVORITE_TYPES) || [];\n\n    addObject(types, type);\n\n    dispatch('prefs/set', { key: FAVORITE_TYPES, value: types }, { root: true });\n  },\n\n  removeFavorite({ dispatch, rootGetters }, type) {\n    const types = rootGetters['prefs/get'](FAVORITE_TYPES) || [];\n\n    removeObject(types, type);\n\n    dispatch('prefs/set', { key: FAVORITE_TYPES, value: types }, { root: true });\n  },\n\n  toggleGroup({ dispatch, rootGetters }, { group, expanded }) {\n    const groups = rootGetters['prefs/get'](EXPANDED_GROUPS);\n\n    if ( expanded ) {\n      addObject(groups, group);\n    } else {\n      removeObject(groups, group);\n    }\n\n    dispatch('prefs/set', { key: EXPANDED_GROUPS, value: groups }, { root: true });\n  },\n\n  configureType({ commit }, options) {\n    commit('configureType', options);\n  }\n};\n\nfunction _sortGroup(tree, mode) {\n  const by = ['weight:desc', 'namespaced', 'label'];\n\n  tree.children = sortBy(tree.children, by);\n\n  for (const entry of tree.children ) {\n    if ( entry.children ) {\n      _sortGroup(entry, mode);\n    }\n  }\n}\n\nfunction _applyMapping(objOrValue, mappings, keyField, cache, defaultFn) {\n  let key = objOrValue;\n  let found = false;\n\n  if ( keyField ) {\n    if ( typeof objOrValue !== 'object' ) {\n      return objOrValue;\n    }\n\n    key = get(objOrValue, keyField);\n\n    if ( typeof key !== 'string' ) {\n      return null;\n    }\n  }\n\n  if ( key && cache && cache[key] ) {\n    return cache[key];\n  }\n\n  let out = `${ key }`;\n\n  for ( const rule of mappings ) {\n    const re = stringToRegex(rule.match);\n    const captured = out.match(re);\n\n    if ( captured && rule.replace ) {\n      out = out.replace(re, rule.replace);\n\n      found = true;\n      if ( !rule.continueOnMatch ) {\n        break;\n      }\n    }\n  }\n\n  if ( !found && defaultFn ) {\n    out = defaultFn(out, objOrValue);\n  }\n\n  if ( cache ) {\n    cache[key] = out;\n  }\n\n  return out;\n}\n\nfunction _addMapping(mappings, match, replace, weight, continueOnMatch) {\n  match = regexToString(ensureRegex(match));\n\n  mappings.push({\n    match,\n    replace,\n    weight,\n    continueOnMatch,\n    insertIndex: mappings.length,\n  });\n\n  // Re-sort the list by weight (highest first) and insert time (oldest first)\n  mappings.sort((a, b) => {\n    const pri = b.weight - a.weight;\n\n    if ( pri ) {\n      return pri;\n    }\n\n    return a.insertIndex - b.insertIndex;\n  });\n}\n\n// Regexes can't be represented in state because they don't serialize to JSON..\nconst regexCache = {};\n\nfunction regexToString(regex) {\n  return regex.source;\n}\n\nfunction stringToRegex(str) {\n  let out = regexCache[str];\n\n  if ( !out ) {\n    out = new RegExp(str);\n    regexCache[str] = out;\n  }\n\n  return out;\n}\n\nfunction ifHave(getters, option) {\n  switch (option) {\n  case IF_HAVE.V2_MONITORING: {\n    return haveV2Monitoring(getters);\n  }\n  case IF_HAVE.PROJECT: {\n    return !!project(getters);\n  }\n  case IF_HAVE.NO_PROJECT: {\n    return !project(getters);\n  }\n  case IF_HAVE.NOT_V1_ISTIO: {\n    return !isV1Istio(getters);\n  }\n  case IF_HAVE.MULTI_CLUSTER: {\n    return getters.isMultiCluster;\n  }\n  case IF_HAVE.NEUVECTOR_NAMESPACE: {\n    return getters[`cluster/all`](NAMESPACE).find((n) => n.metadata.name === NEU_VECTOR_NAMESPACE);\n  }\n  case IF_HAVE.ADMIN: {\n    return isAdminUser(getters);\n  }\n  case IF_HAVE.MCM_DISABLED: {\n    return !getters['isRancherInHarvester'];\n  }\n  case IF_HAVE.NOT_STANDALONE_HARVESTER: {\n    return !getters['isStandaloneHarvester'];\n  }\n  default:\n    return false;\n  }\n}\n\n// Could list a larger set of resources that typically only an admin user would have\nexport function isAdminUser(getters) {\n  const canEditSettings = (getters['management/schemaFor'](MANAGEMENT.SETTING)?.resourceMethods || []).includes('PUT');\n  const canEditFeatureFlags = (getters['management/schemaFor'](MANAGEMENT.FEATURE)?.resourceMethods || []).includes('PUT');\n  const canInstallApps = (getters['management/schemaFor'](CATALOG.APP)?.resourceMethods || []).includes('PUT');\n  const canAddRepos = (getters['management/schemaFor'](CATALOG.CLUSTER_REPO)?.resourceMethods || []).includes('PUT');\n  const canPutHelmOperations = (getters['management/schemaFor'](CATALOG.OPERATION)?.resourceMethods || []).includes('PUT');\n\n  return canEditSettings && canEditFeatureFlags && canInstallApps && canAddRepos && canPutHelmOperations;\n}\n\nfunction _findColumnByName(schema, colName) {\n  const attributes = schema.attributes || {};\n  const columns = attributes.columns || [];\n\n  return findBy(columns, 'name', colName);\n}\n\n// Is V1 Istio installed?\nfunction isV1Istio(getters) {\n  const cluster = getters['currentCluster'];\n\n  return !!cluster?.status?.istioEnabled;\n}\n\nfunction ifHaveVerb(rootGetters, module, verb, haveIds) {\n  for ( const haveId of haveIds ) {\n    const schema = rootGetters[`${ module }/schemaFor`](haveId);\n    const want = verb.toLowerCase();\n    const collectionMethods = schema.collectionMethods || [];\n    const resourceMethods = schema.resourceMethods || [];\n    const have = [...collectionMethods, ...resourceMethods].map((x) => x.toLowerCase());\n\n    if ( !have.includes(want) && !have.includes(`blocked-${ want }`) ) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n// Look at the namespace filters to determine if a project is selected\nexport function project(getters) {\n  const clusterId = getters['currentCluster']?.id;\n\n  if ( !clusterId ) {\n    return null;\n  }\n\n  const filters = getters['namespaceFilters'];\n  const namespaces = [];\n  let projectName = null;\n\n  for (const filter of filters) {\n    const [type, id] = filter.split('://', 2);\n\n    if (type === 'project') {\n      if (projectName !== null) {\n        // More than one project selected\n        return null;\n      }\n      projectName = id;\n    } else if (type === 'ns') {\n      namespaces.push(id);\n    } else {\n      // Something other than project or namespace\n      return null;\n    }\n  }\n\n  // No project found?\n  if (!projectName) {\n    return null;\n  }\n\n  // We have one project and a set of namespaces\n  // Check that all of the namespaces belong to the project\n  const project = getters['management/byId'](MANAGEMENT.PROJECT, `${ clusterId }/${ projectName }`);\n\n  // No additional namespaces means just the project is selected\n  if (namespaces.length === 0) {\n    return project;\n  }\n\n  // Convert the project namespaces into a map so we can check existence easily\n  const prjNamespaceMap = project.namespaces.reduce((m, ns) => {\n    m[ns.metadata.name] = true;\n\n    return m;\n  }, {});\n\n  // All of the namespace filters must belong to the project\n  const found = namespaces.reduce((total, ns) => {\n    return prjNamespaceMap[ns] ? total + 1 : 0;\n  }, 0);\n\n  if (found !== namespaces.length) {\n    return null;\n  }\n\n  return project;\n}\n\nfunction hasCustom(state, rootState, kind, key, fallback) {\n  const cache = state.cache[kind];\n\n  if ( cache[key] !== undefined ) {\n    return cache[key];\n  }\n\n  // Check to see if the custom kind is provided by a plugin (ignore booleans)\n  const pluginComponent = rootState.$plugin.getDynamic(kind, key);\n\n  if (typeof pluginComponent !== 'boolean' && !!pluginComponent) {\n    cache[key] = true;\n\n    return cache[key];\n  }\n\n  // Fallback\n  try {\n    fallback(key);\n    cache[key] = true;\n  } catch (e) {\n    cache[key] = false;\n  }\n\n  return cache[key];\n}\n\nfunction loadExtension(rootState, kind, key, fallback) {\n  const ext = rootState.$plugin.getDynamic(kind, key);\n\n  if (ext) {\n    if (typeof ext === 'function') {\n      return ext;\n    }\n\n    return () => ext;\n  }\n\n  return fallback(key);\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASA,GAAG,EAAEC,IAAI,EAAEC,SAAS,IAAIC,aAAa,EAAEC,KAAK,QAAQ,6BAA6B;AAC1F,SACEC,OAAO,EACPC,KAAK,EACLC,MAAM,EACNC,UAAU,EACVN,SAAS,QACJ,qBAAqB;AAC5B,SAASO,WAAW,EAAEC,eAAe,EAAEC,cAAc,QAAQ,oBAAoB;AACjF,SACEC,SAAS,EAAEC,MAAM,EAAEC,OAAO,EAAEC,YAAY,EAAEC,QAAQ,QAC7C,oBAAoB;AAC3B,SAASC,KAAK,EAAEC,GAAG,QAAQ,qBAAqB;AAChD,SACEC,WAAW,EAAEC,UAAU,EAAEC,WAAW,EAAEC,OAAO,EAAEC,SAAS,QACnD,qBAAqB;AAC5B,SACEC,WAAW,EAAEC,UAAU,EAAEC,YAAY,EAAEC,UAAU,EAAEC,YAAY,EAAEC,WAAW,EAAEC,wBAAwB,EAAEC,WAAW,EAAEC,WAAW,EAAEC,sBAAsB,EAAEC,qBAAqB,EAAEC,WAAW,EAAEC,YAAY,EAAEC,aAAa,EAAEC,YAAY,EAAEC,mBA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","ignoreList":[]}]}