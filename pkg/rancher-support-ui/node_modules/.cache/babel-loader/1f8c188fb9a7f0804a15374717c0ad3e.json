{"remainingRequest":"/app/node_modules/thread-loader/dist/cjs.js!/app/node_modules/babel-loader/lib/index.js!/app/node_modules/@rancher/shell/utils/monitoring.js","dependencies":[{"path":"/app/node_modules/@rancher/shell/utils/monitoring.js","mtime":1764054237091},{"path":"/app/pkg/rancher-support-ui/babel.config.js","mtime":1764051174054},{"path":"/app/node_modules/cache-loader/dist/cjs.js","mtime":1764054259024},{"path":"/app/node_modules/thread-loader/dist/cjs.js","mtime":1764054259111},{"path":"/app/node_modules/babel-loader/lib/index.js","mtime":1764054258910}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8gSGVscGVycyBmb3IgZGV0ZXJtaW5pbmcgaWYgVjIgb3IgdjEgTW9uaXRvcmluZyBhcmUgaW5zdGFsbGVkCgppbXBvcnQgeyBTQ0hFTUEsIE1PTklUT1JJTkcsIEVORFBPSU5UUyB9IGZyb20gJ0BzaGVsbC9jb25maWcvdHlwZXMnOwppbXBvcnQgeyBub3JtYWxpemVUeXBlIH0gZnJvbSAnQHNoZWxsL3BsdWdpbnMvZGFzaGJvYXJkLXN0b3JlL25vcm1hbGl6ZSc7CmltcG9ydCB7IGZpbmRCeSB9IGZyb20gJ0BzaGVsbC91dGlscy9hcnJheSc7CmltcG9ydCB7IGlzRW1wdHkgfSBmcm9tICdAc2hlbGwvdXRpbHMvb2JqZWN0JzsKCi8vIENhbiBiZSB1c2VkIGluc2lkZSBhIGNvbXBvbmVudHMnIGNvbXB1dGVkIHByb3BlcnR5CmV4cG9ydCBmdW5jdGlvbiBtb25pdG9yaW5nU3RhdHVzKCkgewogIHJldHVybiB7CiAgICBtb25pdG9yaW5nU3RhdHVzKCkgewogICAgICBjb25zdCBzdGF0dXMgPSB7CiAgICAgICAgdjI6IGhhdmVWMk1vbml0b3JpbmcodGhpcy4kc3RvcmUuZ2V0dGVycykKICAgICAgfTsKICAgICAgc3RhdHVzLmluc3RhbGxlZCA9IHN0YXR1cy52MSB8fCBzdGF0dXMudjI7CiAgICAgIHJldHVybiBzdGF0dXM7CiAgICB9CiAgfTsKfQpleHBvcnQgZnVuY3Rpb24gaGF2ZVYyTW9uaXRvcmluZyhnZXR0ZXJzKSB7CiAgY29uc3QgaW5TdG9yZSA9IGdldHRlcnNbJ2dldFN0b3JlTmFtZUJ5UHJvZHVjdElkJ107CgogIC8vIEp1c3QgY2hlY2sgZm9yIHRoZSBwb2QgbW9uaXRvcnMgQ1JECiAgY29uc3Qgc2NoZW1hcyA9IGdldHRlcnNbYCR7aW5TdG9yZX0vYWxsYF0oU0NIRU1BKTsKICBjb25zdCBleGlzdHMgPSBmaW5kQnkoc2NoZW1hcywgJ2lkJywgbm9ybWFsaXplVHlwZShNT05JVE9SSU5HLlBPRE1PTklUT1IpKTsKICByZXR1cm4gISFleGlzdHM7Cn0KZXhwb3J0IGNvbnN0IENBVFRMRV9NT05JVE9SSU5HX05BTUVTUEFDRSA9ICdjYXR0bGUtbW9uaXRvcmluZy1zeXN0ZW0nOwphc3luYyBmdW5jdGlvbiBoYXNFbmRwb2ludFN1YnNldHMoc3RvcmUsIGlkKSB7CiAgaWYgKHN0b3JlLmdldHRlcnNbJ2NsdXN0ZXIvc2NoZW1hRm9yJ10oRU5EUE9JTlRTKSkgewogICAgY29uc3QgZW5kcG9pbnRzID0gKGF3YWl0IHN0b3JlLmRpc3BhdGNoKCdjbHVzdGVyL2ZpbmRBbGwnLCB7CiAgICAgIHR5cGU6IEVORFBPSU5UUwogICAgfSkpIHx8IFtdOwogICAgY29uc3QgZW5kcG9pbnQgPSBlbmRwb2ludHMuZmluZChlcCA9PiBlcC5pZCA9PT0gaWQpOwogICAgcmV0dXJuIGVuZHBvaW50ICYmICFpc0VtcHR5KGVuZHBvaW50KSAmJiAhaXNFbXB0eShlbmRwb2ludC5zdWJzZXRzKTsKICB9CiAgcmV0dXJuIGZhbHNlOwp9CmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjYW5WaWV3R3JhZmFuYUxpbmsoc3RvcmUpIHsKICByZXR1cm4gYXdhaXQgaGFzRW5kcG9pbnRTdWJzZXRzKHN0b3JlLCBgJHtDQVRUTEVfTU9OSVRPUklOR19OQU1FU1BBQ0V9L3JhbmNoZXItbW9uaXRvcmluZy1ncmFmYW5hYCk7Cn0KZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNhblZpZXdBbGVydE1hbmFnZXJMaW5rKHN0b3JlKSB7CiAgcmV0dXJuIGF3YWl0IGhhc0VuZHBvaW50U3Vic2V0cyhzdG9yZSwgYCR7Q0FUVExFX01PTklUT1JJTkdfTkFNRVNQQUNFfS9yYW5jaGVyLW1vbml0b3JpbmctYWxlcnRtYW5hZ2VyYCk7Cn0KZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNhblZpZXdQcm9tZXRoZXVzTGluayhzdG9yZSkgewogIHJldHVybiBhd2FpdCBoYXNFbmRwb2ludFN1YnNldHMoc3RvcmUsIGAke0NBVFRMRV9NT05JVE9SSU5HX05BTUVTUEFDRX0vcmFuY2hlci1tb25pdG9yaW5nLXByb21ldGhldXNgKTsKfQoKLy8gT3RoZXIgd2F5cyB3ZSBjaGVjayBmb3IgbW9uaXRvcmluZzoKCi8vICgxKSBVc2luZyBjb3VudHMgKHJlcXVpcmVzIFJCQUMgcGVybWlzc2lvbnMpCi8vIHJldHVybiAhIXRoaXMuY2x1c3RlckNvdW50cz8uWzBdPy5jb3VudHM/LltDQVRBTE9HLkFQUF0/Lm5hbWVzcGFjZXM/LlsnY2F0dGxlLW1vbml0b3Jpbmctc3lzdGVtJ107CgovLyAoMikgUmV0cmlldmluZyBhbGwgd29ya2xvYWRzIGFuZCBsb29raW5nIGZvciBjb250YWluZXJzIHdpdGggYSBnaXZlbiBpbWFnZQovLyBTZWUgY2hhcnQvbW9uaXRvcmluZy9pbmRleC52dWU="},{"version":3,"names":["SCHEMA","MONITORING","ENDPOINTS","normalizeType","findBy","isEmpty","monitoringStatus","status","v2","haveV2Monitoring","$store","getters","installed","v1","inStore","schemas","exists","PODMONITOR","CATTLE_MONITORING_NAMESPACE","hasEndpointSubsets","store","id","endpoints","dispatch","type","endpoint","find","ep","subsets","canViewGrafanaLink","canViewAlertManagerLink","canViewPrometheusLink"],"sources":["/app/node_modules/@rancher/shell/utils/monitoring.js"],"sourcesContent":["// Helpers for determining if V2 or v1 Monitoring are installed\n\nimport { SCHEMA, MONITORING, ENDPOINTS } from '@shell/config/types';\nimport { normalizeType } from '@shell/plugins/dashboard-store/normalize';\nimport { findBy } from '@shell/utils/array';\nimport { isEmpty } from '@shell/utils/object';\n\n// Can be used inside a components' computed property\nexport function monitoringStatus() {\n  return {\n    monitoringStatus() {\n      const status = { v2: haveV2Monitoring(this.$store.getters) };\n\n      status.installed = status.v1 || status.v2;\n\n      return status;\n    }\n  };\n}\n\nexport function haveV2Monitoring(getters) {\n  const inStore = getters['getStoreNameByProductId'];\n\n  // Just check for the pod monitors CRD\n  const schemas = getters[`${ inStore }/all`](SCHEMA);\n  const exists = findBy(schemas, 'id', normalizeType(MONITORING.PODMONITOR));\n\n  return !!exists;\n}\n\nexport const CATTLE_MONITORING_NAMESPACE = 'cattle-monitoring-system';\n\nasync function hasEndpointSubsets(store, id) {\n  if (store.getters['cluster/schemaFor'](ENDPOINTS)) {\n    const endpoints = await store.dispatch('cluster/findAll', { type: ENDPOINTS }) || [];\n\n    const endpoint = endpoints.find((ep) => ep.id === id);\n\n    return endpoint && !isEmpty(endpoint) && !isEmpty(endpoint.subsets);\n  }\n\n  return false;\n}\n\nexport async function canViewGrafanaLink(store) {\n  return await hasEndpointSubsets(store, `${ CATTLE_MONITORING_NAMESPACE }/rancher-monitoring-grafana`);\n}\n\nexport async function canViewAlertManagerLink(store) {\n  return await hasEndpointSubsets(store, `${ CATTLE_MONITORING_NAMESPACE }/rancher-monitoring-alertmanager`);\n}\n\nexport async function canViewPrometheusLink(store) {\n  return await hasEndpointSubsets(store, `${ CATTLE_MONITORING_NAMESPACE }/rancher-monitoring-prometheus`);\n}\n\n// Other ways we check for monitoring:\n\n// (1) Using counts (requires RBAC permissions)\n// return !!this.clusterCounts?.[0]?.counts?.[CATALOG.APP]?.namespaces?.['cattle-monitoring-system'];\n\n// (2) Retrieving all workloads and looking for containers with a given image\n// See chart/monitoring/index.vue\n"],"mappings":"AAAA;;AAEA,SAASA,MAAM,EAAEC,UAAU,EAAEC,SAAS,QAAQ,qBAAqB;AACnE,SAASC,aAAa,QAAQ,0CAA0C;AACxE,SAASC,MAAM,QAAQ,oBAAoB;AAC3C,SAASC,OAAO,QAAQ,qBAAqB;;AAE7C;AACA,OAAO,SAASC,gBAAgBA,CAAA,EAAG;EACjC,OAAO;IACLA,gBAAgBA,CAAA,EAAG;MACjB,MAAMC,MAAM,GAAG;QAAEC,EAAE,EAAEC,gBAAgB,CAAC,IAAI,CAACC,MAAM,CAACC,OAAO;MAAE,CAAC;MAE5DJ,MAAM,CAACK,SAAS,GAAGL,MAAM,CAACM,EAAE,IAAIN,MAAM,CAACC,EAAE;MAEzC,OAAOD,MAAM;IACf;EACF,CAAC;AACH;AAEA,OAAO,SAASE,gBAAgBA,CAACE,OAAO,EAAE;EACxC,MAAMG,OAAO,GAAGH,OAAO,CAAC,yBAAyB,CAAC;;EAElD;EACA,MAAMI,OAAO,GAAGJ,OAAO,CAAC,GAAIG,OAAO,MAAO,CAAC,CAACd,MAAM,CAAC;EACnD,MAAMgB,MAAM,GAAGZ,MAAM,CAACW,OAAO,EAAE,IAAI,EAAEZ,aAAa,CAACF,UAAU,CAACgB,UAAU,CAAC,CAAC;EAE1E,OAAO,CAAC,CAACD,MAAM;AACjB;AAEA,OAAO,MAAME,2BAA2B,GAAG,0BAA0B;AAErE,eAAeC,kBAAkBA,CAACC,KAAK,EAAEC,EAAE,EAAE;EAC3C,IAAID,KAAK,CAACT,OAAO,CAAC,mBAAmB,CAAC,CAACT,SAAS,CAAC,EAAE;IACjD,MAAMoB,SAAS,GAAG,OAAMF,KAAK,CAACG,QAAQ,CAAC,iBAAiB,EAAE;MAAEC,IAAI,EAAEtB;IAAU,CAAC,CAAC,KAAI,EAAE;IAEpF,MAAMuB,QAAQ,GAAGH,SAAS,CAACI,IAAI,CAAEC,EAAE,IAAKA,EAAE,CAACN,EAAE,KAAKA,EAAE,CAAC;IAErD,OAAOI,QAAQ,IAAI,CAACpB,OAAO,CAACoB,QAAQ,CAAC,IAAI,CAACpB,OAAO,CAACoB,QAAQ,CAACG,OAAO,CAAC;EACrE;EAEA,OAAO,KAAK;AACd;AAEA,OAAO,eAAeC,kBAAkBA,CAACT,KAAK,EAAE;EAC9C,OAAO,MAAMD,kBAAkB,CAACC,KAAK,EAAE,GAAIF,2BAA2B,6BAA8B,CAAC;AACvG;AAEA,OAAO,eAAeY,uBAAuBA,CAACV,KAAK,EAAE;EACnD,OAAO,MAAMD,kBAAkB,CAACC,KAAK,EAAE,GAAIF,2BAA2B,kCAAmC,CAAC;AAC5G;AAEA,OAAO,eAAea,qBAAqBA,CAACX,KAAK,EAAE;EACjD,OAAO,MAAMD,kBAAkB,CAACC,KAAK,EAAE,GAAIF,2BAA2B,gCAAiC,CAAC;AAC1G;;AAEA;;AAEA;AACA;;AAEA;AACA","ignoreList":[]}]}