{"remainingRequest":"/app/node_modules/thread-loader/dist/cjs.js!/app/node_modules/babel-loader/lib/index.js!/app/node_modules/@rancher/shell/utils/validators/prometheusrule.js","dependencies":[{"path":"/app/node_modules/@rancher/shell/utils/validators/prometheusrule.js","mtime":1764054237091},{"path":"/app/pkg/rancher-support-ui/babel.config.js","mtime":1764051174054},{"path":"/app/node_modules/cache-loader/dist/cjs.js","mtime":1764054259024},{"path":"/app/node_modules/thread-loader/dist/cjs.js","mtime":1764054259111},{"path":"/app/node_modules/babel-loader/lib/index.js","mtime":1764054258910}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IGhhcyBmcm9tICdsb2Rhc2gvaGFzJzsKaW1wb3J0IGlzRW1wdHkgZnJvbSAnbG9kYXNoL2lzRW1wdHknOwpleHBvcnQgZnVuY3Rpb24gcnVsZUdyb3VwcyhzcGVjLCBnZXR0ZXJzLCBlcnJvcnMsIHZhbGlkYXRvckFyZ3MpIHsKICBpZiAoaXNFbXB0eShzcGVjID09PSBudWxsIHx8IHNwZWMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNwZWMuZ3JvdXBzKSkgewogICAgZXJyb3JzLnB1c2goZ2V0dGVyc1snaTE4bi90J10oJ3ZhbGlkYXRpb24ucHJvbWV0aGV1c1J1bGUuZ3JvdXBzLnJlcXVpcmVkJykpOwogIH0KICByZXR1cm4gZXJyb3JzOwp9CmV4cG9ydCBmdW5jdGlvbiBncm91cHNBcmVWYWxpZChncm91cHMgPSBbXSwgZ2V0dGVycywgZXJyb3JzLCB2YWxpZGF0b3JBcmdzKSB7CiAgZ3JvdXBzLmZvckVhY2goKGdyb3VwLCBncm91cEluZGV4KSA9PiB7CiAgICBjb25zdCByZWFkYWJsZUdyb3VwSW5kZXggPSBncm91cEluZGV4ICsgMTsgLy8gb2ggdGhhdCBvbCB6ZXJvIGJhc2VkIGFycmF5IGluZGV4Li4uLgoKICAgIGlmIChpc0VtcHR5KGdyb3VwID09PSBudWxsIHx8IGdyb3VwID09PSB2b2lkIDAgPyB2b2lkIDAgOiBncm91cC5uYW1lKSkgewogICAgICBlcnJvcnMucHVzaChnZXR0ZXJzWydpMThuL3QnXSgndmFsaWRhdGlvbi5wcm9tZXRoZXVzUnVsZS5ncm91cHMudmFsaWQubmFtZScsIHsKICAgICAgICBpbmRleDogcmVhZGFibGVHcm91cEluZGV4CiAgICAgIH0pKTsKICAgIH0KICAgIGlmIChpc0VtcHR5KGdyb3VwID09PSBudWxsIHx8IGdyb3VwID09PSB2b2lkIDAgPyB2b2lkIDAgOiBncm91cC5ydWxlcykpIHsKICAgICAgZXJyb3JzLnB1c2goZ2V0dGVyc1snaTE4bi90J10oJ3ZhbGlkYXRpb24ucHJvbWV0aGV1c1J1bGUuZ3JvdXBzLnZhbGlkLnNpbmdsZUVudHJ5JywgewogICAgICAgIGluZGV4OiByZWFkYWJsZUdyb3VwSW5kZXgKICAgICAgfSkpOwogICAgfSBlbHNlIHsKICAgICAgZ3JvdXAucnVsZXMuZm9yRWFjaCgocnVsZSwgcnVsZUluZGV4KSA9PiB7CiAgICAgICAgY29uc3QgcmVhZGFibGVSdWxlSW5kZXggPSBydWxlSW5kZXggKyAxOyAvLyBvaCB0aGF0IG9sIHplcm8gYmFzZWQgYXJyYXkgaW5kZXguLi4uCgogICAgICAgIGlmIChoYXMocnVsZSwgJ2FsZXJ0JykgJiYgaXNFbXB0eShydWxlID09PSBudWxsIHx8IHJ1bGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJ1bGUuYWxlcnQpKSB7CiAgICAgICAgICBlcnJvcnMucHVzaChnZXR0ZXJzWydpMThuL3QnXSgndmFsaWRhdGlvbi5wcm9tZXRoZXVzUnVsZS5ncm91cHMudmFsaWQucnVsZS5hbGVydE5hbWUnLCB7CiAgICAgICAgICAgIGdyb3VwSW5kZXg6IHJlYWRhYmxlR3JvdXBJbmRleCwKICAgICAgICAgICAgcnVsZUluZGV4OiByZWFkYWJsZVJ1bGVJbmRleAogICAgICAgICAgfSkpOwogICAgICAgIH0gZWxzZSBpZiAoaGFzKHJ1bGUsICdyZWNvcmQnKSAmJiBpc0VtcHR5KHJ1bGUgPT09IG51bGwgfHwgcnVsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcnVsZS5yZWNvcmQpKSB7CiAgICAgICAgICBlcnJvcnMucHVzaChnZXR0ZXJzWydpMThuL3QnXSgndmFsaWRhdGlvbi5wcm9tZXRoZXVzUnVsZS5ncm91cHMudmFsaWQucnVsZS5yZWNvcmROYW1lJywgewogICAgICAgICAgICBncm91cEluZGV4OiByZWFkYWJsZUdyb3VwSW5kZXgsCiAgICAgICAgICAgIHJ1bGVJbmRleDogcmVhZGFibGVSdWxlSW5kZXgKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgICAgaWYgKGhhcyhydWxlLCAnZXhwcicpICYmIGlzRW1wdHkocnVsZS5leHByKSB8fCAhaGFzKHJ1bGUsICdleHByJykpIHsKICAgICAgICAgIGVycm9ycy5wdXNoKGdldHRlcnNbJ2kxOG4vdCddKCd2YWxpZGF0aW9uLnByb21ldGhldXNSdWxlLmdyb3Vwcy52YWxpZC5ydWxlLmV4cHInLCB7CiAgICAgICAgICAgIGdyb3VwSW5kZXg6IHJlYWRhYmxlR3JvdXBJbmRleCwKICAgICAgICAgICAgcnVsZUluZGV4OiByZWFkYWJsZVJ1bGVJbmRleAogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgICBpZiAoaGFzKHJ1bGUsICdhbGVydCcpKSB7CiAgICAgICAgICBpZiAoaGFzKHJ1bGUsICdsYWJlbHMnKSAmJiBpc0VtcHR5KHJ1bGUubGFiZWxzKSB8fCAhaGFzKHJ1bGUsICdsYWJlbHMnKSkgewogICAgICAgICAgICBlcnJvcnMucHVzaChnZXR0ZXJzWydpMThuL3QnXSgndmFsaWRhdGlvbi5wcm9tZXRoZXVzUnVsZS5ncm91cHMudmFsaWQucnVsZS5sYWJlbHMnLCB7CiAgICAgICAgICAgICAgZ3JvdXBJbmRleDogcmVhZGFibGVHcm91cEluZGV4LAogICAgICAgICAgICAgIHJ1bGVJbmRleDogcmVhZGFibGVSdWxlSW5kZXgKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CiAgcmV0dXJuIGVycm9yczsKfQ=="},{"version":3,"names":["has","isEmpty","ruleGroups","spec","getters","errors","validatorArgs","groups","push","groupsAreValid","forEach","group","groupIndex","readableGroupIndex","name","index","rules","rule","ruleIndex","readableRuleIndex","alert","record","expr","labels"],"sources":["/app/node_modules/@rancher/shell/utils/validators/prometheusrule.js"],"sourcesContent":["import has from 'lodash/has';\nimport isEmpty from 'lodash/isEmpty';\n\nexport function ruleGroups(spec, getters, errors, validatorArgs) {\n  if (isEmpty(spec?.groups)) {\n    errors.push(getters['i18n/t']('validation.prometheusRule.groups.required'));\n  }\n\n  return errors;\n}\n\nexport function groupsAreValid(groups = [], getters, errors, validatorArgs) {\n  groups.forEach((group, groupIndex) => {\n    const readableGroupIndex = groupIndex + 1; // oh that ol zero based array index....\n\n    if (isEmpty(group?.name)) {\n      errors.push(\n        getters['i18n/t']('validation.prometheusRule.groups.valid.name', { index: readableGroupIndex })\n      );\n    }\n\n    if (isEmpty(group?.rules)) {\n      errors.push(\n        getters['i18n/t'](\n          'validation.prometheusRule.groups.valid.singleEntry',\n          { index: readableGroupIndex }\n        )\n      );\n    } else {\n      group.rules.forEach((rule, ruleIndex) => {\n        const readableRuleIndex = ruleIndex + 1; // oh that ol zero based array index....\n\n        if (has(rule, 'alert') && isEmpty(rule?.alert)) {\n          errors.push(\n            getters['i18n/t'](\n              'validation.prometheusRule.groups.valid.rule.alertName',\n              { groupIndex: readableGroupIndex, ruleIndex: readableRuleIndex }\n            )\n          );\n        } else if (has(rule, 'record') && isEmpty(rule?.record)) {\n          errors.push(\n            getters['i18n/t'](\n              'validation.prometheusRule.groups.valid.rule.recordName',\n              { groupIndex: readableGroupIndex, ruleIndex: readableRuleIndex }\n            )\n          );\n        }\n\n        if ((has(rule, 'expr') && isEmpty(rule.expr)) || !has(rule, 'expr')) {\n          errors.push(\n            getters['i18n/t'](\n              'validation.prometheusRule.groups.valid.rule.expr',\n              { groupIndex: readableGroupIndex, ruleIndex: readableRuleIndex }\n            )\n          );\n        }\n\n        if (has(rule, 'alert')) {\n          if (\n            (has(rule, 'labels') && isEmpty(rule.labels)) ||\n            !has(rule, 'labels')\n          ) {\n            errors.push(\n              getters['i18n/t'](\n                'validation.prometheusRule.groups.valid.rule.labels',\n                { groupIndex: readableGroupIndex, ruleIndex: readableRuleIndex }\n              )\n            );\n          }\n        }\n      });\n    }\n  });\n\n  return errors;\n}\n"],"mappings":"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","ignoreList":[]}]}