{"remainingRequest":"/app/node_modules/thread-loader/dist/cjs.js!/app/node_modules/babel-loader/lib/index.js!/app/node_modules/@rancher/shell/promptRemove/mixin/roleDeletionCheck.js","dependencies":[{"path":"/app/node_modules/@rancher/shell/promptRemove/mixin/roleDeletionCheck.js","mtime":1764054237091},{"path":"/app/pkg/rancher-support-ui/babel.config.js","mtime":1764051174054},{"path":"/app/node_modules/cache-loader/dist/cjs.js","mtime":1764054259024},{"path":"/app/node_modules/thread-loader/dist/cjs.js","mtime":1764054259111},{"path":"/app/node_modules/babel-loader/lib/index.js","mtime":1764054258910}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgbWFwU3RhdGUsIG1hcEdldHRlcnMgfSBmcm9tICd2dWV4JzsKaW1wb3J0IHsgcmVzb3VyY2VOYW1lcyB9IGZyb20gJ0BzaGVsbC91dGlscy9zdHJpbmcnOwppbXBvcnQgeyBNQU5BR0VNRU5UIH0gZnJvbSAnQHNoZWxsL2NvbmZpZy90eXBlcyc7CmltcG9ydCB7IFNVQlRZUEVfTUFQUElORyB9IGZyb20gJ0BzaGVsbC9tb2RlbHMvbWFuYWdlbWVudC5jYXR0bGUuaW8ucm9sZXRlbXBsYXRlJzsKY29uc3QgQ0xVU1RFUiA9IFNVQlRZUEVfTUFQUElORy5DTFVTVEVSLmtleTsKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB3YXJuaW5nOiAnJywKICAgICAgaW5mbzogJycKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgLi4ubWFwU3RhdGUoJ2FjdGlvbi1tZW51JywgWyd0b1JlbW92ZSddKSwKICAgIC4uLm1hcEdldHRlcnMoewogICAgICB0OiAnaTE4bi90JwogICAgfSksCiAgICBuYW1lcygpIHsKICAgICAgcmV0dXJuIHRoaXMudG9SZW1vdmUubWFwKG9iaiA9PiBvYmoubmFtZURpc3BsYXkpLnNsaWNlKDAsIDUpOwogICAgfSwKICAgIHBsdXNNb3JlKCkgewogICAgICBjb25zdCByZW1haW5pbmcgPSB0aGlzLnRvUmVtb3ZlLmxlbmd0aCAtIHRoaXMubmFtZXMubGVuZ3RoOwogICAgICByZXR1cm4gdGhpcy50KCdwcm9tcHRSZW1vdmUuYW5kT3RoZXJzJywgewogICAgICAgIGNvdW50OiByZW1haW5pbmcKICAgICAgfSk7CiAgICB9CiAgfSwKICB3YXRjaDogewogICAgdmFsdWU6IHsKICAgICAgaGFuZGxlcihuZXUpIHsKICAgICAgICB0aGlzLmhhbmRsZVJvbGVEZWxldGlvbkNoZWNrKG5ldSwgbmV1WzBdLnR5cGUsIHRoaXMuJHJvdXRlLmhhc2gpOwogICAgICB9LAogICAgICBpbW1lZGlhdGU6IHRydWUKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIHJlc291cmNlTmFtZXMsCiAgICBhc3luYyBoYW5kbGVSb2xlRGVsZXRpb25DaGVjayhyb2xlc1RvUmVtb3ZlLCByZXNvdXJjZVR5cGUsIHF1ZXJ5SGFzaCkgewogICAgICB0aGlzLndhcm5pbmcgPSAnJzsKICAgICAgbGV0IHJlc291cmNlVG9DaGVjazsKICAgICAgbGV0IHByb3BUb01hdGNoOwogICAgICBsZXQgbnVtYmVyT2ZSb2xlc1dpdGhCaW5kcyA9IDA7CiAgICAgIGNvbnN0IHVuaXF1ZVVzZXJzV2l0aEJpbmRzID0gbmV3IFNldCgpOwogICAgICB0aGlzLmluZm8gPSB0aGlzLnQoJ3JiYWMuZ2xvYmFsUm9sZXMud2FpdGluZycsIHsKICAgICAgICBjb3VudDogcm9sZXNUb1JlbW92ZS5sZW5ndGgKICAgICAgfSk7CiAgICAgIHN3aXRjaCAocmVzb3VyY2VUeXBlKSB7CiAgICAgICAgY2FzZSBNQU5BR0VNRU5ULkdMT0JBTF9ST0xFOgogICAgICAgICAgcmVzb3VyY2VUb0NoZWNrID0gTUFOQUdFTUVOVC5HTE9CQUxfUk9MRV9CSU5ESU5HOwogICAgICAgICAgcHJvcFRvTWF0Y2ggPSAnZ2xvYmFsUm9sZU5hbWUnOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGlmIChxdWVyeUhhc2guaW5jbHVkZXMoQ0xVU1RFUikpIHsKICAgICAgICAgICAgcmVzb3VyY2VUb0NoZWNrID0gTUFOQUdFTUVOVC5DTFVTVEVSX1JPTEVfVEVNUExBVEVfQklORElORzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc291cmNlVG9DaGVjayA9IE1BTkFHRU1FTlQuUFJPSkVDVF9ST0xFX1RFTVBMQVRFX0JJTkRJTkc7CiAgICAgICAgICB9CiAgICAgICAgICBwcm9wVG9NYXRjaCA9ICdyb2xlVGVtcGxhdGVOYW1lJzsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIF91c2VycyRkYXRhOwogICAgICAgIGNvbnN0IHJlcXVlc3QgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9yZXF1ZXN0JywgewogICAgICAgICAgdXJsOiBgL3YxLyR7cmVzb3VyY2VUb0NoZWNrfWAsCiAgICAgICAgICBtZXRob2Q6ICdnZXQnCiAgICAgICAgfSwgewogICAgICAgICAgcm9vdDogdHJ1ZQogICAgICAgIH0pOwoKICAgICAgICAvLyBXZSBuZWVkIHRvIGZldGNoIHRoZSB1c2VycyBoZXJlIGluIG9yZGVyIHRvIGdldCBhbiBhY2N1cmF0ZSBjb3VudCB3aGVuIHNlbGVjdGluZyBnbG9iYWwgcm9sZXMuCiAgICAgICAgY29uc3QgdXNlcnMgPSBhd2FpdCB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbWFuYWdlbWVudC9yZXF1ZXN0JywgewogICAgICAgICAgdXJsOiBgL3YxLyR7TUFOQUdFTUVOVC5VU0VSfWAsCiAgICAgICAgICBtZXRob2Q6ICdnZXQnCiAgICAgICAgfSwgewogICAgICAgICAgcm9vdDogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIGNvbnN0IHVzZXJNYXAgPSAoX3VzZXJzJGRhdGEgPSB1c2Vycy5kYXRhKSA9PT0gbnVsbCB8fCBfdXNlcnMkZGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3VzZXJzJGRhdGEucmVkdWNlKChtYXAsIHVzZXIpID0+IHsKICAgICAgICAgIGlmICh1c2VyLnVzZXJuYW1lKSB7CiAgICAgICAgICAgIG1hcFt1c2VyLmlkXSA9IHVzZXI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbWFwOwogICAgICAgIH0sIHt9KTsKICAgICAgICBpZiAocmVxdWVzdC5kYXRhICYmIHJlcXVlc3QuZGF0YS5sZW5ndGgpIHsKICAgICAgICAgIHJvbGVzVG9SZW1vdmUuZm9yRWFjaCh0b1JlbW92ZSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHVzZWRSb2xlcyA9IHJlcXVlc3QuZGF0YS5maWx0ZXIoaXRlbSA9PiBpdGVtW3Byb3BUb01hdGNoXSA9PT0gdG9SZW1vdmUuaWQpOwogICAgICAgICAgICBpZiAodXNlZFJvbGVzLmxlbmd0aCkgewogICAgICAgICAgICAgIGNvbnN0IHVuaXF1ZVVzZXJzID0gWy4uLm5ldyBTZXQodXNlZFJvbGVzLm1hcChpdGVtID0+IGl0ZW0udXNlck5hbWUpLmZpbHRlcih1c2VyID0+IHVzZXJNYXBbdXNlcl0pKV07CiAgICAgICAgICAgICAgaWYgKHVuaXF1ZVVzZXJzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgbnVtYmVyT2ZSb2xlc1dpdGhCaW5kcysrOwogICAgICAgICAgICAgICAgdW5pcXVlVXNlcnMuZm9yRWFjaCh1c2VyID0+IHVuaXF1ZVVzZXJzV2l0aEJpbmRzLmFkZCh1c2VyKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChudW1iZXJPZlJvbGVzV2l0aEJpbmRzICYmIHVuaXF1ZVVzZXJzV2l0aEJpbmRzLnNpemUpIHsKICAgICAgICAgICAgdGhpcy5pbmZvID0gJyc7CiAgICAgICAgICAgIHRoaXMud2FybmluZyA9IHRoaXMudCgncmJhYy5nbG9iYWxSb2xlcy51c2Vyc0JvdW5kJywgewogICAgICAgICAgICAgIGNvdW50OiB1bmlxdWVVc2Vyc1dpdGhCaW5kcy5zaXplCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5pbmZvID0gdGhpcy50KCdyYmFjLmdsb2JhbFJvbGVzLm5vdEJvdW5kJywgbnVsbCwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuaW5mbyA9IHRoaXMudCgncmJhYy5nbG9iYWxSb2xlcy5ub3RCb3VuZCcsIG51bGwsIHRydWUpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHRoaXMuaW5mbyA9IHRoaXMudCgncmJhYy5nbG9iYWxSb2xlcy51bmFibGVUb0NoZWNrJyk7CiAgICAgIH0KICAgIH0KICB9Cn07"},{"version":3,"names":["mapState","mapGetters","resourceNames","MANAGEMENT","SUBTYPE_MAPPING","CLUSTER","key","data","warning","info","computed","t","names","toRemove","map","obj","nameDisplay","slice","plusMore","remaining","length","count","watch","value","handler","neu","handleRoleDeletionCheck","type","$route","hash","immediate","methods","rolesToRemove","resourceType","queryHash","resourceToCheck","propToMatch","numberOfRolesWithBinds","uniqueUsersWithBinds","Set","GLOBAL_ROLE","GLOBAL_ROLE_BINDING","includes","CLUSTER_ROLE_TEMPLATE_BINDING","PROJECT_ROLE_TEMPLATE_BINDING","_users$data","request","$store","dispatch","url","method","root","users","USER","userMap","reduce","user","username","id","forEach","usedRoles","filter","item","uniqueUsers","userName","add","size","e"],"sources":["/app/node_modules/@rancher/shell/promptRemove/mixin/roleDeletionCheck.js"],"sourcesContent":["import { mapState, mapGetters } from 'vuex';\nimport { resourceNames } from '@shell/utils/string';\nimport { MANAGEMENT } from '@shell/config/types';\nimport { SUBTYPE_MAPPING } from '@shell/models/management.cattle.io.roletemplate';\nconst CLUSTER = SUBTYPE_MAPPING.CLUSTER.key;\n\nexport default {\n  data() {\n    return {\n      warning: '',\n      info:    '',\n    };\n  },\n\n  computed: {\n    ...mapState('action-menu', ['toRemove']),\n    ...mapGetters({ t: 'i18n/t' }),\n\n    names() {\n      return this.toRemove.map((obj) => obj.nameDisplay).slice(0, 5);\n    },\n\n    plusMore() {\n      const remaining = this.toRemove.length - this.names.length;\n\n      return this.t('promptRemove.andOthers', { count: remaining });\n    },\n  },\n  watch: {\n    value: {\n      handler(neu) {\n        this.handleRoleDeletionCheck(neu, neu[0].type, this.$route.hash);\n      },\n      immediate: true\n    }\n  },\n  methods: {\n    resourceNames,\n    async handleRoleDeletionCheck(rolesToRemove, resourceType, queryHash) {\n      this.warning = '';\n      let resourceToCheck;\n      let propToMatch;\n      let numberOfRolesWithBinds = 0;\n      const uniqueUsersWithBinds = new Set();\n\n      this.info = this.t('rbac.globalRoles.waiting', { count: rolesToRemove.length });\n\n      switch (resourceType) {\n      case MANAGEMENT.GLOBAL_ROLE:\n        resourceToCheck = MANAGEMENT.GLOBAL_ROLE_BINDING;\n        propToMatch = 'globalRoleName';\n        break;\n      default:\n        if (queryHash.includes(CLUSTER)) {\n          resourceToCheck = MANAGEMENT.CLUSTER_ROLE_TEMPLATE_BINDING;\n        } else {\n          resourceToCheck = MANAGEMENT.PROJECT_ROLE_TEMPLATE_BINDING;\n        }\n        propToMatch = 'roleTemplateName';\n        break;\n      }\n\n      try {\n        const request = await this.$store.dispatch('management/request', {\n          url:    `/v1/${ resourceToCheck }`,\n          method: 'get',\n        }, { root: true });\n\n        // We need to fetch the users here in order to get an accurate count when selecting global roles.\n        const users = await this.$store.dispatch('management/request', {\n          url:    `/v1/${ MANAGEMENT.USER }`,\n          method: 'get',\n        }, { root: true });\n\n        const userMap = users.data?.reduce((map, user) => {\n          if ( user.username ) {\n            map[user.id] = user;\n          }\n\n          return map;\n        }, {});\n\n        if (request.data && request.data.length) {\n          rolesToRemove.forEach((toRemove) => {\n            const usedRoles = request.data.filter((item) => item[propToMatch] === toRemove.id);\n\n            if (usedRoles.length) {\n              const uniqueUsers = [...new Set(usedRoles.map((item) => item.userName).filter((user) => userMap[user]))];\n\n              if (uniqueUsers.length) {\n                numberOfRolesWithBinds++;\n                uniqueUsers.forEach((user) => uniqueUsersWithBinds.add(user));\n              }\n            }\n          });\n\n          if (numberOfRolesWithBinds && uniqueUsersWithBinds.size) {\n            this.info = '';\n            this.warning = this.t('rbac.globalRoles.usersBound', { count: uniqueUsersWithBinds.size });\n          } else {\n            this.info = this.t('rbac.globalRoles.notBound', null, true);\n          }\n        } else {\n          this.info = this.t('rbac.globalRoles.notBound', null, true);\n        }\n      } catch (e) {\n        this.info = this.t('rbac.globalRoles.unableToCheck');\n      }\n    },\n  },\n};\n"],"mappings":"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","ignoreList":[]}]}